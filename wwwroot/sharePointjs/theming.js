var Theming={__namespace:true};Theming_module_def();function Theming_module_def(){Theming.ApplyThemeToCss=tb;Theming.ReplaceCssTextForElement=J;Theming.ThemeInfo=E;Theming.ImageProcessor=R;Theming.Colors={Color:a,ColorApplication:x,HslColor:h};function cb(d,c,e){for(var b=true,a=0;a<c.length;a++)if(d.charCodeAt(e+a)!==c.charCodeAt(a)){b=false;break}return b}var c={text:0,comment:1,string:2,url:3,right_par:4,font_family:5,rgb:6,rgba:7,colon:8,semicolon:9,right_curly:10,color:11};function d(a,b){this.kind=a;this.text=b}function Db(b){var e,a,g,f,l="*/",u="url(",i=")",j="font-family",t="rgb(",s="rgba(",o="#",w=":",y=";",x="}",k=new d(c.text,"");if(!Boolean(b))b="";a=0;f=b.length;m.prototype={kind:0,text:"",getToken:function(){return null}};function m(){}var r={"/":{},"'":{},'"':{},"#":{},")":new d(c.right_par,")"),";":new d(c.semicolon,";"),":":new d(c.colon,":"),"}":new d(c.right_curly,"}"),u:{getToken:q},f:{getToken:n},r:{getToken:p}};function h(c){var a=b.indexOf(")",c);if(a<0)a=f;return b.substring(c+1,a)}function q(g){var f=null;if(b.charAt(a+1)==="r"&&b.charAt(a+2)==="l"&&b.charAt(a+3)==="("){var e=h(a+3);f=new d(c.url,e);if(g)a+=u.length+e.length+i.length}return f}function p(g){var f=null,e;if(b.charAt(a+1)==="g"&&b.charAt(a+2)==="b")if(b.charAt(a+3)==="("){e=h(a+3);f=new d(c.rgb,e);if(g)a+=t.length+e.length+i.length}else if(b.charAt(a+3)==="a"&&b.charAt(a+4)==="("){e=h(a+4);f=new d(c.rgba,e);if(g)a+=s.length+e.length+i.length}return f}function n(k){var g=-1,i=null;if(cb(b,j,a))for(var e=a+j.length;e<f;e++){var h=b.charAt(e);if(h===w&&g===-1)g=e+1;else if(h===";"||h==="}"){if(g>a){i=new d(c.font_family,b.substring(g,e));if(k)a=e}break}else if(g===-1&&/\S/.test(h))break}return i}function v(){var h,n=0,j=null;g=a;a:for(;;a++){e=b.charAt(a);if(!Boolean(e))break a;var i;while((i=r[e])===undefined&&a<f)e=b.charAt(++a);if(a!==g){if(a!==f&&"getToken"in i&&i.getToken(false)===null)continue;k.text=b.substring(g,a);return k}else if("text"in i){a+=i.text.length;return i}else if("getToken"in i){var m=i.getToken(true);if(m!==null)return m}else if("/"===e&&"*"===b.charAt(a+1)){h=b.indexOf(l,a+2);if(-1===h){a=f-1;break}else{a=h+2;return new d(c.comment,b.substring(g,h+2))}}else if("'"===e||'"'===e)b:for(;;){h=b.indexOf(e,a+1);if(-1===h){a=f-1;break a}else{a=h+1;if("\\"===b.charAt(h-1))continue b;else return new d(c.string,b.substring(g,h+1))}break b}else if(o===e&&(j=/^#(?:[0-9A-Fa-f]{3}){1,2}/.exec(b.substr(a,7)))!=null){a+=j[0].length;return new d(c.color,j[0])}continue}return new d(c.text,b.substr(g))}return{getNext:v,tokenKind:c}}Theming.CssLexing={};Theming.CssLexing.token_kind=c;Theming.CssLexing.token=d;Theming.CssLexing.lexer=Db;function x(a,e,b,c,d){this.themeColor=a;this.color=e;this.themeShade=b;this.themeTint-c;this.opacity=d}x.prototype={themeColor:undefined,color:undefined,themeShade:undefined,themeTint:undefined,opacity:undefined};var b=255;a.prototype={R:0,G:0,B:0,A:b};function a(e,d,c,a){a=isNaN(a)?b:Number(a);this.R=Math.round(e);this.G=Math.round(d);this.B=Math.round(c);this.A=Math.round(a)}a.Equals=Bb;function Bb(a,b){var c=a==null,d=b==null;return c||d?c&&d:a.R===b.R&&a.G===b.G&&a.B===b.B&&a.A===b.A}a.FromRgba=r;function r(e,d,c,b){return new a(e,d,c,b)}a.Black=new a(0,0,0,b);a.White=new a(b,b,b,b);a.RgbaMaxValue=b;function p(c){var d=Number(c);if(!(d>=0&&d<=b))throw new Error("Argument must be a Number in [0, 255]");var a=c.toString(16);if(c<16)a="0"+a;return a}function A(a,c){return a.A<b&&!c?"rgba("+a.R.toString(10)+", "+a.G.toString(10)+", "+a.B.toString(10)+", "+(a.A/b).toFixed(2)+")":"#"+(c?p(a.A):"")+p(a.R)+p(a.G)+p(a.B)}a.ToHtmlString=function(a){return A(a)};function Z(i,h){var f,d=[0,0,0,b],g=i.split(",");if(g.length!==(h?4:3))return new a(0,0,0,b);for(var c=0;c<3;c++){f=g[c];d[c]=parseInt(f,10);if(isNaN(d[c]))return new a(0,0,0,b);if(f.charAt(f.length-1)==="%")d[c]=Math.floor(b*(Math.min(d[c],100)/100))}var e=b;if(h){e=Math.floor(Number(g[3])*b);if(isNaN(e)||e>b||e<0)e=b}d[3]=e;return r.apply(null,d)}a.FromHtmlColor=q;function q(c){function d(a,b,c){return parseInt(a.charAt(b)+a.charAt(c),16)}var a=[NaN,NaN,NaN,b];if(typeof c==="string"&&c.charAt(0)==="#")switch(c.length){case 9:a[3]=d(c,1,2);a[0]=d(c,3,4);a[1]=d(c,5,6);a[2]=d(c,7,8);break;case 7:a[0]=d(c,1,2);a[1]=d(c,3,4);a[2]=d(c,5,6);break;case 4:a[0]=d(c,1,1);a[1]=d(c,2,2);a[2]=d(c,3,3)}var e=null;if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(a[3]))f("Theming: Invalid HTML color: "+String(c));else e=r.apply(null,a);return e}var u={};function ib(b){var c=a.Black;if(u.hasOwnProperty(b))c=u[b];else if(o()){var d=document.createElement("canvas");d.width=d.height="1";var e=d.getContext("2d");e.fillStyle=b;e.fillRect(0,0,1,1);c=u[b]=r.apply(null,e.getImageData(0,0,1,1).data)}return c}function L(a){return typeof a=="number"&&a>=0&&a<=1}function t(a){return Math.min(1,Math.max(0,a))}function j(c){var a=Math.round(b*c);return Math.min(b,Math.max(0,a))}function h(d,c,b,e){if(d!==-1)d=t(d);c=t(c);b=t(b);this.Lighten=function(a){if(!L(a)){f("Lighten: factor must be in [0,1]");return}b=b*a+(1-a)};this.Darken=function(a){if(!L(a)){f("Darken: factor must be in [0,1]");return}b=b*a};this.getHue=function(){return d};this.getSaturation=function(){return c};this.getLuminance=function(){return b};this.setLuminance=function(a){b=a};this.ToRgbaColor=function(){var k,i,h;if(Math.round(c*1e4)===0)k=i=h=j(b);else{var g,f;if(b<=.5)f=b*(1+c);else f=b+c-b*c;g=2*b-f;k=v(g,f,d+1/3);i=v(g,f,d);h=v(g,f,d-1/3)}return new a(k,i,h,e)}}function v(c,d,a){var b;if(a<0)a+=1;if(a>1)a-=1;if(a<1/6)b=c+(d-c)*a*6;else if(a<1/2)b=d;else if(a<2/3)b=c+(d-c)*(2/3-a)*6;else b=c;return j(b)}h.FromRgba=function(f){var k=b,a=0,e=0,p=0,j=f.R,i=f.G,l=f.B,c=Math.max(Math.max(j,i),l),g=Math.min(Math.min(j,i),l),q=c+g;p=q/(2*k);if(c===g){e=0;a=-1}else{var d=c-g,r=c+g;if(q<=1*k)e=d/r;else e=d/(2*k-r);var o=(c-j)*(1/6)/d,n=(c-i)*(1/6)/d,m=(c-l)*(1/6)/d;if(j===c)a=m-n;else if(i===c)a=1/3+o-m;else a=2/3+n-o;if(a<0)a+=1;if(a>1)a-=1}return new h(a,e,p,f.A)};var g={color:c.color,gradient:c.string,rgb:c.rgb,rgba:c.rgba};D.prototype={str:"#000000",type:g.color,color:void 0,getColor:function(){if(this.color===void 0)if(this.type===g.color||this.type===g.gradient)this.color=q(this.str);else this.color=Z(this.str,this.type===g.rgba);return this.color}};function D(){}function mb(c,b){var a=new D;a.str=c;a.type=b;return a}function nb(b){var a=new D;a.color=b;return a}var ob=["Coral","Rose","LightOrange","Tan","Tan","LightYellow","LightYellow","Tan","LightGreen","Lime","LightGreen","LightGreen","Aqua","SkyBlue","LightTurquoise","PaleBlue","LightBlue","IceBlue","Periwinkle","Lavender","Pink","Tan","Rose"],P=["Coral","Red","Orange","Brown","Tan","Gold","Yellow","OliveGreen","OliveGreen","Green","Green","BrightGreen","Teal","Aqua","Turquoise","PaleBlue","Blue","BlueGray","Indigo","Purple","Pink","Brown","Red"],qb=["Brown","DarkRed","Brown","Brown","Brown","DarkYellow","DarkYellow","Brown","DarkGreen","DarkGreen","DarkGreen","DarkGreen","DarkTeal","DarkTeal","DarkTeal","DarkBlue","DarkBlue","BlueGray","Indigo","DarkPurple","Plum","Brown","DarkRed"],X=[[8,0,0,44,0,0,0,63,0,0,122,0,134,0,0,0,0,166,176,241,0,256,0],[0,10,0,32,46,0,0,0,61,0,106,0,136,144,0,0,0,158,166,241,0,0,256],[0,8,0,0,39,46,0,0,0,71,120,0,131,144,0,0,163,0,177,211,249,0,256],[0,11,26,0,0,38,45,0,0,56,100,121,129,0,140,0,180,0,0,224,241,0,256],[0,13,27,0,0,36,45,0,0,59,118,0,127,136,142,0,185,0,0,216,239,0,256]],N=[75,115,150,240],H=[[130,100,115,100,100,100,110,75,100,90,100,100,100,100,80,100,100,100,100,100,100,100,100],[170,170,170,155,170,170,170,170,170,115,170,170,170,170,170,170,170,170,150,150,170,140,165]];function fb(l,g){function a(b){var a=g[b];if(!Boolean(a))a=b;return a}var e=h.FromRgba(l),c=j(e.getLuminance()),f=j(e.getSaturation()),m=j(e.getHue());if(c>240)return a("White");else if(c<20)return a("Black");if(f<=20)return c>170?a("Gray25"):c>100?a("Gray50"):a("Gray80");for(var k=N.length,d=0;d<k;d++)if(f<N[d])break;for(var i=P.length,b=0;b<i;b++)if(m<X[d][b])break;return c>H[1][b]?a(ob[b]):c<H[0][b]?a(qb[b]):a(P[b])}hb.prototype={themeColor:"",color:"",themeShade:0,themeTint:0,opacity:-1};function hb(){}ab.prototype={colorIndex:"",themeColor1:"",color1:"",themeShade1:0,themeTint1:0,opacity1:-1,themeColor2:"",color2:"",themeShade2:0,themeTint2:0,opacity2:-1};function ab(){}Cb.prototype={x:0,y:0,width:0,height:0};function Cb(){}gb.prototype={lightThemeColor:"",lightColor:"",darkThemeColor:"",darkColor:"",themeColor:"",method:"",detach:false,hashOverride:"",includeRectangle:null,excludeRectangle:null};function gb(){}jb.prototype={themeFont:"",preferredScript:""};function jb(){}lb.prototype={url:null,operations:[]};function lb(b,a){this.url=b;this.operations=a}m.prototype.AddRules=function(){};m.prototype.GetRules=function(){return[]};m.prototype.GetRulesForUrl=function(){return[]};function m(){var a=new i(b,s);this.AddRules=e;this.GetRules=f;this.GetRulesForUrl=d;function b(){return new i(function(){return[]},c)}function c(a){if(!Boolean(a))a="";return"#"+a}function d(d){var b=[],c=a.get(d);c.foreach(function(a){b.push(a)});return Array.prototype.concat.apply([],b)}function f(e,b){var c=a.get(e),d=c.get(b);return d}function e(e){for(var f=document.createElement("a"),b=0;b<e.length;b++){var g=e[b];f.href=g.url;for(var h=f.href,d=g.operations,c=0;c<d.length;c++){var a=d[c];if(Boolean(h)&&a!=null){var i=this.GetRules(h,a.hashOverride);i.push(a)}}}}}function R(){var c=function(){var a=document.createElement("canvas");function b(c,b){a.width=c;a.height=b;return a}return b}();this.ThemeImage=d;function a(a){return"naturalHeight"in a?Number(a.naturalHeight):Number(a.height)}function b(a){return"naturalWidth"in a?Number(a.naturalWidth):Number(a.width)}function d(e,j,k){var h=a(e),i=b(e),g=c(i,h),f=g.getContext("2d");f.drawImage(e,0,0);var d=f.getImageData(0,0,i,h);rb(d.data,d.width,d.height,j,k);f.putImageData(d,0,0);return g.toDataURL()}}var n={Blending:0,Filling:1,Tinting:2};function kb(b,c,f){var d;switch(f){case n.Blending:d=new a((b.R+c.R)/2,(b.G+c.G)/2,(b.B+c.B)/2,b.A);break;case n.Filling:d=new a(c.R,c.G,c.B,b.A);break;case n.Tinting:default:var e=h.FromRgba(c);e.setLuminance(h.FromRgba(b).getLuminance());d=e.ToRgbaColor();d.A=b.A}return d}function rb(f,e,c,b,d){for(var a=0;a<b.length;a++){var g=b[a];bb(f,e,c,g,d)}}function O(a){return a==null||a.width==0&&a.height==0}function bb(d,u,y,b,p){var i=b.includeRectangle,l=0,q=0,v=u,w=y;if(!O(i)){l=Number(i.x);q=Number(i.y);v=Number(i.width)+l;w=Number(i.height)+q}function x(a){var b=Number(a.x),c=Number(a.y),e=Number(a.width)+b,f=Number(a.height)+c;function d(a,d){return a>=b&&a<=e&&d>=c&&d<=f}return d}var t=!O(b.excludeRectangle)?x(b.excludeRectangle):null,g=a.Black,j,o;if(Boolean(b.themeColor)){var z=n[b.method],s=p.GetColorForApplication({themeColor:b.themeColor});if(s==null){f("Cannot find theme color: "+b.themeColor);return}o=function(){return kb(g,s,z)}}else{var e=eb(b,p),k=db(b,p);if(e==null||k==null){f("Theming: Missing attributes in RecolorImage: "+JSON.stringify(b));return}var E=e.R<<16,C=e.G<<16,A=e.B<<16,F=k.R-e.R<<8,D=k.G-e.G<<8,B=k.B-e.B<<8;o=function(){var b=h.FromRgba(g).getLuminance();return new a(Math.max(E+F*b>>16,0),Math.max(C+D*b>>16,0),Math.max(A+B*b>>16,0))}}for(var c=0,m=q;m<w;m++){c=(m*u+l)*4;for(var r=l;r<v;r++,c+=4){if(t!==null&&t(r,m))continue;g.R=d[c];g.G=d[c+1];g.B=d[c+2];g.A=d[c+3];j=o();d[c]=j.R;d[c+1]=j.G;d[c+2]=j.B;d[c+3]=j.A}}}function K(d,c,b){var a;if(c!=null)a=d.GetColorForApplication({themeColor:c});else if(b!=null)a=ib(b);else a=null;return a}function eb(a,b){return K(b,a.darkThemeColor,a.darkColor)}function db(a,b){return K(b,a.lightThemeColor,a.lightColor)}Theming.Utilities={CanRecolorImages:o,CombinePathFragments:M,MakeFixupCallbackForCssFile:F};var l=null;function o(){if(l===null)try{var a=navigator.userAgent.toLowerCase(),b=a.indexOf("msie ")!=-1&&parseInt(a.substring(a.indexOf("msie ")+5))<=8;l=!b&&"getContext"in document.createElement("canvas")}catch(c){l=false}return l}function M(a,b){var c=a.charAt(a.length-1)=="/",d=b.charAt(0)=="/";return c!==d?a+b:c?a.slice(0,-1)+b:a+"/"+b}function F(g){var a=g.replace(/(?:\?.*)|(?:#.*)/g,""),e="",b=a.indexOf("//"),d=a.lastIndexOf("/");if(d>b+1){a=a.substring(0,d);if(b>0){var c=a.indexOf("/",b+2);if(c<0)c=a.length;e=a.substring(0,c)}}else a=null;return f;function f(b){var c=b;if(a!=null&&Boolean(b)&&b!=="none"&&b!=="inherit"&&b.indexOf("://")<0){var d=b.charAt(0)==="/"?e:a;c=M(d,b)}return c}}function f(a){typeof window.console!="undefined"&&typeof window.console.log!="undefined"&&window.console.log(a)}function W(){var a=0;this.getNext=function(){return a++}}function k(b){var c={"'":"%27",'"':"%22","(":"%28",")":"%29"},a=null;if(b!=null)a=b.replace(/(['"\(\)])/gm,function(b,a){return c[a]});return a}function I(a){if(Boolean(a)){var b=a.charAt(0);if((b==="'"||b==='"')&&b===a.charAt(a.length-1))a=decodeURI(a.slice(1,-1))}return a}function Q(d,a){var b;if(a==null)a=0;return c;function c(c){clearTimeout(b);if(!Boolean(c))b=setTimeout(d,a)}}function vb(d,c,b){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a==null||a.readyState!=4)return;if(a.status==200)c(a.responseText);else Boolean(b)&&b(a.status);a=null};try{a.open("GET",d,true);a.send("")}catch(e){Boolean(b)&&b(-1)}}function y(){var a=[];this.clear=b;this.execute=c;this.push=d;function b(){a=[]}function c(){var d=a;b();for(var g=d.length,c=0;c<g;c++)if(d[c]!=null)try{d[c]()}catch(h){var e=h.message;f("OperationsQueue: Exception caught. "+(Boolean(e)?String(e):""))}}function d(b){a.push(b)}}function B(c){var j=this,a={};this._map=a;function b(a){return c==null?a:c(a)}this.contains=d;function d(c){return a.hasOwnProperty(b(c))}this.get=h;function h(e){var c,d=b(e);if(a.hasOwnProperty(d))c=a[d];else c=void 0;return c}this.set=i;function i(d,c){return a[b(d)]=c}this.remove=f;function f(d){var c=b(d);if(a.hasOwnProperty(c))delete a[c]}this.reset=g;function g(){a={}}this.foreach=e;function e(c){for(var b in a)if(a.hasOwnProperty(b))if(Boolean(c(a[b])))break}}function i(c,d){B.call(this,d);var a=this,e=a.get;this.get=b;function b(b){var d;if(a.contains(b))d=e.call(a,b);else d=a.set(b,c(b));return d}}i.prototype=new B(null);z.prototype={Commit:function(a){a()},Cancel:function(){}};function z(a){this.Commit=a}function T(c){var h=0,a=[],b=false,d=false;function e(){c!=null&&!b&&c();c=null;a=[]}function g(c){function d(){if(b)return;if(c<a.length&&!a[c].done){a[c].done=true;++h==a.length&&e()}else f("OnActionCompleted: invalid or duplicate index "+String(c))}return d}this.AddAction=function(e){var c=!d&&!b;c&&a.push({action:e,done:false});return c};this.Cancel=function(){b=true;e()};this.Commit=function(){if(d)return;d=true;var c=a.length;if(c===0)e();else for(var b=0;b<c;b++)a[b].action.Commit(g(b))}}zb.prototype={IsWebFont:false,Name:"",PreviewFontFaceBlock:""};function zb(){}yb.prototype.CurrentLanguageFont=null;function yb(){}V.prototype={fontFace:null};function V(a){this.fontFace=a.CurrentLanguageFont}E.prototype={backgroundImageUri:"",CacheToken:null,ColorNames:null,ForegroundImageRules:null,GetColorForApplication:function(){return null},GetThemeFontByName:function(){return null},IsDefault:false,NoImageRecoloring:false,SetColor:function(){return null}};function E(b){var x=[.95,.85,.75,.65,.5],y=[.5,.65,.75,.85,.95],c=[.2,.4,.6],v=[.75,.5],C=[.1,.25,.5,.75,.9],B=[.9,.75,.5,.25,.1],z=.2,w=.8,g={Lightest:1,Lighter:2,Medium:3,Darker:4,Darkest:5},d={},j={};function A(c){var b,a=c;if(typeof a=="string"||a instanceof String)b=q(String(a));else if("DefaultColor"in a)b=a.DefaultColor;else if("R"in a&&"G"in a&&"B"in a)b=a;return b}function u(){if(b==null||b.Palette==null||b.Palette.Colors==null)throw new Error("Invalid theme data");var a=b.Palette.Colors;for(var c in a)a.hasOwnProperty(c)&&n(c,a[c])}if(b==null)b={IsDefault:true,NoImageRecoloring:true};else u();var i=b.ThemeCacheToken;if(i!=null)this.CacheToken=String(i);this.NoImageRecoloring=Boolean(b.NoImageRecoloring)||!o();this.IsDefault="IsDefault"in b?Boolean(b.IsDefault):this.NoImageRecoloring;this.backgroundImageUri=k(b.BackgroundImageUri);this.ColorNames={};if(b.ColorNames!=null)this.ColorNames=b.ColorNames;this.ForegroundImageRules=new m;b.ForegroundImageRules!=null&&this.ForegroundImageRules.AddRules(b.ForegroundImageRules);var e={};if(Boolean(b.Fonts)&&Boolean(b.Fonts.FontSlots))e=b.Fonts.FontSlots;this.GetThemeFontByName=t;function t(a){var b=null;if(e.hasOwnProperty(a))b=new V(e[a]);return b}this.SetColor=n;function n(b,c){var a=A(c);if(a!=null)d[b]=a;else f("Invalid theme color. Name: "+b)}this.GetColorForApplication=s;function s(d){var c=null,m=d.themeColor;if(Boolean(m)){c=p(m);if(c==null)return null}else c=q(d.color);var e=Number(d.themeShade),g=Number(d.themeTint),k=e>0&&e<=1,l=g>0&&g<=1;if(Boolean(b.IsInverted)){e=1-e;g=1-g}if(k||l){var j=h.FromRgba(c);k&&j.Darken(e);l&&j.Lighten(g);c=j.ToRgbaColor()}var i=Number(d.opacity);if(i>=0){if(i>1){f("Opacity in CSS theming annotation was out of range. Opacity must be between 0 and 1.");i=1}c=new a(c.R,c.G,c.B,Math.floor(255*i))}return c}function p(c){var a=d[c];if(a==null){a=j[c];if(a==null){var b=c.split("-");if(b.length>1){a=l(b[0],b[1]);if(a==null)a=l("Content"+b[0],b[1]);j[c]=a}}}return a}function l(j,k){var f=d[j],g=r(k);if(f==null||g==0)return f;var e=g-1,b=h.FromRgba(f),i=b.getLuminance();if(a.Equals(f,a.White))b.Darken(x[e]);else if(a.Equals(f,a.Black))b.Lighten(y[e]);else if(i<z)b.Lighten(C[e]);else if(i>w)b.Darken(B[e]);else if(e<c.length)b.Lighten(c[e]);else b.Darken(v[e-c.length]);f=b.ToRgbaColor();return f}function r(a){return g.hasOwnProperty(a)?g[a]:0}}function sb(a){while(a.lastChild!=null)a.removeChild(a.lastChild)}function w(a){var b;a!=null&&(b=a.parentNode)!=null&&b.removeChild(a)}function G(a,c){var b=false;if(a!=null)try{if(typeof a.styleSheet!="undefined"&&a.styleSheet!=null&&typeof a.styleSheet.cssText!="undefined"){a.styleSheet.cssText=c;b=true}}catch(d){}return b}function J(a,b){var c=G(a,b);if(!c){sb(a);a.appendChild(document.createTextNode(b))}}Theming.GetPageManager=function(){var a=null;function b(){if(a==null)a=new pb;return a}return b}();function pb(){var Fb=this,a=null,b=new B(null),u="data-ThemingId",g=S(),k=new i(function(){return new H(null,null)},null),cb=new R,Bb=new W,Gb=new W,x=false,c=false,j=false,l=false,h,d=null,Z=new y,Y=new y,m=typeof window.MutationObserver==="function"?new MutationObserver(jb):null;this.AddCssLink=db;this.AddCssText=Db;this.CancelTheming=bb;this.GetCacheToken=xb;this.GetColorFromPalette=sb;this.GetCurrentStyleSheetText=gb;this.GetThemedImageSrc=tb;this.GetThemedStyleSheets=ob;this.LoadThemableResources=lb;this.RegisterAllImages=ub;this.RegisterCssReferences=mb;this.RegisterImage=yb;this.SetTheme=fb;this.SuspendTheming=ab;this.WhenReady=Eb;this.WhenImagesThemed=wb;function sb(c,e){var d=null,b=null;if(a!=null&&Boolean(c))b=a.GetColorForApplication({themeColor:c,opacity:e});if(b!=null)d=A(b);return d}function xb(){var b=null;if(a!=null)b=a.CacheToken;return b}function Eb(a){if(c&&!j)a();else Z.push(a)}function wb(a){if(c&&!j)a();else Y.push(a)}function Ab(){return{}}function S(){return new i(Ab,null)}function v(b,a){return s(b)+"\f"+a}function jb(){!e()&&q()}function nb(){if(m!=null&&!e()){m.disconnect();document.body!=null&&m.observe(document.body,{childList:true,attributes:true,subtree:true,attributeFilter:["src"]})}}function pb(){m!=null&&m.disconnect()}function ab(){n()}function n(){c=false;pb();!Boolean(window.addEventListener)&&window.detachEvent("onunload",n)}function kb(){c=true;if(Boolean(window.addEventListener))window.addEventListener("unload",n,false);else window.attachEvent("onunload",n);nb()}function ib(b){var a=c;c=false;try{b()}finally{c=a}}function r(){return(a==null||a.IsDefault)&&!x}function e(){return r()||a==null||a.NoImageRecoloring}function P(){var a=[],d=S();b.foreach(function(b){if(!b.HasValidNode()){a.push(b.url);b.CleanUp()}});for(var e=a.length,c=0;c<e;c++)b.remove(a[c]);g.foreach(function(a){a.img.parentNode!=null&&d.set(a.img.getAttribute(u),a)});g=d}function qb(){var a=0,c=0;b.foreach(function(b){if(b.pendingApply){b.Apply();a++}});g.foreach(function(a){if(a.pendingApply){a.Apply();c++}});return{cssLinks:a,images:c}}function rb(){b.foreach(function(a){a.Reset()});g.foreach(function(a){a.Reset()});k.reset()}function bb(){ab();j=false;if(d!=null){d.Cancel();d=null}}var M=Q(D);function D(){M(true);if(j)return;j=true;n();p();l=false;d=new T(function(){qb();j=false;d=null;if(l){D();return}kb();Z.execute();p();(!l||e())&&Y.execute()});b.foreach(function(a){a.NeedsUpdate()&&d.AddAction(a)});if(e()){d.Commit();return}function f(c){var b=new C(c,cb,a);d.AddAction(b);return b}var c=new i(f,s),h=a!=null&&a.ForegroundImageRules!=null&&!e();g.foreach(function(b){if(b.NeedsUpdate()){var d=b.originalSrc,e=b.hashOverride,i=v(d,e),j=k.contains(i),f=k.get(i);if(f.updatedSrc!=null)b.StoreUpdatedSrc(f.updatedSrc);else{var l=c.contains(d),g=c.get(d);!l&&h&&g.AddRules(a.ForegroundImageRules.GetRulesForUrl(d));g.AddCallback(e,b.StoreUpdatedSrc);!j&&g.AddCallback(e,f.StoreUpdatedSrc)}}});d.Commit()}function q(){l=true;c&&M()}function fb(b){var c=a==null||b==null||a.CacheToken!=b.CacheToken;if(j){if(h!=null){clearTimeout(h);h=null}if(c)h=setTimeout(function(){bb();fb(b)},0);return}if(h!=null){clearTimeout(h);h=null}a=b!=null?b:new E(null);a.NoImageRecoloring=a.NoImageRecoloring||!o();P();c&&rb();D()}function lb(){b.foreach(function(a){a.PrepareForTheming(false)})}function X(b){var a=document.createElement("style");a.type="text/css";if(b!=null&&b.parentNode!=null)a=b.parentNode.insertBefore(a,b);else{var c=document.getElementsByTagName("head")[0];a=c.appendChild(a)}return a}function N(c){var a=b.get(c);if(a!=null&&!a.HasValidNode()){a=null;P()}return a}function db(b,d,e,h,c){var a,f=N(b);if(f==null){a=X(e);a.setAttribute("data-ThemingSource",b);x=x||c!=null||/^[A-Za-z0-9+\-.]+:|^\/\//.test(b);var g=c!=null?c:F(b),i=new I(a,b,null,e,h,g);V(i)}else a=f.node;a!=null&&Boolean(d)&&a.setAttribute("data-original-href",d);return a}function Db(c,a,b){if(a==null)a=X();V(new I(a,null,c,null,b))}function mb(i,h){for(var g=0;g<i.length;g++){var a=i[g];if(a==null)continue;var b=a.Url,c=a.OriginalUrl,e=a.Id;if(Boolean(b)){var d=null;if(Boolean(e)){d=document.getElementById(e);if(d==null&&N(b)==null){f("Theming: RegisterCssReferences: getElementById('"+e+"') == null");continue}}var j=null!=h?h(Boolean(c)?c:b):null;db(b,c,d,null,j)}}}function V(a){b.set(a.url,a);if(c)a.CommitAndApply(null);else l=true}var K=Q(p);function ub(a){if(Boolean(a))p();else K()}function z(a){if(a==null)a="";return a.split("#ThemeKey=")}function p(){K(true);if(e())return;function a(){for(var c="data-ThemeKey",f="#",g=document.getElementsByTagName("img"),e=0;e<g.length;e++){var a=g[e],b=a.getAttribute(c);if(b===f)continue;if(b==null&&Boolean(a.src)){var d=z(a.src);if(d.length>1){b=d[1];a.setAttribute(c,b);a.setAttribute("data-ThemeSrc",d[0])}}if(b!=null)Fb.RegisterImage(a,b);else a.setAttribute(c,f)}}ib(a);l&&q()}function yb(b,d){var a=b.getAttribute(u);if(!Boolean(a)){a=Bb.getNext().toString(10);b.setAttribute(u,a)}if(!g.contains(a)){var c=new H(b,d);g.set(a,c);!L(c)&&q()}}function zb(b,d){function c(a){b.SetNewCss(a);d!=null&&d()}if(!Boolean(b.text))return;var f=b.replaceNode;if(r()){c(b.text);return}b.PrepareForTheming(e(),true);b.themableCss.ApplyTheme(c,a)}function gb(d){var c;if(b.contains(d)){var a=b.get(d);if(a!=null)c=a._newCss==null?a.text:a._newCss}return c}t.prototype.cssRules=null;t.prototype.cssText="";t.prototype.rules=null;function t(e,d,c,a){var b=hb(O(a));this.cssRules=this.rules=b;this.cssText=c;this.disabled=false;this.href=e;this.ownerNode=a;this.parentStyleSheet=null;this.title=d;this.type="text/css"}function O(b){var a=b.sheet;if(a==null)a=b.styleSheet;return a}function hb(a){var b=[];if(a!=null)if(a.rules!=null)b=a.rules;else if(a.cssRules!=null)b=a.cssRules;return b}function ob(f){var c=[];if(r())c=document.styleSheets;else{b.foreach(function(a){if(a.url!=null){var b=a.replaceNodeModified||a.replaceNode==null?a.node:a.replaceNode,f=a.replaceNode!=null?a.replaceNode.title:null,d=null;if(a._newCss!=null)d=a._newCss;else if(a.text!=null)d=a.text;else{var e=O(b);if(e!=null)d=e.cssText}(b.sheet!=null||b.styleSheet!=null)&&c.push(new t(a.url,f,d,b))}});if(f){var d=document.styleSheets;if(d!=null)for(var e=0;e<d.length;e++){var a=d[e];a!=null&&a.ownerNode!=null&&!a.ownerNode.disabled&&!a.ownerNode.hasAttribute("data-themingsource")&&c.push(a)}}}return c}function tb(d){var f=d,g=document.createElement("img");g.src=d;var e=z(g.src),h=e[0],a=e[1];if(a==null)a="";var c=v(h,a);if(k.contains(c)){var b=k.get(c);if(Boolean(b.updatedSrc))f=b.updatedSrc}return f}function L(a){var d=false,c=v(a.originalSrc,a.hashOverride);if(k.contains(c)){var b=k.get(c);if(Boolean(b.updatedSrc)){a.StoreAndApplyUpdatedSrc(b.updatedSrc);d=true}}return d}function Cb(b,c){var f=L(b);if(!f&&a!=null&&a.ForegroundImageRules!=null&&!a.NoImageRecoloring){var e=b.originalSrc,g=b.hashOverride,d=new C(e,cb,a);d.AddRules(a.ForegroundImageRules.GetRulesForUrl(e));d.AddCallback(g,b.StoreAndApplyUpdatedSrc);d.Commit(c)}else c!=null&&c()}I.prototype={node:null,url:null,text:null,textLoaded:false,_newCss:null,onTextLoaded:null,pendingApply:false,replaceNode:null,replaceNodeModified:false,themableCss:null,updated:false,fixUrl:function(a){return a},OnApply:function(){},HasValidNode:function(){var a=this.node;return a!=null&&a.parentNode!=null},Cancel:function(){if(this.themableCss!=null){this.themableCss.Cancel();this.themableCss=null}},CleanUp:function(){w(this.node);w(this.replaceNode)},Commit:function(b){var a=this;a.WhenCssTextReady(function(){if(Boolean(a.text))zb(a,b);else{a.SetNewCss(null);b!=null&&b()}})},Apply:function(){var a=this;a.pendingApply=false;a.updated=true;a.themableCss=null;if(a._newCss!=null){var b=a.replaceNode,c=b!=null&&b.rel!=null&&b.rel.toLowerCase()=="stylesheet";if(!c||a.replaceNodeModified||!r()){J(a.node,a._newCss);if(c){a.replaceNodeModified=true;if(!G(b,"")){b.disabled=true;a.replaceNode=null}}}}a.OnApply();delete a.OnApply},CommitAndApply:function(a){var b=this;b.Commit(function(){b.Apply();a!=null&&a()})},SetCssText:function(a){this.text=a;this.textLoaded=true;this.onTextLoaded.execute()},SetNewCss:function(a){this._newCss=a;this.pendingApply=true},NeedsUpdate:function(){return!this.updated},PrepareForTheming:function(b,c){var a=this;a.WhenCssTextReady(function(){if(a.themableCss==null&&(Boolean(c)||a.NeedsUpdate()))a.themableCss=U(a.text,a.fixUrl,b)})},Reset:function(){this._newCss=null;this.themableCss=null;this.pendingApply=this.updated=false;this.Cancel()},WhenCssTextReady:function(a){if(this.textLoaded)a();else this.onTextLoaded.push(a)}};function I(g,c,h,b,e,d){this.node=g;this.url=c;this.text=h;this.replaceNode=b!=null&&b.parentNode!=null?b:null;this.onTextLoaded=new y;if(e!=null)this.OnApply=e;if(d!=null)this.fixUrl=d;var a=this;if(Boolean(c))vb(c,function(b){a.SetCssText(b)},function(b){f("Theming: ("+String(b)+") "+a.url);a.SetCssText(null)});else a.textLoaded=true}function eb(a){return/^data:/i.test(a)}H.prototype={img:null,originalSrc:null,updatedSrc:null,hashOverride:null,pendingApply:false,Apply:function(){var a=this;if(a.pendingApply){a.img.src=a.updatedSrc;a.updatedSrc=a.img.src;a.img.setAttribute("data-UpdatedSrc",a.updatedSrc);a.pendingApply=false}},Commit:function(a){Cb(this,a)},NeedsUpdate:function(){var a=this,b=a.img.src,c=a.updatedSrc;if(!eb(b)){var d=z(b);a.originalSrc=d[0];var e=d[1];a.hashOverride=Boolean(e)?e:""}return a.pendingApply||b==null||c==null||b.charAt(0)!==c.charAt(0)},Reset:function(){this.pendingApply=false;this.updatedSrc=null;this.img.removeAttribute("data-UpdatedSrc")}};function H(b,d){var a=this;this.img=b;this.originalSrc=b!=null?b.src:null;this.hashOverride=d;this.pendingApply=false;this.StoreUpdatedSrc=function(b){a.updatedSrc=b;a.pendingApply=true};this.StoreAndApplyUpdatedSrc=function(b){a.StoreUpdatedSrc(b);a.Apply()};m==null&&b!=null&&Boolean(b.addEventListener)&&b.addEventListener("load",c,true);function c(){var b=a.img.src;if(!eb(b)&&a.updatedSrc!=b){a.originalSrc=b;a.Reset();q()}}}}function C(a,C,n){var D=this,c=new i(function(){return new p},null),B=0,b=null,g=null,j="",r=false,m=false,d=false,e=false,k=false;this.AddCallback=w;this.AddOperation=o;this.AddRules=x;this.GetHashOverride=t;this.Cancel=y;this.Commit=z;this.SetThemeInfo=v;a=I(a);function A(){m=true;h()}function q(){d=true;f("Error loading image file from "+a);h()}function l(){if(r||e)return;try{r=true;b=document.createElement("img");b.onload=A;b.onerror=q;b.src=a}catch(c){q()}}function w(a,b){var d=s(Boolean(a)?a:j),e=c.get(d);e.callbacks.push(b);l()}function x(b){for(var a=0;a<b.length;a++){var c=b[a];o.call(D,c,null)}}function o(a,d){if(e)return;var g=Boolean(a.detach),b=a.hashOverride,h=s(b,g);if(Boolean(b))j=b;var f=c.get(h);f.rules.push(a);if(d!=null){f.callbacks.push(d);l()}}function y(){e=true;c.reset()}function s(b,c){var a;if(b!=null)a="#"+b;else if(c)a="_detached"+B++;else a="_common";return a}p.prototype={rules:[],callbacks:[]};function p(){this.rules=[];this.callbacks=[]}function z(a){if(!k){k=true;g=a}h()}function t(){return j}function v(a){n=a}function u(d){var c=a;try{if(d.length>0&&n!=null)c=C.ThemeImage(b,d,n)}catch(e){}return c}function h(){if(e)return;if(k&&(m||d)){var b=a;c.foreach(function(a){if(!d&&a.callbacks.length>0)b=u(a.rules);for(var c=0;c<a.callbacks.length;c++){var e=a.callbacks[c];e(b)}});g!=null&&g()}else!(m||d)&&l()}}var e={values:{RecolorImage:null,ReplaceColor:null,ReplaceTwoColors:null,ReplaceFont:null,ReplaceBGImage:null,ColorName:null},getRecolorImage:function(){return this.isCommited?this.values.RecolorImage:null},getReplaceColor:function(){return this.isCommited?this.values.ReplaceColor:null},getReplaceTwoColors:function(){return this.isCommited?this.values.ReplaceTwoColors:null},getReplaceFont:function(){return this.isCommited?this.values.ReplaceFont:null},getReplaceBGImage:function(){return this.isCommited?this.values.ReplaceBGImage!=null:false},getColorName:function(){return this.isCommited?this.values.ColorName!=null:false},isCommited:false,commit:function(){this.isCommited=true},clear:function(){this.values.RecolorImage=null;this.values.ReplaceColor=null;this.values.ReplaceTwoColors=null;this.values.ReplaceFont=null;this.values.ReplaceBGImage=null;this.values.ColorName=null;this.isCommited=false}};function s(a){return a==null?null:a.replace(/(?:\s*#.*)|(?:^\s+)|(?:\s+$)|(?:([\?&])rev=[^&]*&)|(?:[\?&]rev=[^&]*$)/gi,"$1").toUpperCase()}function ub(c,a){function b(){var b=c.join("");a(b)}return b}function wb(a){this.GetCommitAction=function(b){return new z(function(c){a(b);c()})}}function Y(a){return{GetCommitAction:function(b){a.SetThemeInfo(b);return a}}}function Ab(){this.lastColorRead=null;this.fontFaceBlocks=[]}function xb(){var b=[""],c=[],d={},a=null,f=new Theming.ImageProcessor,e=new Ab;this.push=function(a){b.push(a)};this.pushThemableString=function(a){var d=b.push(null)-1;c.push(new wb(function(c){b[d]=a(c,e)}))};this.pushThemableImage=function(h,g){var i=b.push(null)-1;function j(a){b[i]=k(a)}var e=s(h),a=null;if(d.hasOwnProperty(e))a=d[e];else{a=new C(h,f,null);d[e]=a;c.push(Y(a))}g!=null&&a.AddOperation(g,j)};this.generateResult=function(h,f){a=new T(ub(b,function(b){a=null;f(b)}));for(var i=c.length,d=0;d<i;d++){var g=c[d];a.AddAction(g.GetCommitAction(h))}a.AddAction(new z(function(a){b[0]=e.fontFaceBlocks.join("");a()}));a.Commit()};this.cancel=function(){a!=null&&a.Cancel();a=null}}S.prototype.ApplyTheme=function(){};S.prototype.Cancel=function(){};function S(){}function tb(b,a,c,d){if(a==null){b(c);return}var e=U(c,d,a.NoImageRecoloring);e.ApplyTheme(b,a)}function U(z,o,i){var a=new xb,y=Theming.CssLexing.lexer(z),b=Theming.CssLexing.token_kind,d;i=Boolean(i);function h(c,d,f,a){var g=null;if(Boolean(c)){var b=c.indexOf(d),e=c.indexOf(f,b+d.length);if(b>=0&&e>=b){a=Boolean(a);var h=b+(a?0:d.length),i=e+(a?f.length:0);g=c.substring(h,i)}}return g}var n="progid:DXImageTransform.Microsoft.gradient",q="progid:DXImageTransform.Microsoft.AlphaImageLoader";function t(b){if(e.getReplaceColor()!=null&&b.indexOf(n)>-1){var c=h(b,"(",")");if(Boolean(c)){var d=h(c,"startColorstr=",",");j(d,g.gradient)}else a.push(b);return}if(e.getReplaceBGImage()&&b.indexOf(q)>-1){a.pushThemableString(function(a){if(!Boolean(a.backgroundImageUri))return"none";else{var c=h(b,"src='","'",true);return b.replace(c,"src='"+a.backgroundImageUri+"'")}});return}if(e.getColorName()){a.pushThemableString(function(d,c){var a=c.lastColorRead;return a!=null&&a.getColor()!=null?'"'+fb(c.lastColorRead.getColor(),d.ColorNames)+'"':b});return}a.push(b)}function r(b){if(i){a.push(b);return}a.pushThemableImage(b,e.getRecolorImage())}var l={};function w(a){var b=a;if(o!=null&&Boolean(a)&&a!="none"&&a!="inherit"&&a.charAt(0)!="#")if(l.hasOwnProperty(a))b=l[a];else b=l[a]=o(a);return b}function m(a){return Boolean(a)?'url("'+k(a)+'")':"none"}function v(d){var c=I(d),b=w(c);if(!Boolean(b))b=c;if(e.getReplaceBGImage())a.pushThemableString(function(a){return!Boolean(a.backgroundImageUri)?m(b):m(a.backgroundImageUri)});else{a.push('url("');if(e.getRecolorImage()!=null)r(b);else a.push(k(b));a.push('")')}}function j(i,d){function h(a,b){switch(b){case g.rgba:return"rgba("+a+")";case g.rgb:return"rgb("+a+")";case g.gradient:return'"'+n+"(startColorstr="+a+", endColorstr="+a+')"';default:return a}}var f=e.getReplaceColor(),b=e.getReplaceTwoColors();if((f==null||!Boolean(f.themeColor)&&!Boolean(f.color))&&(b==null||!Boolean(b.themeColor1)&&!Boolean(b.color1)||!Boolean(b.themeColor2)&&!Boolean(b.color2)))a.pushThemableString(function(b,a){a.lastColorRead=mb(i,d);return h(i,d)});else{var c="",j=f;if(b!=null&&f==null){if(!("colorIndex"in b))c=b.colorIndex="1";else c=b.colorIndex="2";j=new x(b["themeColor"+c],b["color"+c],b["themeShade"+c],b["themeTint"+c],b["opacity"+c])}a.pushThemableString(function(f,e){var a=f.GetColorForApplication(j);if(a!=null){e.lastColorRead=nb(a);var c=d===g.gradient,b=A(a,c);if(c)b=h(b,d);return b}else return h(i,d)})}}function u(c){var b=e.getReplaceFont();a.push("font-family:");Boolean(b)&&Boolean(b.themeFont)&&a.pushThemableString(function(g,f){var a=null,e=g.GetThemeFontByName(b.themeFont);if(e!=null){var c=e.fontFace;c.IsWebFont&&f.fontFaceBlocks.push(c.PreviewFontFaceBlock);a=c.Name}var d="";if(a!=null)d='"'+a.replace('"','\\"')+'",';return d});a.push(c)}a:while(true){d=y.getNext();var c=d.text;switch(d.kind){case b.comment:s(c);break;case b.colon:e.commit();a.push(c);break;case b.font_family:e.commit();u(c);break;case b.right_curly:case b.semicolon:a.push(c);e.clear();break;case b.url:v(c);break;case b.rgb:case b.rgba:j(c,d.kind);break;case b.color:j(c,d.kind);break;case b.string:t(c);break;case b.text:default:if(!Boolean(c))break a;a.push(c)}}return{ApplyTheme:function(b,c){a.generateResult(c,b)},Cancel:function(){a.cancel()}};function s(i){var j=/^\/\*\s*\[(\w+)(?:\(\s*([^\)]+)\s*\))?\]\s*\*\/$/,d=j.exec(i),g=false,b=null,c=null,h=e.values;if(d!=null){b=d[1];c=d[2]}if(b in h)try{h[b]=b==="ColorName"||b==="ReplaceBGImage"?{}:p(c);g=true}catch(k){f("Failed to parse theme attribute: "+c)}!g&&a.push(i)}function p(value){var parsed=null;if(value==null)parsed={};else eval("parsed={"+value+"}");return parsed}}};