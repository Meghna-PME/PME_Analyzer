function $_global_dragdrop(){if("undefined"==typeof g_all_modules)g_all_modules={};g_all_modules["dragdrop.js"]={version:{rmj:16,rmm:0,rup:24016,rpr:12006}};typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkBegin_dragdrop.js");DragDropMode={NOTSUPPORTED:-1,IE8:0,IE9:1,HTML5:3};DragDropType={DRAGGABLE:0,DROPPABLE:1};DragDropLoggingLevel={NONE:-1,ALL:0,ALLEVENT:1,SPEVENT:2};g_spDragImageClass="ms-dragimage-div";g_dropSurfaceId="sp-dropsurface-div";g_dropSurfaceClass="ms-dropsurface-div";g_dropSurfaceClass_IE="ms-dropsurface-div-ie";g_DragIDAttrName="DragId";g_DropIDAttrName="DropId";g_lastUpdateMeter=0;g_ariaProgInfoId="ms-dnd-progressARIA_Text";SPDragDropManager={DragDropMode:GetDragDropMode(),LoggingLevel:DragDropLoggingLevel.ALL,LastID:0,Draggables:[],Droppables:[],ObjectDragged:undefined,ObjectDropped:undefined,ObjectEntered:undefined,DragStartPos:undefined,GetDragID:function(a){return!fIsNullOrUndefined(a)&&Boolean(a.getAttribute)?a.getAttribute(g_DragIDAttrName):undefined},GetDropID:function(a){return!fIsNullOrUndefined(a)&&Boolean(a.getAttribute)?a.getAttribute(g_DropIDAttrName):undefined},SetDragID:function(a){!fIsNullOrUndefined(a)&&Boolean(a.setAttribute)&&a.setAttribute(g_DragIDAttrName,String(SPDragDropManager.LastID++))},SetDropID:function(a){!fIsNullOrUndefined(a)&&Boolean(a.setAttribute)&&a.setAttribute(g_DropIDAttrName,String(SPDragDropManager.LastID++))},InitObject:function(g,b,d,f,c){if(SPDragDropManager.DragDropMode==DragDropMode.NOTSUPPORTED)return;var a;if(g==DragDropType.DRAGGABLE){a=SPDragDropManager.Draggables[b];if(fIsNullOrUndefined(a))a=new SPDraggable(b,d);!fIsNullOrUndefined(a)&&SPDragDropManager.SetDragID(b)}else if(g==DragDropType.DROPPABLE){a=SPDragDropManager.Droppables[b];if(fIsNullOrUndefined(a))a=new SPDroppable(b,d);!fIsNullOrUndefined(a)&&SPDragDropManager.SetDropID(b)}else return;if(!fIsNullOrUndefined(a)){!fIsNullOrUndefined(f)&&a.SetOptions(f);if(!fIsNullOrUndefined(c))for(var e in c)a.AddEventListener(e,c[e])}return a},GetDraggable:function(b){var a=SPDragDropManager.GetDragID(b);return!fIsNullOrUndefined(a)?SPDragDropManager.Draggables[a]:undefined},GetDroppable:function(b){var a=SPDragDropManager.GetDropID(b);return!fIsNullOrUndefined(a)?SPDragDropManager.Droppables[a]:undefined},InitDraggable:function(b,f,g,d){if(fIsNullOrUndefined(b))return undefined;var a=SPDragDropManager.InitObject(DragDropType.DRAGGABLE,b,f,g,d);if(fIsNullOrUndefined(a))return undefined;var c=SPDragDropManager.GetDragID(b);if(!fIsNullOrUndefined(c))SPDragDropManager.Draggables[c]=a;a.Enabled()&&a.Activate();var e=a.GetOption("avoidClass");!e&&addClass(b,"ms-draggable");return a},InitDroppable:function(a,f,g,d){if(fIsNullOrUndefined(a))return undefined;var b=SPDragDropManager.InitObject(DragDropType.DROPPABLE,a,f,g,d);if(fIsNullOrUndefined(b))return undefined;var c=SPDragDropManager.GetDropID(a);if(!fIsNullOrUndefined(c))SPDragDropManager.Droppables[c]=b;var e=b.GetOption("avoidClass");if(!e){addClass(a,"ms-droppable");a.setAttribute("aria-dropeffect","move")}return b}};SPProgressMeter={CreateMeter:function(c){var b=document.createElement("DIV");b.className="ms-progress-meter";var a=document.createElement("DIV");a.className="ms-progress-meter-inner";a.style.width=String(c)+"%";if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169)){a.setAttribute("role","progressbar");a.setAttribute("aria-valuemin","0");a.setAttribute("aria-valuemax","100");a.setAttribute("aria-valuenow","0");g_lastUpdateMeter=0}b.appendChild(a);return b},SetProgress:function(b,c){if(fIsNullOrUndefined(b)||!hasClass(b,"ms-progress-meter",true)||fIsNullOrUndefined(b.firstChild))return;var a=c;if(a<0||a>100)a=0;b.firstChild.style.width=String(a)+"%";if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169)&&(a-g_lastUpdateMeter>20||a==100&&a!=g_lastUpdateMeter)){g_lastUpdateMeter=a;b.firstChild.setAttribute("aria-valuenow",a.toString());b.focus()}},SetProgressAriaInfo:function(d,e,c){var a=document.getElementById(g_ariaProgInfoId);if(!fIsNullOrUndefined(a)){var f="<span role='alert'>{0}</span>",b;if(d+e+c==0&&a.innerHTML!=Strings.STS.L_UploadingStart_AriaLabel)b=String.format(f,Strings.STS.L_UploadingStart_AriaLabel);else if(a.innerHTML!=String.format(Strings.STS.L_UploadingComplete_AriaLabel,d,e,c))b=String.format(f,String.format(Strings.STS.L_UploadingComplete_AriaLabel,d,e,c));a.innerHTML=b}},RemoveProgressAriaInfo:function(){var a=document.getElementById(g_ariaProgInfoId);if(!fIsNullOrUndefined(a))a.style.display="none"}};g_dragdroplog=[];g_fileErrorDetailHTML="<div class='ms-core-form-section'><div class='ms-core-form-line'><h3>{0}</h3></div><div class='ms-core-form-line'>{1}</div></div>";docIconClass="ms-vb-icon";titleClass="ms-vb-title";g_dndDocItemFolderKey="sp-dragdrop-item-folder";g_dndDocItemQLLib="sp-dragdrop-item-qllib";g_dndListItemQL="sp-dragdrop-listitem-ql";SupportMoveFolder=Flighting.VariantConfiguration.IsExpFeatureClientEnabled(226);ExpectedErrorType=["MoveFolderToItself","CanNotOverwriteExistingFolder"];SPDragDropMoveHelper={getDragDropItemType:function(a){if(Boolean(a))if(IsMountPoint(a))return SPDragDropItemType.MOUNTPOINT;else if(a.FSObjType=="0")return SPDragDropItemType.FILE;else if(a.FSObjType=="1")if(IsListItemFolder(a))return Number(a.PrincipalCount)>=1?SPDragDropItemType.SHAREDFOLDER:SPDragDropItemType.FOLDER;else if(Boolean(a.HTML_x0020_File_x0020_Type)&&a.HTML_x0020_File_x0020_Type.indexOf("OneNote.Notebook")!=-1)return SPDragDropItemType.ONENOTE;return SPDragDropItemType.LIBRARY},getListItemFromDragDrop:function(e,b){if(Boolean(b)){var c=b.GetElement();if(Boolean(c)){var d=GetParentIID(c);if(Boolean(d)){var a=GetIIDObject(d);if(Boolean(a)&&Boolean(a.itemId))return GetListItemByID(e,a.itemId)}}}return null}};SPDragDropItemType={INVALID:"Invalid",LIBRARY:"Library",FILE:"File",ONENOTE:"OneNote",FOLDER:"Folder",SHAREDFOLDER:"SharedFolder",MOUNTPOINT:"MountPoint"};DragMoveMonitorProperties=function(){};DragMoveMonitorProperties.prototype={listTemplateType:undefined,inRemoteWeb:false,srcItemType:SPDragDropItemType.INVALID,destinationItemType:SPDragDropItemType.INVALID,errorType:undefined,errorMessage:undefined};g_docItemDragImageID="ms-dragdoc-image-div";g_docItemDragImageInnerHTML='<img class="ms-verticalAlignMiddle" src="/_layouts/15/images/icgen.gif?rev=47"/><span class="ms-dragdoc-image-text ms-verticalAlignMiddle">'+Strings.STS.L_DragDropDocItemMoveText+"</span>";g_docItemDataKey="SPDocItemDragData";g_outWindowBefore=false;g_dragDownloadStarted=false;DragUploadControl.prototype={elmDropTargetElement:undefined,activeXObj:undefined,elmProgressBar:undefined,strSiteUrl:undefined,strSiteRelativeUrl:undefined,strListName:undefined,strRootFolder:undefined,strDestinationUrl:undefined,fOverwriteAll:undefined,fHideProgressBar:undefined,status:undefined,files:undefined,fInlineProgress:undefined,fInlineDisplayError:undefined,fInlineDisplayStarted:undefined,schemaFieldsXml:undefined,processedCount:undefined,succeededCount:undefined,failedCount:undefined,warnedCount:undefined,progress:undefined,cctask:undefined,refreshFunc:undefined,preUploadFunc:undefined,postUploadFunc:undefined,checkPermissionFunc:undefined,checkInComment:undefined};FileElement.prototype={fileName:undefined,fileSize:undefined,type:undefined,droppedFile:undefined,overwrite:undefined,status:undefined,statusText:undefined,subFolder:undefined,relativeFolder:undefined,isFolder:undefined,existsOnServer:undefined,bytesUploaded:undefined};FileElement.ScrubbingReplacer=function(a,b){return a==="fileName"||a==="droppedFile"||a==="droppedFile"||a==="subFolder"||a==="relativeFolder"||a==="isFolder"?undefined:b};UploadState.prototype={status:undefined,files:undefined,uploadQueue:undefined,totalBytes:undefined,totalBytesProcessed:undefined,totalBytesInProgress:undefined,uploadingCount:undefined,percentDone:undefined,succeededCount:undefined,failedCount:undefined,warnedCount:undefined,conflictFiles:undefined,cancelConfirm:undefined,lastRefreshTime:undefined,checkedOutCount:undefined,bFromUploadDialog:undefined,fInRefresh:undefined};UploadType={NOT_SUPPORTED:0,ACTIVEX:1,ACTIVEXNA:2,HTML5:3};ControlStatus={IDLE:0,ENTERED:1,DROPPED:2,UPLOADING:3,UPLOADED:4};FileStatus={INVALID:-1,PENDING:0,SKIP:1,READING:2,READ:3,UPLOADING:4,UPLOADED:5,FAILED:6,WARNING:7};ProgressMessage={EMPTY:0,VALIDATION:1,UPLOADING:2,UPLOADED:3,CANCELLED:4};UploadStatus={PENDING:0,VALIDATING:1,VALIDATED:2,IN_READ_UPLOAD:3,FINISHED:4,CANCELLED:5};CancelConfirmationStatus={UNCONFIRMED:0,CONFIRMEDYES:1,CONFIRMEDNO:2};C_MEGABYTES=1024*1024;C_LARGE_FILESIZE=Flighting.VariantConfiguration.IsExpFeatureClientEnabled(458)?30*C_MEGABYTES:100*C_MEGABYTES;C_UPLOAD_CHUNKSIZE=8*C_MEGABYTES;C_MAX_FILESIZE=2047*C_MEGABYTES;C_MAX_TOTALFILESIZE=2047*C_MEGABYTES;C_MAX_REQUESTSIZE=2047*C_MEGABYTES;C_MAX_FILECOUNT=100;C_MIN_REFRESH_INTERVAL=300;g_uploadType=getUploadType();g_inplaceDisplay=false;g_uploadCtl=[];g_currentControl=null;g_ClientSource="";DragUploadControl.prototype.Initialize=DUCInitialize;DragUploadControl.prototype.BindDragDrop=DUCBindDragDrop;c_dropBoxDivID="ms-dnd-dropbox";c_dropBoxTextID="ms-dnd-dropboxText";c_activeXObjectID="ms-dnd-activeX";c_activeXCLSID="CLSID:9ED13477-E909-45BC-BADC-2106D04D6BD7";c_uploadingMsgID="ms-dnd-uploading-msg";UploadState.prototype.UpdateProgress=function(){this.totalBytesInProgress=0;if(this.totalBytes>0)this.percentDone=this.totalBytesProcessed/this.totalBytes;else this.percentDone=1;this.percentDone<1&&UpdateProgressBar(ProgressMessage.UPLOADING,this);if(this.percentDone==1)this.status=UploadStatus.FINISHED;RefreshResult(this)};c_progInfoID="_progInfo";c_progInfoClass="ms-dnd-progressInfo";c_progInfoClassInline="ms-dnd-progressInfo-inline ms-textLarge";c_progInfoTableID="ms-dnd-progressInfoTb";c_progInfoTableClass="ms-dnd-progressInfoTb";c_progMessageClass="ms-dnd-progressMessage";c_progIconID="ms-dnd-progressIcon";c_progTextID="ms-dnd-progressText";c_progLargeFileID="ms-dnd-largefileText";c_progCancelBtnID="ms-dnd-progressCancelBtn";c_progRefreshBtnID="ms-dnd-progressRefreshBtn";C_detailRowId="ms-dnd-error-detailrow";C_progImgClass="ms-dnd-progressImg";c_progMeterTdID="ms-dnd-progressMeterTd";c_progMeterID="ms-dnd-progressMeter";c_progInfoCloseID="ms-dnd-progressClose";c_progAriaTextID="ms-dnd-progressARIA_Text";c_progTableHTML="<div id='{0}' class='ms-table "+c_progInfoTableClass+"'><div class='ms-tableRow'><div class='ms-tableCell "+C_progImgClass+"'><img id='{1}' class='ms-verticalAlignMiddle'/></div><div class='ms-tableCell {5}'><span id='{2}'></span> <a id='{3}' href='#' onclick='cancelTask();'>{4}</a> <a id='{6}' href='#' onclick='FullRefresh(g_currentCtx);'>{7}</a></div></div></div>";if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169))c_progTableHTMLInline="<table id='{0}' class='"+c_progInfoTableClass+"' cellpadding='0' cellspacing='0'><tr><td class='{5}'><span id='{1}'></span></td><td role='progressbar' aria-live='assertive' aria-relevant='all' id={2}></td><td><a class='ms-commandLink' id='{3}' href='#' onclick='cancelTask();'>{4}</a></td><td><a class='ms-commandLink' id='{6}' href='#' onclick='CloseProgressBar(this, \"{7}\");'>{8}</a></td></tr></table>";else c_progTableHTMLInline="<table id='{0}' class='"+c_progInfoTableClass+"' cellpadding='0' cellspacing='0'><tr><td class='{5}'><span id='{1}'></span></td><td id={2}></td><td><a class='ms-commandLink' id='{3}' href='#' onclick='cancelTask();'>{4}</a></td><td><a class='ms-commandLink' id='{6}' href='#' onclick='CloseProgressBar(this, \"{7}\");'>{8}</a></td></tr></table>";c_failedLinkABegin="<a href='#' onclick='ShowHideErrorDetails(this, event);'>";c_failedLinkAllErrorsABegin="<a href='#' onclick='ShowAllErrorDetailsInDialog();'>";c_doRestDiv="<div class='ms-dnd-dlg-doRestDiv'><input type='checkbox' id='ms-conflictDlgDoRest'/><label for='ms-conflictDlgDoRest'>{0}</label></div>";c_conflictButtons="<div class='ms-core-form-bottomButtonBox'><button id='ms-conflictDlgReplaceBtn' onclick='DismissConflictDlg(this, event)' href='#'>{0}</button><button id='ms-conflictDlgNoUploadBtn' onclick='DismissConflictDlg(this, event)' href='#'>{1}</button></div>";C_DETAILDIVID="ms-uploadDetailsDiv";C_ERRTABLE="ms-table ms-dnd-err ms-status-red";C_ERRITEM="ms-dnd-err-itm";C_ERRITEMNAME="ms-dnd-err-itmName";C_ERRITEMMSG="ms-verticalAlignMiddle";pluginID="spDragDownloadPlugin";downloadAXID="sp-dragdwld-actx";UploaderStatus={PENDING:0,VALIDATING:1,VALIDATED:2,IN_READ_UPLOAD:3,FINISHED:4,CANCELLED:5,CHUNKFAILED:11,CHUNKUPLOADED:12,CANCELLING:13};FilesUploader.prototype={files:undefined,rootFolder:undefined,useChunkUpload:undefined,chunkSize:undefined,chunkNumber:undefined,chunkBytesToSend:undefined,chunkBlob:undefined,request:undefined,uploadMethod:undefined,uploadId:undefined,status:undefined,retryCount:undefined,maxRetryCount:undefined,requestStartTime:undefined,retryInterval:undefined,retryTimerId:undefined,requestTimeoutMs:undefined,progressUpdater:undefined};FilesUploader.prototype.startUpload=function(b){var a=this;if(fIsNullOrUndefined(a.uploadId))a.uploadId=SP.Guid.newGuid();SP.QoS.ExecuteMonitoredAsync("FilesUploaderStartUpload","FilesUploaderStartUploadStart","FilesUploaderStartUploadSuccess","FilesUploaderStartUploadUnexpected","FilesUploaderStartUploadNoTag",function(e,c){if(fIsNullOrUndefined(a.files)){c(this,{tag:"FilesUploaderStartUploadNoFiles"});return}if(a.status!==UploaderStatus.PENDING){c(this,{tag:"FilesUploaderStartUploadNotPending",status:a.status});return}if(a.useChunkUpload){a.files.length!==1&&c(this,"FilesUploaderStartUploadIncorrectNumberOfFiles");var d=a.files[0];if(!fIsNullOrUndefined(d)&&d.fileSize<a.chunkSize)a.chunkBytesToSend=Math.floor(d.fileSize/2);else a.chunkBytesToSend=a.chunkSize;a.chunkUpload(b,e,c)}else a.formUpload(b,e,c)},function(c,b,a){a.Success(b)},function(d,a,c){var b=a.tag;if(fIsNullOrUndefined(b))b="UndefinedExpectedFailureTag";a.tag=undefined;c.ExpectedFailure(b,a)},{useChunkUpload:a.useChunkUpload,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()})};FilesUploader.prototype.continueUpload=function(b){var a=this;a.progressUpdater.updateProgressBar();if(a.useChunkUpload)if(a.status===UploaderStatus.CHUNKUPLOADED||a.status===UploaderStatus.CHUNKFAILED)SP.QoS.ExecuteMonitoredAsync("FilesUploaderContinueUpload","FilesUploaderContinueUploadStart","FilesUploaderContinueUploadSuccess","FilesUploaderContinueUploadUnexpected","FilesUploaderContinueUploadNoTag",function(d,c){a.chunkUpload(b,d,c)},function(c,b,a){a.Success(b)},function(d,a,c){var b=a.tag;if(fIsNullOrUndefined(b))b="UndefinedExpectedFailureTag";a.tag=undefined;c.ExpectedFailure(b,a)},{status:a.status,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});else return;else return};FilesUploader.prototype.cancelUpload=function(){var a=this;SP.QoS.ExecuteMonitoredAsync("FilesUploaderCancelUpload","FilesUploaderCancelUploadStart","FilesUploaderCancelUploadSuccess","FilesUploaderCancelUploadUnexpected","FilesUploaderCancelUploadNoTag",function(b,d){a.status=UploaderStatus.CANCELLING;var c=a.request;if(!fIsNullOrUndefined(c)){c.abort();a.request=null}if(a.useChunkUpload)a.cancelUploadSession(b,d);else!fIsNullOrUndefined(b)&&b(a,{type:"FilesUploaderCancelUploadNonChunkUpload",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});a.status=UploaderStatus.CANCELLED},function(c,b,a){a.Success(b)},function(d,a,c){var b=a.tag;if(fIsNullOrUndefined(b))b="UndefinedExpectedFailureTag";a.tag=undefined;c.ExpectedFailure(b,a)},{status:a.status,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()})};c_uploadUrl="/_layouts/15/upload.aspx?IsAJAX=1&List=";FilesUploader.prototype.formUpload=function(b,h,g){var a=this,f=0,m=g_currentControl.strSiteUrl,i="",o=Boolean(g_currentCtx)&&Boolean(g_currentCtx.RealHttpRoot);if(o){m=g_currentCtx.RealHttpRoot;i=ListModule.Util.makeMountedFolderQueryStrParams(false,false)}for(var j=new FormData,k=0;k<a.files.length;k++){var e=a.files[k];j.append(e.fileName,e.droppedFile);e.status=FileStatus.UPLOADING;f+=e.fileSize}j.append("CheckInComment",g_currentControl.checkInComment);var c=new XMLHttpRequest,d=m+c_uploadUrl+g_currentControl.strListName+"&RootFolder=";if(!fIsNullOrUndefined(a.rootFolder))d=d+escapeProperly(a.rootFolder);if(Boolean(i))d=d+i;if(!fIsNullOrUndefined(window._spPageContextInfo)&&!fIsNullOrUndefined(window._spFormDigestRefreshInterval)&&!fIsNullOrUndefined(UpdateFormDigest)){var q=window._spPageContextInfo;UpdateFormDigest(q.webServerRelativeUrl,window._spFormDigestRefreshInterval)}c.open("POST",escapeProperlyCore(d,true),true);c.setRequestHeader("x-requestdigest",document.forms[MSOWebPartPageFormName].__REQUESTDIGEST.value);c.setRequestHeader("ClientSource",g_ClientSource);a.progressUpdater.startProgress(b,f);var p=function(b){Boolean(b.lengthComputable)&&a.progressUpdater.updateProgress(b.loaded)},l=c.upload;typeof l!=="undefined"&&l.addEventListener("progress",p,false);a.requestStartTime=Date.now();var n=0;c.onreadystatechange=function(aEvt){var xmlreq=aEvt.target;if(xmlreq.readyState===4)if(!IsXhrAborted(xmlreq)){var spResponseCorrelationId=xmlreq.getResponseHeader("SPRequestGuid");n=Date.now()-a.requestStartTime;a.speedometer.updateUploadSpeed(f,n);var resp=xmlreq.responseText,respList=null;if(!fIsNullOrUndefined(resp))try{respList=eval("("+xmlreq.responseText+")")}catch(e){respList=null}if(respList==null){var respUrl=xmlreq.responseURL;if(Boolean(respUrl)&&respUrl.toLowerCase().indexOf("accessdenied")!=-1){respList=[];for(var i=0;i<a.files.length;i++)respList.push(Strings.STS.L_NoUploadPermission)}}for(var idx=0;idx<a.files.length;idx++){var _file=a.files[idx],respT;if(!fIsNullOrUndefined(respList))respT=respList[idx];if(xmlreq.status===200&&respT==="1"){_file.status=FileStatus.UPLOADED;b.succeededCount++;if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(755))if(uploadCompleteDelegate!=null)for(var delIdx=0;delIdx<uploadCompleteDelegate.length;delIdx++)uploadCompleteDelegate[delIdx].apply(this,[_file.fileName])}else{_file.status=FileStatus.FAILED;_file.statusText=respT;b.failedCount++}}a.progressUpdater.completeProgress(null);a.request=null;if(xmlreq.status===200)h(a,{type:"FormUploadSuccess",requestCorrelationId:spResponseCorrelationId,succeededCount:b.succeededCount,failedCount:b.failedCount,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});else g(a,{tag:"FormUploadErrorResponseCode",requestCorrelationId:spResponseCorrelationId,requestStatus:xmlreq.status,succeededCount:b.succeededCount,failedCount:b.failedCount,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});a.status=UploaderStatus.FINISHED}else if(a.status===UploaderStatus.CANCELLING||a.status===UploaderStatus.CANCELLED)!fIsNullOrUndefined(h)&&h(a,{type:"FormUploadAbortedByUser",status:a.status,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});else!fIsNullOrUndefined(g)&&g(a,{tag:"FormUploadUnexpectedAbort",status:a.status,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()})};a.status=UploaderStatus.IN_READ_UPLOAD;a.request=c;c.send(j)};FilesUploader.prototype.processServerError=function(){var c=this,b={retryable:true,statusText:c.request.statusText};if(c.request.status===500){var a=JSON.parse(c.request.responseText);if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.error)&&!fIsNullOrUndefined(a.error.code))switch(a.error.code){case"-2130575162, Microsoft.SharePoint.SPException":case"-2147221018, Microsoft.SharePoint.SPException":case"-2130575142, Microsoft.SharePoint.Utilities.SPBITSSessionInProgressException":case"-1, System.IO.PathTooLongException":b.retryable=false;b.statusText=a.error.message.value;break;default:b.statusText=a.error.message.value}}else if(c.request.status===400){b.retryable=false;b.statusText=c.request.responseText}return b};FilesUploader.prototype.onXhrError=function(b){var a=this,f=a.files[0];if(!fIsNullOrUndefined(a.request)){var d=a.request.getResponseHeader("SPRequestGuid"),g=Date.now()-a.requestStartTime;a.logChunkUploadResult(a.request.status,g);var c=a.processServerError(),e=a.request.status;a.request=null;a.chunkBlob=null;if(c.retryable&&a.retryCount<a.maxRetryCount){a.retryCount++;a.requestTimeoutMs=a.requestTimeoutMs*2;a.status=UploaderStatus.CHUNKFAILED;!fIsNullOrUndefined(b)&&b(a,{tag:"ChunkUploadChunkFailedRetrying",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString(),requestCorrelationId:d,retryCount:a.retryCount,requestTimeoutMs:a.requestTimeoutMs,responseCode:e,errorStatusText:c.statusText})}else{f.status=FileStatus.FAILED;f.statusText=c.statusText;a.progressUpdater.completeProgress(false);!fIsNullOrUndefined(b)&&b(a,{tag:"ChunkUploadChunkFailedNoRetry",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString(),requestCorrelationId:d,retryCount:a.retryCount,responseCode:e,errorStatusText:c.statusText});a.cancelUpload()}}};FilesUploader.prototype.chunkUpload=function(n,e,c){var a=this,d=a.files[0];if(d.status===FileStatus.FAILED){!fIsNullOrUndefined(c)&&c(a,{tag:"ChunkUploadFailedFileStatus",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});return}if(a.chunkNumber===0){a.progressUpdater.startProgress(n,d.fileSize);a.progressUpdater.updateProgress(0)}function j(c){if(typeof MSOWebPartPageFormName!=="undefined"){var d=b.getResponseHeader("x-requestdigest");if(!fIsNullOrUndefined(d)){document.forms[MSOWebPartPageFormName].__REQUESTDIGEST.value=d;return}}!fIsNullOrUndefined(c)&&c(a,{tag:"ChunkUploadNoCanary",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()})}var k=function(b){Boolean(b.lengthComputable)&&a.progressUpdater.updateProgress(d.bytesUploaded+b.loaded)},f=function(b,c){if(a.status===UploaderStatus.CANCELLING)!fIsNullOrUndefined(b)&&b(a,{type:"ChunkUploadAbortedByUser",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});else a.onXhrError(c)},h=function(b){a.onXhrError(b)},b=new XMLHttpRequest,g=b.upload;if(typeof g!=="undefined"){g.addEventListener("progress",k,false);g.addEventListener("abort",function(){f(e,c)},false);g.addEventListener("error",function(){f(e,c)},false);g.addEventListener("timeout",function(){h(c)},false)}if(typeof b.addEventListener!=="undefined"){b.addEventListener("abort",function(){f(e,c)},false);b.addEventListener("error",function(){f(e,c)},false);b.addEventListener("timeout",function(){h(c)},false)}else{b.onerror=function(){f(e,c)};b.onabort=function(){f(e,c)};b.ontimeout=function(){h(c)}}b.onreadystatechange=function(){if(b.readyState===4){var f=b.getResponseHeader("SPRequestGuid");if(!IsXhrAborted(b)&&b.status===200){var g=Date.now()-a.requestStartTime;a.request=null;a.chunkBlob=null;a.logChunkUploadResult(b.status,g);a.speedometer.updateUploadSpeed(a.chunkBytesToSend,g);j(c);a.retryCount=0;d.bytesUploaded+=a.chunkBytesToSend;if(d.fileSize>d.bytesUploaded){a.chunkBytesToSend=Math.min(a.chunkSize,d.fileSize-d.bytesUploaded);a.chunkNumber++;a.status=UploaderStatus.CHUNKUPLOADED;!fIsNullOrUndefined(e)&&e(a,{type:"ChunkUploadChunkFinished",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString(),requestCorrelationId:f,chunkSize:a.chunkBytesToSend,chunkNumber:a.chunkNumber})}else{d.status=FileStatus.UPLOADED;a.progressUpdater.completeProgress(true);a.status=UploaderStatus.FINISHED;!fIsNullOrUndefined(e)&&e(a,{type:"ChunkUploadFileFinished",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString(),requestCorrelationId:f,chunkNumber:a.chunkNumber})}}else if(!IsXhrAborted(b))a.onXhrError(c)}};var l=a.generateChunkPostUrl();if(a.retryCount===0){a.requestTimeoutMs=a.speedometer.getEstimatedTimeoutMs(a.chunkBytesToSend);if(a.uploadMethod==="FinishUpload")a.requestTimeoutMs+=10*60*1e3}b.open("POST",l,true);b.timeout=a.requestTimeoutMs;b.setRequestHeader("Accept","application/json;odata=verbose");if(typeof MSOWebPartPageFormName!=="undefined")b.setRequestHeader("x-requestdigest",document.forms[MSOWebPartPageFormName].__REQUESTDIGEST.value);else!fIsNullOrUndefined(c)&&c(a,{tag:"ChunkUploadNoCanaryForm",uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});a.request=b;a.status=UploaderStatus.IN_READ_UPLOAD;var i=function(c){try{a.requestStartTime=Date.now();a.chunkBlob=d.droppedFile.slice(d.bytesUploaded,d.bytesUploaded+a.chunkBytesToSend,d.droppedFile.type);b.send(a.chunkBlob)}catch(e){a.onXhrError(c)}};if(a.retryCount>0){var m=a.retryInterval*Math.pow(2,a.retryCount-1);a.retryTimerId=window.setTimeout(i,m)}else i(c)};FilesUploader.prototype.cancelUploadSession=function(f,d){var a=this,h=a.files[0];if(!fIsNullOrUndefined(a.uploadId)){!fIsNullOrUndefined(a.retryTimerId)&&window.clearTimeout(a.retryTimerId);a.uploadMethod="CancelUpload";var c=new UploadUrlBuilder,m={file:c.encodeStringParameter(a.rootFolder+"/"+h.fileName)},i={DecodedUrl:c.encodeStringParameter(a.rootFolder+"/"+h.fileName)},l=c.toGuidParameter(a.uploadId),k={uploadId:l};c.appendMethodCallWithParameterAliases("getFileByServerRelativePath",i);c.appendMethodCall(a.uploadMethod,k);var j=c.url(),b=new XMLHttpRequest;b.open("POST",j,false);b.setRequestHeader("Accept","application/json;odata=verbose");typeof MSOWebPartPageFormName!=="undefined"&&b.setRequestHeader("x-requestdigest",document.forms[MSOWebPartPageFormName].__REQUESTDIGEST.value);a.requestStartTime=Date.now();var g=0;b.send();if(b.readyState===4){var e=b.getResponseHeader("SPRequestGuid");if(!IsXhrAborted(b))if(b.status===200)!fIsNullOrUndefined(f)&&f(a,{type:"CancelUploadSessionSuccess",requestCorrelationId:e,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});else!fIsNullOrUndefined(d)&&d(a,{tag:"CancelUploadSessionErrorResponseCode",requestCorrelationId:e,responseCode:b.status,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()});else!fIsNullOrUndefined(d)&&d(a,{tag:"CancelUploadSessionRequestAborted",requestCorrelationId:e,uploadId:fIsNullOrUndefined(a.uploadId)?"undefined":a.uploadId.toString()})}g=Date.now()-a.requestStartTime;a.logChunkUploadResult(b.status,g);return}else{d(a,{tag:"CancelUploadSessionNoUploadId"});return}};FilesUploader.prototype.generateChunkPostUrl=function(){var b=this,c=b.files[0],a=new UploadUrlBuilder,m="",g="",j={folder:a.encodeStringParameter(b.rootFolder)},h={DecodedUrl:a.encodeStringParameter(b.rootFolder)},k={file:a.encodeStringParameter(b.rootFolder+"/"+c.fileName)},e={DecodedUrl:a.encodeStringParameter(b.rootFolder+"/"+c.fileName)},d={},l={};if(Boolean(g_currentControl)){var f=a.toGuidParameter(b.uploadId),i=c.fileSize<=c.bytesUploaded+b.chunkBytesToSend;if(b.chunkNumber===0){b.uploadMethod="StartUpload";if(c.existsOnServer===true){a.appendMethodCallWithParameterAliases("getFileByServerRelativePath",e);d={uploadId:f}}else{a.appendMethodCallWithParameterAliases("getFolderByServerRelativePath",h);a.appendPathSegment("files");if(c.overwrite)a.appendMethodCallWithParameterAliases("GetByPathOrAddStub",e);else a.appendMethodCallWithParameterAliases("AddStubUsingPath",e);d={uploadId:f}}}else if(i){b.uploadMethod="FinishUpload";a.appendMethodCallWithParameterAliases("getFileByServerRelativePath",e);d={uploadId:f,fileOffset:c.bytesUploaded}}else{b.uploadMethod="ContinueUpload";a.appendMethodCallWithParameterAliases("getFileByServerRelativePath",e);d={uploadId:f,fileOffset:c.bytesUploaded}}a.appendMethodCall(b.uploadMethod,d);g=a.url()}return g};FilesUploader.prototype.logChunkUploadResult=function(c,d){var a=this,b=a.files[0];if(!a.useChunkUpload)return;EnsureScriptFunc("sp.core.js","SP.SimpleLogger",function(){EnsureScriptFunc("sp.core.js","SP.SlapiInternal",function(){var f=SP.SlapiInternal,g=GetSimpleLogger(),e=new f.LargeFileUploadBrowserEvent;if(!fIsNullOrUndefined(b.type))e.MimeType=b.type;e.FileSize=b.fileSize;e.UploadId=a.uploadId;e.Method=a.uploadMethod;e.ChunkNumber=a.chunkNumber;e.ChunkSize=a.chunkBytesToSend;e.HttpStatus=c;e.UploadTime=d;g.WriteLogForEvents("LargeFileUploadBrowserEvent",e)})})};FilesUploader.prototype.speedometer=function(){var c=8*1024/1e3,b=0,a=0,d=3,e=5*1e3;return{updateUploadSpeed:function(e,d){b+=e;a+=d;if(b>0&&a>0)c=b/a},getEstimatedTimeoutMs:function(a){return e+d*a/c}}}();typeof Sys!="undefined"&&Boolean(Sys)&&Boolean(Sys.Application)&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("DragDrop.js");typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkEnd_dragdrop.js")}var DragDropMode,DragDropType,DragDropLoggingLevel,g_spDragImageClass,g_dropSurface,g_dropSurfaceBase,g_dropSurfaceId,g_dropSurfaceClass,g_dropSurfaceClass_IE,g_DragIDAttrName,g_DropIDAttrName,g_lastUpdateMeter,g_ariaProgInfoId,SPDragDropManager;function SPDragDropBase(k,j,g,h){var i=k,a=j,f=[],b=true,c=[],d=g,e=h;this.GetElement=function(){return i};this.AddLinkKey=function(b){a[b]=""};this.RemoveLinkKey=function(b){delete a[b]};this.GetLinkKeys=function(){return a};this.GetOption=function(a){return f[a]};this.SetOption=function(a,b){if(a in d)f[a]=b};this.SetOptions=function(b){for(var a in b)a in d&&this.SetOption(a,b[a])};this.Enable=function(){b=true};this.Disable=function(){b=false};this.Enabled=function(){return b};this.Remove=function(){};this.AddEventListener=function(d,b){if(d in e&&!fIsNullOrUndefined(b)&&typeof b=="function"){var a=c[d];if(fIsNullOrUndefined(a))a=new Array(0);a.push(b);c[d]=a}};this.FireEvent=function(f,g){if(f in e){var a=c[f];if(!fIsNullOrUndefined(a))for(var d=0;d<a.length;d++){var b=a[d];!fIsNullOrUndefined(b)&&typeof b=="function"&&b(g)}}}}function SPDraggable(y,x){var a=this,o={avoidClass:"",cursor:"",cursorAt:"",delay:"",distance:"",dragImage:"",sensitivity:0},k={spDragStart:"",spDrag:"",spDragEnd:""},d={INACTIVE:0,ENALBED:1,MOUSEDOWN:2,DETECTED:3,STARTED:4,DRAG:5,END:6},b=new SPDragDropBase(y,x,o,k),e=[],z=0,A=0,C,B,w,c={};function v(a){if(fIsNullOrUndefined(a))return;if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){var b=a.tagName;if(b!="A"&&b!="IMG"){addListener(a,"mousedown",i);addListener(a,"mouseup",m)}}else SPDragDropManager.DragDropMode==DragDropMode.HTML5&&a.setAttribute("draggable",true);addListener(a,"dragstart",h);addListener(a,"drag",n);addListener(a,"dragend",l)}function t(a){if(fIsNullOrUndefined(a))return;if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){var b=a.tagName;if(b!="A"&&b!="IMG"){removeListener(a,"mousedown",i);removeListener(a,"mouseup",m)}}else SPDragDropManager.DragDropMode==DragDropMode.HTML5&&a.removeAttribute("draggable");removeListener(a,"dragstart",h);removeListener(a,"drag",n);removeListener(a,"dragend",l)}function i(b){if(fIsNullOrUndefined(b))b=window.event;logeventinfo(b,a,"mousedown");a.Status=d.MOUSEDOWN;addListener(document,"mousemove",j);a._initialMouseX=b.clientX;a._initialMouseY=b.clientY;if(b.srcElement)a._mousedownObj=b.srcElement;loginfo("mousedown, initX:"+a._initialMouseX+",initY:"+a._initialMouseY+",initTime:");cancelDefault(b)}function m(b){if(fIsNullOrUndefined(b))b=window.event;if(Math.abs(b.clientX-Number(a._initialMouseX))<=parseInt(a.GetOption("sensitivity"))&&Math.abs(b.clientY-Number(a._initialMouseY))<=parseInt(a.GetOption("sensitivity")))if(a.Status==d.MOUSEDOWN){if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){g();a._mousedownObj=null}a.Status=d.ENALBED;SPDragDropManager.DragStartPos=undefined;SPDragDropManager.ObjectDragged=null}}function j(b){if(fIsNullOrUndefined(b))b=window.event;if(Math.abs(b.clientX-Number(a._initialMouseX))>parseInt(a.GetOption("sensitivity"))||Math.abs(b.clientY-Number(a._initialMouseY))>parseInt(a.GetOption("sensitivity"))){var c=a._mousedownObj;if(!fIsNullOrUndefined(c)){loginfo("Calling dragDrop() in IE");var e=c.dragDrop()}a.Status=d.DETECTED}}function g(){removeListener(document,"mousemove",j)}function h(b){if(fIsNullOrUndefined(b))b=window.event;logeventinfo(b,this,"onDragStart");loginfo("dragStart x:"+b.clientX+" y:"+b.clientY);var h=new SPPosition(-1,-1);h.X=b.clientX;h.Y=b.clientY;SPDragDropManager.DragStartPos=h;a.Status=d.STARTED;addClass(a.GetElement(),"ms-draggable-dragging");a.GetElement().setAttribute("aria-grabbed","true");SPDragDropManager.ObjectDragged=a;s();if(!fIsNullOrUndefined(a._dragImage))if(b.dataTransfer&&typeof b.dataTransfer.setDragImage=="function"){var l=a._dragImage;l.style.display="";var c=a.GetOption("cursorAt"),j=0,k=0;if(!fIsNullOrUndefined(c)){if(!fIsNullOrUndefined(c.X))j=0-c.X;if(!fIsNullOrUndefined(c.Y))k=0-c.Y}b.dataTransfer.setDragImage(l,j,k)}else{var g=a.GetElement();addClass(g,"ms-draggable-hidden");if(Boolean(g))g.style.display="none"}f("spDragStart",b);e=r();if(!fIsNullOrUndefined(e))for(var i=0;i<e.length;i++){var m=e[i];m.Activate()}if(b.dataTransfer){if(SPDragDropManager.DragDropMode==DragDropMode.HTML5){b.dataTransfer.setData("text/plain","Drag");loginfo("set Data HTML5")}else{b.dataTransfer.setData("TEXT","Drag");loginfo("set Data IE")}b.dataTransfer.effectAllowed="all";b.dataTransfer.dropEffect="copy"}}function n(b){if(fIsNullOrUndefined(b))b=window.event;if(a.Status==d.STARTED){var c=a.GetElement();if(Boolean(c)&&hasClass(c,"ms-draggable-hidden",true)){c.style.display="";removeClass(a.GetElement(),"ms-draggable-hidden")}p(b);f("spDrag",b)}}function l(b){if(fIsNullOrUndefined(b))b=window.event;logeventinfo(b,this,"onDragEnd");if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){g();a._mousedownObj=null}f("spDragEnd",b);if(!fIsNullOrUndefined(e))for(var c=0;c<e.length;c++){var h=e[c];h.Deactivate()}removeClass(a.GetElement(),"ms-draggable-dragging");a.GetElement().removeAttribute("aria-grabbed");a.Status=d.ENALBED;SPDragDropManager.DragStartPos=undefined;SPDragDropManager.ObjectDragged=null;SPDragDropManager.ObjectEntered=null;q()}function f(c,d){if(c in k){var e=new SPDragEvent(d,a,null);b.FireEvent(c,e)}}function r(){var b=SPDragDropManager.Droppables;if(fIsNullOrUndefined(b))return undefined;var c=new Array(0);for(var h in b){var d=b[h],f=d.GetLinkKeys(),e=a.GetLinkKeys(),g=false;if(!fIsNullOrUndefined(f)&&!fIsNullOrUndefined(e))for(var i in e)if(i in f){g=true;break}g&&c.push(d)}return c}var u="ms-dragclone-image-div";function s(){var c=a.GetOption("dragImage");if(fIsNullOrUndefined(c)||c=="default"){a._dragImage=null;return}var b=a._dragImage,d=a.GetElement();if(c=="move")b=null;else if(c=="clone"){if(SPDragDropManager.DragDropMode==DragDropMode.HTML5)return;else if(fIsNullOrUndefined(b)){b=document.createElement("DIV");b.id=u;b.className=g_spDragImageClass;b.style.position="absolute";b.style.height=String(d.clientHeight)+"px";b.style.width=String(d.clientWidth)+"px";var e=d.cloneNode(true);b.appendChild(e);document.body.appendChild(b)}}else if(typeof c=="function")b=c(a.GetElement());if(!fIsNullOrUndefined(b)){b.style.display="none";a._dragImage=b}}function p(d){var c=a._dragImage;if(fIsNullOrUndefined(c))return;var b=a.GetOption("cursorAt"),e=0,f=0;if(b){if(b.X)e=b.X;if(b.Y)f=b.Y}if(typeof d.dataTransfer.setDragImage=="function")return;else{c.style.display="";c.style.position="absolute";var g=d.clientX,h=d.clientY;c.style.left=String(g+e)+"px";c.style.top=String(h+f)+"px"}}function q(){var b=a._dragImage;if(!fIsNullOrUndefined(b)){var c=a.GetOption("dragImage");if(c!="move"){b.style.display="";document.body.removeChild(b)}a._dragImage=null}}this.Status=d.INACTIVE;this.GetBaseObject=function(){return b};this.GetElement=function(){return b.GetElement()};this.AddLinkKey=function(a){b.AddLinkKey(a)};this.RemoveLinkKey=function(a){b.RemoveLinkKey(a)};this.GetLinkKeys=function(){return b.GetLinkKeys()};this.GetOption=function(a){return b.GetOption(a)};this.SetOption=function(a,c){b.SetOption(a,c)};this.SetOptions=function(a){b.SetOptions(a)};this.Disable=function(){b.Disable()};this.Enable=function(){b.Enable()};this.Enabled=function(){return b.Enabled()};this.Remove=function(){b.Remove()};this.AddEventListener=function(c,a){b.AddEventListener(c,a)};this.Activate=function(){var a=this.GetElement();if(fIsNullOrUndefined(a))return false;v(a);this.Status=d.ENALBED;return true};this.Deactivate=function(){var a=this.GetElement();if(fIsNullOrUndefined(a))return;t(a);this.Status=d.INACTIVE;loginfo("Draggable deactivated")};this.SetData=function(a,b){if(fIsNullOrUndefined(c))c=new Array(0);c[a]=b};this.AddData=function(a,b){if(fIsNullOrUndefined(c)||fIsNullOrUndefined(c[a]))this.SetData(a,b);else{var d=c[a];d.push(b)}};this.GetData=function(a){return!fIsNullOrUndefined(c)?c[a]:null};this.ClearData=function(a){if(fIsNullOrUndefined(a))c=null;else c[a]=null};this.GetDragImage=function(){return w}}function SPDroppable(n,m){var b=this,i={activeClass:"",avoidClass:"",bubble:"",hoverClass:""},e={spDragEnter:"",spDragOver:"",spDragLeave:"",spDrop:""},a=new SPDragDropBase(n,m,i,e);function d(d){if(fIsNullOrUndefined(d))d=window.event;logeventinfo(d,this,"dragenter");SPDragDropManager.ObjectEntered=SPDragDropManager.GetDroppable(b.GetElement());var c=b.GetElement(),a=document.getElementById(g_dropSurfaceId);if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.id=g_dropSurfaceId;document.body.appendChild(a)}if(!fIsNullOrUndefined(a)){a.className=g_dropSurfaceClass;a.style.display="";var k=c.clientWidth==0?c.offsetWidth:c.clientWidth,i=c.clientHeight==0?c.offsetHeight:c.clientHeight;a.style.width=String(k)+"px";a.style.height=String(i)+"px";var e=Sys.UI.DomElement.getLocation(c);a.style.left=String(e.x)+"px";a.style.top=String(e.y)+"px";if(fIsNullOrUndefined(g_dropSurface)){addListener(a,"dragenter",f,false,true);addListener(a,"dragover",h,false,true);addListener(a,"dragleave",g,false,true);addListener(a,"drop",j,false,true);g_dropSurface=a}}cancelDefault(d);return false}function f(a){if(fIsNullOrUndefined(a))a=window.event;logeventinfo(a,this,"dropSurfDragEnter");cancelDefault(a);var b=SPDragDropManager.ObjectEntered;if(a.dataTransfer)a.dataTransfer.effectAllowed="all";if(fIsNullOrUndefined(b))return false;var e=GetTarget(a);if(!fIsNullOrUndefined(e)){var d=b.GetOption("hoverClass");!fIsNullOrUndefined(d)&&addClass(e,d)}c("spDragEnter",a,SPDragDropManager.ObjectEntered);g_dropSurfaceBase=b.GetElement();return false}function h(a){if(fIsNullOrUndefined(a))a=window.event;if(a.dataTransfer)a.dataTransfer.effectAllowed="all";cancelDefault(a);c("spDragOver",a,SPDragDropManager.ObjectEntered);return false}function g(a){if(fIsNullOrUndefined(a))a=window.event;logeventinfo(a,this,"dropSurfdragleave");var f=SPDragDropManager.ObjectEntered;if(fIsNullOrUndefined(f))return false;var b=SPDragDropManager.ObjectEntered.GetElement();if(!fIsNullOrUndefined(b)&&b!=g_dropSurfaceBase)return false;SPDragDropManager.ObjectEntered=null;g_dropSurfaceBase=null;var e=GetTarget(a);if(!fIsNullOrUndefined(e)){var d=f.GetOption("hoverClass");!fIsNullOrUndefined(d)&&removeClass(e,d)}if(!fIsNullOrUndefined(g_dropSurface))g_dropSurface.style.display="none";cancelDefault(a);c("spDragLeave",a,SPDragDropManager.ObjectEntered);return false}function j(a){if(fIsNullOrUndefined(a))a=window.event;var d=SPDragDropManager.ObjectEntered;if(fIsNullOrUndefined(d))return;SPDragDropManager.ObjectDropped=d;SPDragDropManager.ObjectEntered=null;g_dropSurfaceBase=null;logeventinfo(a,this,"onDropSurfDrop");var f=d.GetOption("bubble");(fIsNullOrUndefined(f)||!f)&&cancelDefault(a);var g=GetTarget(a),e=d.GetOption("hoverClass");!fIsNullOrUndefined(e)&&removeClass(g,e);if(!fIsNullOrUndefined(g_dropSurface))g_dropSurface.style.display="none";b=SPDragDropManager.ObjectDropped;c("spDrop",a,SPDragDropManager.ObjectDropped)}function c(a,f,c){if(a in e){var d=new SPDragEvent(f,SPDragDropManager.ObjectDragged,c);b.GetBaseObject().FireEvent(a,d)}}function l(){var a=b.GetElement();addListener(a,"dragenter",d);addListener(a,"dragover",cancelDefault)}function k(){var a=b.GetElement();removeListener(a,"dragenter",d);removeListener(a,"dragover",cancelDefault)}this.GetBaseObject=function(){return a};this.GetElement=function(){return a.GetElement()};this.AddLinkKey=function(b){a.AddLinkKey(b)};this.RemoveLinkKey=function(b){a.RemoveLinkKey(b)};this.GetLinkKeys=function(){return a.GetLinkKeys()};this.GetOption=function(b){return a.GetOption(b)};this.SetOption=function(b,c){a.SetOption(b,c)};this.SetOptions=function(b){a.SetOptions(b)};this.Disable=function(){a.Disable()};this.Enable=function(){a.Enable()};this.Enabled=function(){return a.Enabled()};this.Remove=function(){a.Remove()};this.AddEventListener=function(c,b){a.AddEventListener(c,b)};this.Activate=function(){l();var a=this.GetOption("activeClass");!fIsNullOrUndefined(a)&&addClass(this.GetElement(),a)};this.Deactivate=function(){k();var a=this.GetOption("activeClass");!fIsNullOrUndefined(a)&&removeClass(this.GetElement(),a)}}function SPDragEvent(e,a,d){this.rawEvent=e;this.draggable=a;this.droppable=d;this.dragImage=undefined;if(!fIsNullOrUndefined(a))this.dragImage=a.GetDragImage();this.position={};this.offset={};this.SetData=function(b,c){!fIsNullOrUndefined(this.draggable)&&a.SetData(b,c)};this.GetData=function(b){return!fIsNullOrUndefined(this.draggable)?a.GetData(b):null};this.ClearData=function(b){!fIsNullOrUndefined(this.draggable)&&a.ClearData(b)};fIsNullOrUndefined(this.position)&&b(event);fIsNullOrUndefined(this.offset)&&c(event);var f=this;function b(a){fIsNullOrUndefined(a)}function c(a){fIsNullOrUndefined(a)}}function SPPosition(a,b){this.X=a;this.Y=b}var SPProgressMeter;function GetDragDropMode(){var a=DragDropMode.NOTSUPPORTED;if(browseris.ie&&!browseris.mac){if(browseris.ie8standard)a=DragDropMode.IE8;else if(browseris.ie9standardUp)a=DragDropMode.IE9}else if(browseris.firefox&&browseris.firefox36up)a=DragDropMode.HTML5;else if(browseris.chrome&&browseris.chrome7up)a=DragDropMode.HTML5;else if(Boolean(browseris.msEdge))a=DragDropMode.HTML5;return a}function addListener(a,b,c,d,f){var e=false;if(!fIsNullOrUndefined(d))e=d;f&&removeListener(a,b,c);if(a.addEventListener)a.addEventListener(b,c,e);else a.attachEvent&&a.attachEvent("on"+b,c)}function removeListener(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c);else a.detachEvent&&a.detachEvent("on"+b,c)}function GetTarget(a){if(!a)a=window.event;return a.target?a.target:a.srcElement?a.srcElement:null}function hasClass(c,b,d){if(fIsNullOrUndefined(c))return false;var a=c.className;return!fIsNullOrUndefined(a)?d?a.toLowerCase().indexOf(b.toLowerCase())>-1:a.indexOf(b)>-1:false}function addClass(a,b){if(fIsNullOrUndefined(a))return;if(!fIsNullOrUndefined(a.className)){if(a.className.indexOf(b)==-1)a.className=a.className+" "+b}else a.className=b}function removeClass(a,c){if(fIsNullOrUndefined(a))return;if(a.className==c)a.className="";var b=a.className,d=" "+c;if(b.indexOf(d)!=-1)a.className=b.replace(d,"");else if(b.indexOf(c)!=-1)a.className=b.replace(c,"")}function sortNumber(a,b){return a-b}function ShowElement(a){if(!fIsNullOrUndefined(a))a.style.display=""}function HideElement(a){if(!fIsNullOrUndefined(a))a.style.display="none"}var g_dragdroplog;function logeventinfo(a,c,d){if(!a)a=window.event;if(!a){loginfo(d+"evt is null");return}var b=[];b.push(d);c&&b.push("---this "+c.tagName+","+c.id);a.target&&b.push(" ---target "+a.target.tagName+","+a.target.id);a.srcElement&&b.push(" ---srcElement "+a.srcElement.tagName+","+a.srcElement.id);a.fromElement&&b.push(" ---fromElement "+a.fromElement.tagName+","+a.fromElement.id);a.relatedTarget&&b.push(" ---relatedTarget "+a.relatedTarget.tagName+","+a.relatedTarget.id);a.toElement&&b.push(" ---toElement "+a.toElement.tagName+","+a.toElement.id);loginfo(b.join("\r\n"))}function loginfo(a){g_dragdroplog.push("DragDrop("+displayDateTime(new Date)+"): "+a)}function displayDateTime(a){return String(a.getMonth())+"/"+String(a.getDate())+"/"+String(a.getFullYear())+" "+String(a.getHours())+":"+(a.getMinutes()<10?"0"+String(a.getMinutes()):String(a.getMinutes()))+":"+String(a.getSeconds())}function FullRefresh(b){if(!fIsNullOrUndefined(b)){var a={};a.currentCtx=b;a.csrAjaxRefresh=true;if(typeof AJAXRefreshView=="function"){AJAXRefreshView(a,SP.UI.DialogResult.OK);return true}}return false}var g_fileErrorDetailHTML;function RenderFileErrorDlgHtml(b){if(fIsNullOrUndefined(b)||b.length<1)return null;for(var f=[],e=[],d=0;d<b.length;d++){var a=b[d],h=Boolean(a.relativeFolder)?unescapeProperlyWp(a.relativeFolder)+unescapeProperlyWp(a.fileName):unescapeProperlyWp(a.fileName),c=a.statusText;if(!Boolean(c)||c=="")c=Strings.STS.L_DragDropUploadGenericError;var g=String.format(g_fileErrorDetailHTML,h,unescapeProperlyWp(c));e.push(g)}f.push(e.join(""));return f.join("")}function createProgressElement(c,f){var b=createCloneElement(c,c.id+"-progress","ms-dnd-inprogress",f);if(Boolean(b)){var a=document.createElement("IMG");a.src="/_layouts/15/images/loadingcirclests16.gif?rev=47";a.className="ms-dnd-inprogress-img";b.appendChild(a);var d=b.clientHeight==0?b.offsetHeight:b.clientHeight,e=a.clientHeight==0?a.offsetHeight:a.clientHeight;a.style.top=String((d-e)/2)+"px"}return b}function createCloneElement(b,d,e,g){if(!Boolean(b))return null;var a=document.getElementById(d);if(Boolean(a))return a;a=document.createElement("DIV");if(Boolean(a)){a.id=d;a.className=e;document.body.appendChild(a);var h=b.clientWidth==0?b.offsetWidth:b.clientWidth,f=b.clientHeight==0?b.offsetHeight:b.clientHeight;a.style.width=String(h)+"px";a.style.height=String(f)+"px";var c=Sys.UI.DomElement.getLocation(b);a.style.left=String(c.x)+"px";a.style.top=String(c.y)+"px";if(g)a.style.display="";else a.style.display="none"}return a}function hideProgressElement(c){if(!fIsNullOrUndefined(c)){var d=document.getElementById(c.id+"-progress");!fIsNullOrUndefined(d)&&HideElement(d)}else{var a=document.querySelectorAll(".ms-dnd-inprogress");if(!fIsNullOrUndefined(a))for(var b=0;b<a.length;b++){var e=a[b];e!=null&&HideElement(e)}}}var docIconClass,titleClass,g_context,g_dndDocItemFolderKey,g_dndDocItemQLLib,g_dndListItemQL,SupportMoveFolder,ExpectedErrorType,SPDragDropMoveHelper,SPDragDropItemType,DragMoveMonitorProperties;function SetDocItemDragDrop(d){if(SPDragDropManager.DragDropMode==DragDropMode.NOTSUPPORTED)return;var m=GetWPQTable(d);if(fIsNullOrUndefined(m))return;var k=new Array(0),c={};if(Boolean(d.ListSchema)&&d.ListSchema.IsDocLib=="1"&&d.listTemplate!=119){c[g_dndDocItemFolderKey]="";c[g_dndDocItemQLLib]=""}else c[g_dndListItemQL]="";for(var a=false,y=m.rows.length,p=0;p<y;p++){var j=m.rows[p],v=j.getAttribute("iid");if(fIsNullOrUndefined(v))continue;var u=GetIIDObject(v),w=GetListItemByID(d,u.itemId);(IsListItemFolder(w)||IsMountPoint(w))&&k.push(j);if(SupportMoveFolder||!u.fsFolder)for(var x=j.cells.length,q=0;q<x;q++){var h=j.cells[q],b=h.firstChild;if(!fIsNullOrUndefined(b)&&b.nodeType==1)if(hasClass(h,docIconClass,true)&&!fIsNullOrUndefined(b)){var f=SPDragDropManager.GetDraggable(b);if(fIsNullOrUndefined(f)){f=SPDragDropManager.InitDraggable(b,c);if(!fIsNullOrUndefined(f)){SetDocItemDragOption(f);a=true}}else a=true}if(hasClass(h,titleClass,true)){for(var r=h.childNodes,l,n=0;n<r.length;n++){var i=r[n];if(!fIsNullOrUndefined(i)&&hasClass(i,"ms-vb",true)&&hasClass(i,"itx",true)){l=i;break}}if(!fIsNullOrUndefined(l)){var g=l.firstChild;if(!fIsNullOrUndefined(g)&&g.nodeName=="A"){var e=SPDragDropManager.GetDraggable(g);if(fIsNullOrUndefined(e)){e=SPDragDropManager.InitDraggable(g,c);if(!fIsNullOrUndefined(e)){SetDocItemDragOption(e);a=true}}else a=true}}}}}if(a){var t={};t[g_dndDocItemFolderKey]="";for(var o=0;o<k.length;o++){var z=k[o],s=SPDragDropManager.InitDroppable(z,t);!fIsNullOrUndefined(s)&&SetFolderItemDropOption(s)}}}function SetDocItemDragOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("dragImage",createDocItemDragImage);var b=new SPPosition(20,20);a.SetOption("cursorAt",b);a.SetOption("sensitivity",5);a.AddEventListener("spDragStart",docItemDragStartHandler);a.AddEventListener("spDragStart",docItemDragStartForDragOut)}function SetFolderItemDropOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("hoverClass","ms-droppable-folder-hover");a.SetOption("activeClass","ms-droppable-folder-active");a.AddEventListener("spDragEnter",docFolderDragEnterHandler);a.AddEventListener("spDragOver",docFolderDragOverHandler);a.AddEventListener("spDrop",docFolderDropHandler)}var g_docItemDragImageID,g_docItemDragImageInnerHTML;function createDocItemDragImage(b){var a=null;if("undefined"==typeof g_QuickLaunchMenu||null==g_QuickLaunchMenu){a=document.getElementById(g_docItemDragImageID);if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.id=g_docItemDragImageID;a.className=g_spDragImageClass;a.innerHTML=g_docItemDragImageInnerHTML}}else a=b.cloneNode(true);document.body.appendChild(a);return a}function SPDocItemDragData(g,i,h,c,f,a,b,j,d,e){this.itemId=g;this.iid=i;this.title=h;this.fileName=c;this.fileUrl=f;if(fIsNullOrUndefined(a))this.overwrite=false;else this.overwrite=a;this.statusText=b;this.isFolder=d;this.itemType=e}var g_docItemDataKey,g_outWindowBefore;function docItemDragStartHandler(b){logeventinfo(b.rawEvent,this,"spDragStart");var a=CtxFromElement(GetEventSrcElement(b.rawEvent));if(fIsNullOrUndefined(a))return;var h=[],j=GetTarget(b.rawEvent);if(fIsNullOrUndefined(j))return;var e=GetParentIID(j);if(fIsNullOrUndefined(e))return;var g=a.dictSel,o=a.CurrentSelectedItems,f=false,l=null;if(fIsNullOrUndefined(g)||o<=0||typeof g_QuickLaunchMenu!="undefined"&&null!=g_QuickLaunchMenu)f=true;else if(!fIsNullOrUndefined(e)){l=g[e];if(fIsNullOrUndefined(l))f=true;else f=false}if(f){var i=GetIIDObject(e);if(!fIsNullOrUndefined(i)&&(SupportMoveFolder||!i.fsFolder)){var d=GetListItemByID(a,i.itemId);if(!fIsNullOrUndefined(d)){var m=d.FileRef;if(a.ListSchema&&a.ListSchema.IsDocLib!="1")m=j.href;var q=new SPDocItemDragData(d.ID,e,d["FileLeafRef.Name"],d.FileLeafRef,m,false,"","",i.fsFolder,SPDragDropMoveHelper.getDragDropItemType(d));h.push(q)}}}else for(var n in g){var k=g[n];if(k.fsObjType=="0"||SupportMoveFolder){var c=GetListItemByID(a,k.id);if(!fIsNullOrUndefined(c)){var p=new SPDocItemDragData(c.ID,n,c["FileLeafRef.Name"],c.FileLeafRef,c.FileRef,false,"","",k.fsObjType=="1",SPDragDropMoveHelper.getDragDropItemType(c));h.push(p)}}}if(h.length>0){b.SetData(g_docItemDataKey,h);if(b.rawEvent&&b.rawEvent.dataTransfer)b.rawEvent.dataTransfer.effectAllowed="all";if(browseris.ie&&typeof startDragDownload=="function"){g_outWindowBefore=false;g_dragDownloadStarted=false}}}function docItemDragStartForDragOut(a){loginfo("docItemDragStartForDragOut");var b=a.rawEvent;if(fIsNullOrUndefined(b))return;if(!browseris.ie&&!browseris.chrome||browseris.chrome&&!b.altKey)return;if(isDownloadWithUrlEnabled(b)){var d=CtxFromElement(GetEventSrcElement(a.rawEvent));if(fIsNullOrUndefined(d))return;var g=GetTarget(a.rawEvent);if(fIsNullOrUndefined(g))return;var h=GetParentIID(g);if(fIsNullOrUndefined(h))return;var f=GetIIDObject(h);if(fIsNullOrUndefined(f))return;var c=GetListItemByID(d,f.itemId);if(!fIsNullOrUndefined(c)){var e="Sharepoint:"+c.FileLeafRef+":"+getHostUrl(d.HttpRoot)+c.FileRef;b.dataTransfer.setData("DownloadURL",e);loginfo("docItemDragStartForDragOut: set downloadUrl="+e)}}else if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9)if(typeof detectWindowLeave=="function"){var i=a.draggable;i.AddEventListener("spDrag",detectWindowLeave);loginfo("docItemDragStartForDragOut, download with ActiveX in ie, attached spDrag")}}function isDownloadWithUrlEnabled(a){return SPDragDropManager.DragDropMode==DragDropMode.HTML5&&a.dataTransfer&&typeof a.dataTransfer.constructor=="function"&&a.dataTransfer.constructor.name=="Clipboard"&&a.dataTransfer.setData("DownloadURL","Test")}var g_dragDownloadStarted;function detectWindowLeave(h){var a=h.rawEvent;if(Boolean(a)&&(!browseris.ie&&!browseris.chrome||browseris.chrome&&!a.altKey))return;var b=false;if(!fIsNullOrUndefined(window.innerWidth))b=Boolean(a.clientX<0||a.clientY<0||a.clientX>window.innerWidth||a.clientY>window.innerHeight);else if(!fIsNullOrUndefined(document.body.clientHeight))b=Boolean(a.clientX<5||a.clientY<5||a.clientX>document.body.clientWidth-5||a.clientY>document.body.clientHeight-5);if(b&&!g_outWindowBefore){var i=h.GetData(g_docItemDataKey);if(!g_dragDownloadStarted){var d=SPDragDropManager.ObjectDragged;if(!fIsNullOrUndefined(d)){var g=d.GetElement();if(!fIsNullOrUndefined(g)){var f=CtxFromElement(g);if(!fIsNullOrUndefined(f)){startDragDownload(f,i);g_dragDownloadStarted=true;if(browseris.ie9standardUp){var c,e="dragend";if(typeof document.createEvent!="undefined"){c=document.createEvent("HTMLEvents");c.initEvent(e,true,true);c.eventName=e}typeof document.dispatchEvent!="undefined"&&document.dispatchEvent(c)}hideProgressElement()}}}}}else!b&&g_outWindowBefore}function docFolderDragEnterHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docFolderDragOverHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docFolderDropHandler(a){SP.QoS.ExecuteMonitoredCode("DragDropMove","DragDropMove_Start","DragDropMove_Success","DragDropMove_Failure","DragDropMove_NoResult",function(d){var e=a.droppable,f=a.GetData(g_docItemDataKey);if(fIsNullOrUndefined(e)||fIsNullOrUndefined(f)){d.UnexpectedFailure("DragDropMove_UnexpectedFailure_NoDroppableOrDragData");return}var i=e.GetElement();if(fIsNullOrUndefined(i)){d.UnexpectedFailure("DragDropMove_UnexpectedFailure_NoRowForDroppable");return}var l=i.getAttribute("iid");if(fIsNullOrUndefined(l)){d.UnexpectedFailure("DragDropMove_UnexpectedFailure_NoIIDForDroppable");return}var k=GetIIDObject(l);if(fIsNullOrUndefined(k)){d.UnexpectedFailure("DragDropMove_UnexpectedFailure_NulliidObjForDroppable");return}var c=CtxFromElement(i);if(fIsNullOrUndefined(c)){d.UnexpectedFailure("DragDropMove_UnexpectedFailure_NoCtx");return}var b=GetListItemByID(c,k.itemId);if(fIsNullOrUndefined(b))return;var g=b.FileRef,h=Boolean(c.RealHttpRoot)&&Boolean(c.HttpRoot)?c.HttpRoot:null,j=null;if(IsMountPoint(b))EnsureScriptParams("mountpoint.js","GetMountedFolderInfo",b,function(a){if(Boolean(a.folderUrl))if(!Boolean(a.hasEditPermission)){d.ExpectedFailure("DragDropMove_ExpectedFailure_MoveToViewOnlyMountPoint");ShowErrorDialogCore(GetErrorDialgTitle(f.length),String.format(Strings.STS.L_MoveToViewOnlyError,b["FileLeafRef.Name"]));return}else{j=createProgressElement(e.GetElement(),true);g=a.folderUrl;h=g;ExecuteItemMove(c,g,f,b,SupportMoveFolder,true,true,h,a.listTemplateType)}});else{j=createProgressElement(e.GetElement(),true);ExecuteItemMove(c,g,f,b,SupportMoveFolder,true,false,h)}})}function ExecuteItemMove(e,a,d,b,g,i,h,j,f){if(Boolean(g_dragDownloadStarted)){hideProgressElement();return}var c=function(c){if(h)doRemoteMoveItems(e,a,c,b);else doMoveItems(e,a,c,b)};if(i)CheckFileExists(d,a,g,c,j,f);else c(d)}function GetDocIcon(e){if(e.tagName!="TR")return null;for(var f=e.cells,a,b=0;b<f.length;b++){var h=f[b];if(hasClass(h,"ms-vb-icon",true)){a=h;break}}if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.childNodes))for(var g=a.childNodes,c=0;c<g.length;c++){var d=g[c];if(d.tagName=="A")return d.firstChild}return null}function doRemoteMoveItems(d,j,m,i){loginfo("in RemoteMoveItems, destUrl "+j);for(var g=[],k=m,f=SPDragDropMoveHelper.getDragDropItemType(i),e="DragDropRemoteMoveItem_",b,h=0;h<k.length;h++){var a=k[h];b=SetMonitorProperties(d,a,f);SP.QoS.WriteStart(e+"Start",b);if(Boolean(a.statusText)){b.errorType=a.statusType;b.errorMessage=a.statusText;SP.QoS.WriteFailure(e+"Failure",b);ShowErrorDialogCore(Strings.STS.L_MoveSingleItemErrorTitle,a.statusText);continue}var c={};c.itemName=a.fileName;c.srcUrl=makeFullUrl(d.HttpRoot,a.fileUrl);c.destUrl=j+"/"+a.fileName;c.isFile=!a.isFolder;c.isCopy=false;c.args=a;g.push(c)}if(g.length>0){var l=function(c,n){for(var h=0;h<c.length;h++){var l=c[h];b=SetMonitorProperties(d,l,f);SP.QoS.WriteSuccess(e+"Success",b);displayPrivacyMessage(d,i,l.args)}for(var j=0;j<c.length;j++){var g=n[j],o=g[0],p=g[1],m=g[2];b=SetMonitorProperties(d,o,f);SP.QoS.WriteFailure(e+"Failure",b);var a=JSON.parse(m),k=Strings.STS.L_DragMoveGenericError;if(Boolean(a)&&Boolean(a.error)&&Boolean(a.error.message)&&Boolean(a.error.message.value))k=a.error.message.value;ShowErrorDialogCore(Strings.STS.L_MoveSingleItemErrorTitle,k)}postMoveCommon(d)};EnsureScriptParams("movecopy.js","MoveOrCopyItems",g,l)}else postMoveCommon(d)}function doMoveItems(c,l,x,k){loginfo("in MoveItems, destUrl "+l);var d=SP.ClientContext.get_current(),i=null,w=null,m=null,v=false,g=SPDragDropMoveHelper.getDragDropItemType(k),f="DragDropMoveItem_",b;if(Boolean(c.RealHttpRoot)&&Boolean(c.HttpRoot)){v=true;m=new SP.ExceptionHandlingScope(d);var s=m.startScope();w=new SP.RemoteWeb(d,c.HttpRoot);s.dispose()}else i=d.get_web();for(var q=new Array(0),e=x,j=0;j<e.length;j++){var a=e[j];b=SetMonitorProperties(c,a,g);SP.QoS.WriteStart(f+"Start",b);b.errorType=a.statusType;b.errorMessage=a.statusText;if(a.isFolder&&(Boolean(a.statusText)||Boolean(a.statusType))){var t=ExpectedErrorType.indexOf(a.statusType)>=0,n=f+(t?"ExpectedFailure":"Failure");SP.QoS.WriteFailure(n,b);SP.DebugLogger.Write(n,SP.DebugLogger.LoggingLevel.Interesting,b);Boolean(a.statusText)&&ShowErrorDialogCore(Strings.STS.L_MoveFolderErrorTitle,a.statusText);continue}var r=new SP.ExceptionHandlingScope(d);q.push(r);var u=r.startScope(),o=a.fileUrl,p=l+"/"+a.fileName,y=a.isFolder,h=null;h=y?i.getFolderByServerRelativePath({DecodedUrl:o}):i.getFileByServerRelativePath({DecodedUrl:o});d.load(h);if(a.overwrite)h.moveTo(p,1);else h.moveTo(p,0);u.dispose()}d.executeQueryAsync(function(){for(var h=[],i=0;i<e.length;i++){var a=e[i],d=q[i];if(!fIsNullOrUndefined(d))if(typeof d.get_hasException=="function"&&d.get_hasException()){if(a.overwrite)if(typeof d.get_errorMessage=="function"){a.statusText=d.get_errorMessage();a.statusType="Generic";h.push(a)}b=SetMonitorProperties(c,a,g);SP.QoS.WriteFailure(f+"Failure",b)}else{a.statusText="";a.itemType==SPDragDropItemType.MOUNTPOINT&&displayPrivacyMessage(c,k,a);b=SetMonitorProperties(c,a,g);SP.QoS.WriteSuccess(f+"Success",b)}}if(h.length>0){var j=RenderFileErrorDlgHtml(h);ShowErrorDialogCore(GetErrorDialgTitle(h.length),j,null,true)}postMoveCommon(c)},function(k,d){for(var j=String.format(Strings.STS.L_DragDropClientRequestError,d.get_message(),d.get_stackTrace()),h=0;h<e.length;h++){var a=e[h];a.statusText=d.get_message();a.statusType="BatchCSOMRequestFailure";b=SetMonitorProperties(c,a,g);SP.QoS.WriteFailure(f+"Failure",b)}var i=function(){SPDragDropManager.ObjectDropped=null};ShowErrorDialogCore(Strings.STS.L_DragDropErrorTitle,j,i)})}function IIDObject(a,c,b){this.viewCount=a;this.itemId=c;this.fsFolder=b}function GetParentIID(b){var a=b;while(!fIsNullOrUndefined(a)&&a.tagName!="TABLE"){if(a.tagName=="TR"&&typeof a.attributes.iid!="undefined"&&a.attributes.iid!=null){var c=a.attributes.iid;return c.value}a=a.parentNode}return null}function GetListItemByID(b,c){for(var a=0;a<b.ListData.Row.length;a++)if(b.ListData.Row[a].ID===c)return b.ListData.Row[a];return null}function GetWPQTable(d){for(var e=document.getElementById("script"+d.wpq),c=e.childNodes,b=0;b<c.length;b++){var a=c[b];if(a.tagName=="TABLE"&&hasClass(a,"ms-listviewtable",true))return a}return null}function GetIIDObject(c){if(fIsNullOrUndefined(c))return null;var b,a=c.split(",");if(!fIsNullOrUndefined(a))b=new IIDObject(a[0],a[1],a[2]=="0"?false:true);return b}function CheckFileExists(b,l,r,d,i,h){var c=SP.ClientContext.get_current(),g=null,m=null,t=false;if(Boolean(i)){t=true;m=new SP.ExceptionHandlingScope(c);var q=m.startScope();g=new SP.RemoteWeb(c,i);q.dispose()}else g=c.get_web();for(var o=new Array(0),j=new Array(0),k=0;k<b.length;k++){var a=b[k];if(fIsNullOrUndefined(a.fileName)||!r&&a.isFolder){a.overwrite=false;continue}if(Boolean(h)&&h!="700"&&a.itemType==SPDragDropItemType.MOUNTPOINT){a.overwrite=false;a.statusText=String.format(Strings.STS.L_MoveMountPointToTeamSiteError,a.title);a.statusType="MoveMountPointToTeamSite";continue}if(a.fileUrl==l){a.overwrite=false;a.statusType="MoveFolderToItself";continue}var p=new SP.ExceptionHandlingScope(c);o.push(p);var s=p.startScope(),n=l+"/"+a.fileName;if(a.isFolder){var e;e=g.getFolderByServerRelativePath({DecodedUrl:n});e.retrieve("Exists");j.push(e);c.load(e)}else{var f;f=g.getFileByServerRelativePath({DecodedUrl:n});f.retrieve("Exists");j.push(f);c.load(f)}s.dispose()}c.executeQueryAsync(function(){for(var f=new Array(0),k=0,e=0;e<b.length;e++){var a=b[e],c=o[e];if(!fIsNullOrUndefined(c))if(typeof c.get_hasException=="function"&&c.get_hasException())if(typeof c.get_serverErrorCode=="function"&&c.get_serverErrorCode()==-2147024894)a.overwrite=true;else{a.overwrite=false;a.statusText=c.get_errorMessage();a.statusType="ErrorCheckingExistence"}else{var g=j[e];if(!fIsNullOrUndefined(g)&&!fIsNullOrUndefined(a))if(typeof g.get_exists=="function"&&g.get_exists())if(Boolean(i)&&Boolean(h)){a.overwrite=false;a.statusText=String.format(Strings.STS.L_ConflictItemErrorMessage,a.fileName);a.statusType="CanNotOverwriteRemoteItems"}else if(Boolean(a.isFolder)){a.overwrite=false;a.statusText=String.format(Strings.STS.L_ConflictItemErrorMessage,a.fileName);a.statusType="CanNotOverwriteExistingFolder"}else{f[k]=e;k++}}}if(f.length>0)ResolveConflictCommon(b,f,0,d);else typeof d=="function"&&d(b)},function(g,f){for(var e="Error when validate file against server: "+f.get_message()+"\r\nStackTrace:"+f.get_stackTrace(),c=0;c<b.length;c++){var a=b[c];a.overwrite=false;a.statusText=e;a.statusType="CheckFileExistsCSOMError:"+e}typeof d=="function"&&d(b)})}function ResolveConflictCommon(i,g,b,d){var a=g,c=i;if(b>=a.length){typeof d=="function"&&d(c);return}if(a[b]==-1){ResolveConflictCommon(c,a,b+1,d);return}var e=c[a[b]],f=a.length-b-1,h=function(l,j){if(l==SP.UI.DialogResult.cancel)return;else var i=j.overwriteOption,n=j.doRest;var k=b+1;if(n)k=a.length;for(var m=e.isFolder,g=b;g<k;g++){if(a[g]==-1)continue;var f=c[a[g]];if(m!=f.isFolder)continue;if(i==1){f.overwrite=false;f.statusText=Strings.STS.L_NoOverwrite;f.statusType="UserSelectNoOverwrite";a[g]=-1;f.isFolder}else if(i==0){f.overwrite=true;a[g]=-1}else continue}for(var h=b+1,h=b+1;h<a.length;h++)if(a[h]!=-1)break;ResolveConflictCommon(c,a,h,d)};ShowConflictDialog(e.fileName,e.isFolder,h,f)}function InitMenuItemAsDroppable(a){if(fIsNullOrUndefined(a))return;var d={};d[g_dndDocItemQLLib]="";for(var c=0;c<a.length;c++){var b=a[c];if(!fIsNullOrUndefined(b)){var e=SPDragDropManager.InitDroppable(b,d);SetMenuItemDropOption(e);b.removeAttribute("id")}}}function SetMenuItemDropOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("hoverClass","ms-droppable-menuitem-hover");a.SetOption("activeClass","ms-droppable-menuitem-active");a.AddEventListener("spDragEnter",docMenuItemDragEnterHandler);a.AddEventListener("spDragOver",docMenuItemDragOverHandler);a.AddEventListener("spDrop",docMenuItemDropHandler)}function docMenuItemDragEnterHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docMenuItemDragOverHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docMenuItemDropHandler(e){var c=e.droppable,g=e.GetData(g_docItemDataKey);if(fIsNullOrUndefined(c)||fIsNullOrUndefined(g))return;var f=e.draggable;if(fIsNullOrUndefined(f))return;var i=f.GetElement();if(fIsNullOrUndefined(i))return;var h=CtxFromElement(i);if(fIsNullOrUndefined(h))return;var d=c.GetElement(),b=null;if(!fIsNullOrUndefined(d)&&d.tagName=="A"){var a=d.getAttribute("href");b=a;if(!fIsNullOrUndefined(a)){var k=a.indexOf("/Forms/");if(k!=-1)b=a.substring(0,k);else{var j=a.lastIndexOf("/");if(j>0)b=a.substring(0,j)}}}var l=createProgressElement(c.GetElement(),true);ExecuteItemMove(h,b,g,null,SupportMoveFolder,true,false,null)}function UpdateMenuVisual(b,f,e){var c=SPDragDropManager.ObjectDropped,d=c.GetElement(),a=GetMenuStatusIcon(d);if(b=="start"){if(!fIsNullOrUndefined(a))a.src="/_layouts/15/images/progress-circle-24.gif?rev=47"}else if(b=="finish"){if(!fIsNullOrUndefined(a))if(e)a.src="/_layouts/15/images/error16by16.gif?rev=47";else a.src="/_layouts/15/images/check.gif?rev=47";FullRefresh(ctx)}}function GetMenuStatusIcon(b){var e=null,c="ms-dropmenu-icon",a=document.getElementById(c);if(!fIsNullOrUndefined(a))return a;a=document.createElement("IMG");a.id=c;a.className=c;if(!fIsNullOrUndefined(b)&&b.tagName=="A"){var d=b.firstChild.firstChild;if(!fIsNullOrUndefined(d)){d.parentNode.appendChild(a);e=a}}return e}function GetErrorDialgTitle(a){return a<=1?Strings.STS.L_MoveSingleItemErrorTitle:Strings.STS.L_MoveItemsErrorTitle}function SetMonitorProperties(b,d,c){var a=new DragMoveMonitorProperties;if(Boolean(b))if(Boolean(b.RealSiteTemplateId)){a.inRemoteWeb=true;a.listTemplateType=b.RealSiteTemplateId==21?"700":"101"}else a.listTemplateType=String(b.listTemplate);a.srcItemType=d.itemType;a.destinationItemType=c;return a}function displayPrivacyMessage(c,a,b){if(Boolean(b)&&b.itemType==SPDragDropItemType.MOUNTPOINT&&Boolean(a))Boolean(a)&&(Number(a.PrincipalCount)>=1||IsMountPoint(a))&&ShowErrorDialogCore(String.format(Strings.STS.L_PrivacyWarningTitle,b.title,a.FileLeafRef),String.format(Strings.STS.L_PrivacyWarningMessage,b.title,a.FileLeafRef))}function postMoveCommon(a){hideProgressElement();FullRefresh(a);SPDragDropManager.ObjectDropped=null}function makeFullUrl(b,c){if(Boolean(b)&&Boolean(c)){var a=new URI(b);if(Boolean(a)){a.setPath(c);return a.getString()}}return""}var UploadType,ControlStatus,FileStatus,ProgressMessage,UploadStatus,CancelConfirmationStatus,C_MEGABYTES,C_LARGE_FILESIZE,C_UPLOAD_CHUNKSIZE,C_MAX_FILESIZE,C_MAX_TOTALFILESIZE,C_MAX_REQUESTSIZE,C_MAX_FILECOUNT,C_MIN_REFRESH_INTERVAL,g_uploadType,g_inplaceDisplay,g_uploadCtl,g_currentControl,g_currentCtx,g_ClientSource;function registerDragUpload(a,l,i,b,k,j,g,h,f,e,d){if(!IsDragDropSupported())return false;if(a==null||typeof a=="undefined")return false;if(b==null||b.trim().length==0)return false;var c=new DragUploadControl(a,l,i,b,k,j,g,h,f,e,d,"");g_uploadCtl[a.id]=c;c.BindDragDrop();return true}function DragUploadControl(a,k,b,l,j,h,d,i,g,f,c,e){this.elmDropTargetElement=a;this.strSiteUrl=k+b;this.strSiteRelativeUrl=b;this.strListName=l;this.strRootFolder=j;this.fOverwriteAll=Boolean(h);this.fHideProgressBar=d;this.fInlineProgress=checkInlineDisplay(a);this.fInlineDisplayError=checkInlineDisplayError(a);this.fInlineDisplayStarted=false;this.schemaFieldsXml=null;this.refreshFunc=i;this.preUploadFunc=g;this.postUploadFunc=f;this.checkPermissionFunc=c;this.status=ControlStatus.IDLE;this.files=new Array(0);this.cctask=null;this.checkInComment=e}function DUCInitialize(){this.files=new Array(0);this.processedCount=0;this.succeededCount=0;this.failedCount=0;this.warnedCount=0;this.cctask=null;this.status=ControlStatus.IDLE;var a=this.activeXObj;!fIsNullOrUndefined(a)&&a.Initialize();this.fInlineDisplayStarted=false;this.checkInComment=""}function DUCBindDragDrop(){var a=document.body;AddEvtHandler(a,"ondragenter",dropElementDragEnter);AddEvtHandler(a,"ondragleave",dropElementDragLeave);AddEvtHandler(a,"ondragover",cancelDefault);if(g_uploadType===UploadType.HTML5)a.addEventListener("drop",dropElementDrop,false);else $addHandler(a,"drop",HideDropBox2)}function FileElement(a){this.fileName=a.name;this.fileSize=a.size;this.type=a.type;this.droppedFile=a;this.overwrite=false;this.status=FileStatus.PENDING;this.statusText="";this.subFolder="";this.relativeFolder="";this.isFolder=null;this.fileExistsOnServer=null;this.bytesUploaded=0}var c_dropBoxDivID,c_dropBoxTextID,c_activeXObjectID,c_activeXCLSID,c_uploadingMsgID;function dropElementDragEnter(c){RemoveEvtHandler(document.body,"ondragenter",dropElementDragEnter);var r=this;if(!fValidDrag(c,r)){if(fIsNullOrUndefined(c))c=window.event;if(!fIsNullOrUndefined(c))if(!fIsNullOrUndefined(c.dataTransfer))c.dataTransfer.dropEffect="none";else if(!fIsNullOrUndefined(c.rawEvent)&&!fIsNullOrUndefined(c.rawEvent.dataTransfer))c.rawEvent.dataTransfer.dropEffect="none";return false}if(IsUploadInProgress())return false;var g=0,h=getDropBoxStyles(),s="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px;";for(var d in g_uploadCtl){var f=document.getElementById(d);if(fIsNullOrUndefined(f))continue;var t=g_uploadCtl[d];if(!UserHasPermission(t))continue;var q=getCtx(d);if(!fIsNullOrUndefined(q)&&Boolean(q.inGridMode))continue;for(var l=document.querySelectorAll("#"+f.id+" .ms-hideWhenFileDrag"),j=0;j<l.length;j++)l[j].style.visibility="hidden";var n=d+"_"+c_dropBoxDivID,m=d+"_"+c_dropBoxTextID,a=g==0?document.getElementById(c_dropBoxDivID):document.getElementById(n);if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.id=g==0?c_dropBoxDivID:n;a.className=c_dropBoxDivID;a.setAttribute("relatedWP",d);f.parentNode.appendChild(a)}else a.style.display="";if(!fIsNullOrUndefined(a)){var o=AbsLeft(f),p=AbsTop(f),i=document.getElementById("s4-workspace");if(!fIsNullOrUndefined(i)){o-=AbsLeft(i);p-=AbsTop(i)}a.setAttribute("style",String.format("width: {0}px; height: {1}px; left: {2}px; top: {3}px; {4}",String(f.clientWidth),String(f.clientHeight),String(o),String(p),g==0||h!=""?h:h=getDropBoxStyles()));var b=document.getElementById(m);if(fIsNullOrUndefined(b)){b=document.createElement("SPAN");b.id=m;b.className="ms-attractMode ms-noWrap "+c_dropBoxTextID;b.style.position="relative";b.setAttribute("relatedWP",d);b.innerHTML=Strings.STS.L_DropText;a.appendChild(b)}if(typeof b.addEventListener=="function"){b.addEventListener("dragenter",cancelDefault,false);b.addEventListener("dragover",cancelDefault,false)}else{$addHandler(b,"dragenter",cancelDefault);$addHandler(b,"dragover",cancelDefault)}b.style.lineHeight=String(a.clientHeight)+"px";b.style.display=""}if(g_uploadType===UploadType.ACTIVEX){var k=d+"_"+c_activeXObjectID,e=document.getElementById(k);if(fIsNullOrUndefined(e)){e=document.createElement("OBJECT");e.id=k;e.className=c_activeXObjectID;e.classid=c_activeXCLSID;e.relatedWP=d;e.setAttribute("style",s);!fIsNullOrUndefined(a)&&a.appendChild(e)}else e.style.display="";$addHandler(a,"dragenter",DropBoxDragEnter);$addHandler(a,"drop",function(){g_currentControl.status=ControlStatus.DROPPED})}else if(g_uploadType===UploadType.HTML5){a.addEventListener("dragenter",DropBoxDragEnter,false);a.addEventListener("dragover",DropBoxDragOver,false);a.addEventListener("dragleave",DropBoxDragLeave,false);a.addEventListener("drop",DropBoxDrop,false)}g++}cancelDefault(c);return false}function getDropBoxStyles(){var a=document.getElementById(c_dropBoxDivID);return!fIsNullOrUndefined(a)?String.format("position: absolute; text-align: center; border: 1px solid; z-index: 2; margin: 0px;                               background-color: {0}; border-color: {1}; filter: {2};",CSSUtil.getCurrentStyleCorrect(a,"backgroundColor","background-color"),CSSUtil.getCurrentStyleCorrect(a,"borderTopColor","border-top-color"),CSSUtil.getCurrentStyleCorrect(a,"filter","filter")):""}function dropElementDragLeave(a){var e=!fIsNullOrUndefined(window.innerWidth)?window.innerWidth:document.body.clientWidth,d=!fIsNullOrUndefined(window.innerHeight)?window.innerHeight:document.body.clientHeight,b=a.clientX,c=a.clientY;if(!(0<b&&b<e&&0<c&&c<d)){HideDropBox2();if(!fIsNullOrUndefined(g_currentControl))g_currentControl.status=ControlStatus.IDLE}else AddEvtHandler(document.body,"onmouseout",EnsureHideDropBox);cancelDefault(a);return false}function dropElementDrop(a){HideDropBox2();cancelDefault(a);return false}function DropBoxDragEnter(d){var c=d.target.getAttribute("relatedWP");if(fIsNullOrUndefined(c))c=d.target.relatedWP;var a=g_uploadCtl[c];if(fIsNullOrUndefined(a))return false;var e=a.elmDropTargetElement.id;if(fIsNullOrUndefined(g_currentControl)||e!=g_currentControl.elmDropTargetElement.id||fIsNullOrUndefined(g_currentCtx)||e.indexOf(g_currentCtx.wpq)==-1){g_currentControl=a;g_currentCtx=getCtx(a.elmDropTargetElement.id)}typeof SupportAjaxFolderNav==="function"&&SupportAjaxFolderNav(g_currentCtx)&&FixupCtrlRootFolder();g_currentControl.Initialize();g_currentControl.status=ControlStatus.ENTERED;var b=document.getElementById(c+"_"+c_activeXObjectID);if(!fIsNullOrUndefined(b)){b.destinationUrl=a.strSiteUrl+a.strRootFolder;b.overwriteAll=a.fOverwriteAll;g_currentControl.activeXObj=b}cancelDefault(d);return false}function DropBoxDragOver(a){cancelDefault(a);if(typeof a.dataTransfer.effectAllowed=="string")a.dataTransfer.effectAllowed="copy";a.dataTransfer.dropEffect="copy"}function SkipDragLeave(a,b){if(!browseris.firefox&&!browseris.safari3up)return false;if(fIsNullOrUndefined(a))a=window.event;if(fIsNullOrUndefined(a))return true;var c=a.relatedTarget;return fIsNullOrUndefined(c)?true:fIsNullOrUndefined(b)?true:c.id!=b.id||c.className!=b.className?false:true}function DropBoxDragLeave(a){if(SkipDragLeave(a,this))return;g_currentControl.status=ControlStatus.IDLE}function HideDropBox2(){for(var b=document.querySelectorAll("."+c_dropBoxDivID),a=0;a<b.length;a++)if(!fIsNullOrUndefined(b[a]))b[a].style.display="none";for(var d=document.querySelectorAll(".ms-hideWhenFileDrag"),c=0;c<d.length;c++)d[c].style.visibility="visible";AddEvtHandler(document.body,"ondragenter",dropElementDragEnter)}function EnsureHideDropBox(a){(fIsNullOrUndefined(g_currentControl)||!fIsNullOrUndefined(g_currentControl)&&g_currentControl.status<=ControlStatus.ENTERED)&&HideDropBox2();RemoveEvtHandler(document.body,"onmouseout",EnsureHideDropBox);cancelDefault(a);return false}function TryPrepUploadDialogToDragDrop(a){if(!IsUploadInProgress()&&IsDragDropSupported()){g_currentControl=g_uploadCtl[a];g_currentCtx=getCtx(a);if(!fIsNullOrUndefined(g_currentControl)&&!fIsNullOrUndefined(g_currentCtx)&&UserHasPermission(g_currentControl)){g_currentControl.Initialize();return true}}return false}function FixupCtrlRootFolder(){var d=new URI(URI.decodeURIComponent(g_currentCtx.rootFolder)),b=d.getPath(),c=new URI(g_currentControl.strSiteUrl),a=c.getPath();if(b.indexOf(a)==0)g_currentControl.strRootFolder=b.substring(a.length)}function EnsureUploadDialogToDragDrop(){return IsDragDropSupported()&&!fIsNullOrUndefined(g_currentControl)&&!fIsNullOrUndefined(g_currentCtx)}function UploadDialogToDragDrop(f,b,a,e,d){g_currentCtx=getCtx(g_currentControl.elmDropTargetElement.id);typeof SupportAjaxFolderNav==="function"&&SupportAjaxFolderNav(g_currentCtx)&&FixupCtrlRootFolder();var c=function(){commonModalDialogHide();var f=g_currentControl.fOverwriteAll,c=g_currentControl.strRootFolder;!fIsNullOrUndefined(a)&&a!=""?g_currentControl.strRootFolder=a:null;g_currentControl.checkInComment=fIsNullOrUndefined(b)?"":b;g_currentControl.fOverwriteAll=e;DropBoxDrop(null,true,d);g_currentControl.fOverwriteAll=f;g_currentControl.strRootFolder=c};PrepareFileList(f,c)}function DropBoxDrop(e,a,c){HideDropBox2();var f,b;if(!a){f=e.dataTransfer;b=f.files}if(!fIsNullOrUndefined(b)&&b.length>0||a){g_currentControl.status=ControlStatus.DROPPED;var d=function(){var b=g_currentControl.files;!fIsNullOrUndefined(b)&&StartTask(b,a)};if(a){if(fIsNullOrUndefined(c))c="MultiFileUploadDialog";g_ClientSource=c;d()}else{g_ClientSource="Html5DragDrop";PrepareFileList(b,d)}}else ShowErrorDialogCore(Strings.STS.L_DragDropNotWorkingErrorTitle,Strings.STS.L_DragDropInvalidFile,null);cancelDefault(e);return false}function IsDragDropSupported(){return!fIsNullOrUndefined(g_uploadType)&&!fIsNullOrUndefined(UploadType)&&(g_uploadType==UploadType.ACTIVEX||g_uploadType==UploadType.HTML5)?true:false}function IsUploadInProgress(){if(!fIsNullOrUndefined(g_currentControl)&&g_currentControl.status>=ControlStatus.DROPPED){var a=document.getElementById(c_uploadingMsgID);fIsNullOrUndefined(a)&&ShowErrorDialogCore(Strings.STS.L_UploadInProgressTitle,"<div id='"+c_uploadingMsgID+"'>"+Strings.STS.L_UploadInProgress+"</div>",null,true);return true}return false}function UserHasPermission(b){var c=false;if(fIsNullOrUndefined(b))b=g_currentControl;if(typeof b.checkPermissionFunc=="function")c=b.checkPermissionFunc();else{var a=getCtx(b.elmDropTargetElement.id);if(fIsNullOrUndefined(a))a=fIsNullOrUndefined(g_currentCtx)?ctx:g_currentCtx;if(!fIsNullOrUndefined(a))if(fIsNullOrUndefined(a.ListSchema)){if(!fIsNullOrUndefined(a.FolderRight_AddListItems)&&a.FolderRight_AddListItems=="1"||fIsNullOrUndefined(a.FolderRight_AddListItems)&&a.ListRight_AddListItems!=null)c=true}else if(!fIsNullOrUndefined(a.ListSchema.FolderRight_AddListItems)&&a.ListSchema.FolderRight_AddListItems=="1"||fIsNullOrUndefined(a.ListSchema.FolderRight_AddListItems)&&a.ListSchema.ListRight_AddListItems!=null)c=true}return c}function PrepareFileList(b,e){if(fTooManyFiles(b))return;g_currentControl.files=[];for(var a=0,d=function(d,c){g_currentControl.files[a]=new FileElement(d);c?g_currentControl.files[a].type="":null;g_currentControl.files[a].isFolder=c;g_currentControl.files[a].relativeFolder=c?"\\":"";a++;a==b.length&&e()},c=0;c<b.length;c++)IsFolder(b[c],d)}function IsFolder(a,c){var e=!Boolean(a.size),d=fIsNullOrUndefined(a.type)||a.type=="",b=new FileReader;b.onload=function(){var b=!(!fIsNullOrUndefined(this.result)&&Boolean(this.result.byteLength));c(a,(e||b)&&d)};b.onerror=function(){c(a,true)};try{if(typeof b.readAsArrayBuffer!="undefined")b.readAsArrayBuffer(a.slice(0,Math.min(1,a.size)));else b.readAsBinaryString(a.slice(0,Math.min(1,a.size)))}catch(f){c(a,true)}}function fTooManyFiles(a){if(a.length>C_MAX_FILECOUNT){var b=String.format(Strings.STS.L_UploadMaxFileCount,C_MAX_FILECOUNT);ShowErrorDialogCore(Strings.STS.L_UploadMaxFileCountTitle,b,null);g_currentControl.status=ControlStatus.IDLE;return true}return false}function StartTask(a,d){var c=function(c,b,a){a.Success(b)},b=function(c,b,a){a.ExpectedFailure("UploadStartTaskUnknownError",b)};SP.QoS.ExecuteMonitoredAsync("UploadStartTask","UploadStartTaskStart","UploadStartTaskSuccess","UploadStartTaskUnexpected","UploadStartTaskNoTag",function(e){var f=function(){return UploadCommandFunc.apply(this,arguments)},h=function(){UploadFinishFunc.apply(this,arguments);for(var b=0;b<arguments.length;b++)if(arguments[b]instanceof UploadState){var a=arguments[b];e(this,{type:"UploadStartTaskFinishSuccess",status:a.status,succeededCount:a.succeededCount,uploadingCount:a.uploadingCount,warnedCount:a.warnedCount,failedCount:a.failedCount,checkedOutCount:a.checkedOutCount,totalBytesUploaded:a.totalBytes});return}},g=function(){var a=UploadCancelFunc.apply(this,arguments);a&&e(this,{type:"UploadStartTaskCancelSuccess"});return a};if(!fIsNullOrUndefined(a)){for(var c=0;c<a.length&&c<50;c++)SP.QoS.WriteUserEngagement("FilesUploaderFilePayload",JSON.stringify(a[c],FileElement.ScrubbingReplacer));a.length>50&&SP.QoS.WriteUserEngagement("FilesUploaderMoreThan50Files")}var i=new UploadState(a,d),j=new SP.Utilities.CommandBlock(i,f,h),b=new SP.Utilities.Task(g_currentControl.elmDropTargetElement,SP.Utilities.Task.TaskType.autoCancel,0,j,null,g,g_currentControl.fHideProgressBar?null:UploadProgressFunc);b.setPageExitText(Strings.STS.L_PageExitCancelUpload);if(!fIsNullOrUndefined(b)){g_currentControl.cctask=b;g_currentControl.status=ControlStatus.UPLOADING;b.start()}},c,b,{ClientSource:g_ClientSource})}function UploadState(b,a){this.status=UploadStatus.PENDING;this.files=b;this.uploadQueue=new UploadQueue;this.totalBytes=0;this.totalBytesProcessed=0;this.totalBytesInProgress=0;this.uploadingCount=0;this.percentDone=0;this.succeededCount=0;this.failedCount=0;this.warnedCount=0;this.conflictFiles=null;this.cancelConfirm=CancelConfirmationStatus.UNCONFIRMED;this.checkedOutCount=0;this.bFromUploadDialog=a;this.fInRefresh=false}function UploadCommandFunc(a,c){ResetTaskEngineTimeOut();if(a.status==0)DoValidate(a);else if(a.status==2)StartUpload(a);else if(a.status==3)!fIsNullOrUndefined(a.uploadQueue)&&!a.fInRefresh&&a.uploadQueue.continueUpload(a);if(a.status==UploadStatus.CANCELLED){var b=g_currentControl.cctask;!fIsNullOrUndefined(b)&&b.cancel(SP.Utilities.Task.CancelType.explicit);return 1}c();if(a.status>=UploadStatus.VALIDATED&&a.totalBytesProcessed==a.totalBytes){a.status=UploadStatus.FINISHED;return 1}else return a.totalBytes>0?a.totalBytesProcessed/a.totalBytes:-1}function UploadFinishFunc(b,a){a.bFromUploadDialog&&SP.UI.ModalDialog.commonModalDialogClose(1,false);typeof g_currentControl.postUploadFunc=="function"&&a.status!=UploadStatus.CANCELLED&&g_currentControl.postUploadFunc(a.files);g_currentControl.status=ControlStatus.UPLOADED;UpdateProgressBar(ProgressMessage.UPLOADED,a);RefreshResult(a);g_currentControl.status=ControlStatus.IDLE}function RefreshResult(a){if(typeof g_currentControl.refreshFunc=="function"){g_currentControl.refreshFunc(a.files);return}if(fIsNullOrUndefined(g_currentCtx)||!Boolean(g_currentCtx.IsClientRendering))return;var b=a.lastRefreshTime,c=new Date;if((fIsNullOrUndefined(b)||Number(c)-Number(b)>C_MIN_REFRESH_INTERVAL)&&!fIsNullOrUndefined(g_currentCtx)&&!fIsNullOrUndefined(g_currentCtx.clvp))if(g_currentControl.fInlineProgress)if(!g_currentControl.fInlineDisplayStarted)StartInlineDisplay(a);else RefreshInline(a);else if(FullRefresh(g_currentCtx))a.lastRefreshTime=new Date}function StartInlineDisplay(o){if(g_currentControl.fInlineDisplayStarted||fIsNullOrUndefined(g_currentCtx)||!Boolean(g_currentCtx.IsClientRendering)||Boolean(g_currentCtx.inGridMode))return;var k=o.files;if(fIsNullOrUndefined(k))return;for(var e=new Array(0),i=0;i<k.length;i++){var f=k[i],g=unescapeProperlyWp(f.relativeFolder),n=!fIsNullOrUndefined(g)&&TrimSpaces(g)!=""&&TrimSpaces(g)!="null";if(f.status!=FileStatus.SKIP&&(!f.isFolder&&(!n||g=="\\")||f.isFolder&&g=="\\")){var a={};a.ID="CustomData_"+String(i);var d=f.fileName;a.FileLeafRef=STSHtmlEncode(d);var h=d.lastIndexOf(".");a["FileLeafRef.Name"]=h>0?TrimSpaces(d.substring(0,h)):STSHtmlEncode(d);a["FileLeafRef.Suffix"]=h>0?TrimSpaces(d.substr(h+1)):"";a["HTML_x0020_File_x0020_Type.File_x0020_Type.mapico"]="loadingcirclests16.gif";a["HTML_x0020_File_x0020_Type.File_x0020_Type.isIconDynamic"]="true";a.Modified="";a.PermMask="";a["CustomData."]=true;e.push(a)}}for(var c=g_currentCtx.ListData,b=g_currentCtx.ListData.Row,j=b.length-1;j>=0;j--){var l=b[j];(fIsNullOrUndefined(l.ID)||l.ID==""||l.ID.indexOf("CustomData_")==0)&&b.splice(j,1)}if(fIsNullOrUndefined(b)||b.length==0){c.Row=e;c.FirstRow="1";c.LastRow=String(e.length)}else{c.Row=e.concat(b);c.LastRow=String(Number(c.LastRow)+e.length)}g_currentControl.fInlineDisplayStarted=true;var m=document.getElementById("scriptBody"+g_currentCtx.wpq);RenderListView(g_currentCtx,g_currentCtx.wpq,m,false);var p=g_currentCtx.clvp}function RefreshInline(e){if(fIsNullOrUndefined(g_currentCtx)||!Boolean(g_currentCtx.IsClientRendering)||Boolean(g_currentCtx.inGridMode))return;var j=SP.ClientContext.get_current();if(fIsNullOrUndefined(j))return;var d=e.files;if(fIsNullOrUndefined(d))return;for(var o=GetSchemaFieldsXml(),b={},i=[],c=0;c<d.length;c++){var g=d[c],q=g.status,f=unescapeProperlyWp(g.relativeFolder),B=!fIsNullOrUndefined(f)&&TrimSpaces(f)!=""&&TrimSpaces(f)!="null",l=g.isFolder&&f=="\\",m=!g.isFolder&&(!B||f=="\\"),C=l||m;if(q==FileStatus.UPLOADED){if(m)i.push("<Value Type='Text'>"+STSHtmlEncode(g.fileName)+"</Value>");else if(l){for(var n=[],h=c+1;h<d.length;h++){var u=d[h],r=u.status,v=unescapeProperlyWp(u.relativeFolder);if(v!=f&&v.indexOf(f)==0)(r==FileStatus.FAILED||r==FileStatus.WARNING)&&n.push(h);else break}if(n.length>0)if(g_currentControl.fInlineDisplayError){var y=RenderDetailError(e.files,n,true);b[c]=y}else b[c]="";else i.push("<Value Type='Text'>"+STSHtmlEncode(g.fileName)+"</Value>");c=h-1}}else if(q==FileStatus.FAILED||q==FileStatus.WARNING)if(m||l)if(!g_currentControl.fInlineDisplayError){var s=[];s[0]=c;var x=RenderDetailError(e.files,s,true);b[c]=x}else b[c]=""}if(i.length>0){var a=[];a.push("<View>");!fIsNullOrUndefined(o)&&o!=""&&a.push(o);a.push("<Query><Where><In><FieldRef Name='FileLeafRef'/><Values>");a.push(i.join(""));a.push("</Values></In></Where></Query>");if(!fIsNullOrUndefined(g_currentControl.strRootFolder)&&g_currentControl.strRootFolder!=""&&!fIsNullOrUndefined(g_currentCtx.rootFolder)&&g_currentCtx.rootFolder!=""){a.push("<RootFolder>");a.push(g_currentCtx.HttpRoot+g_currentControl.strRootFolder);a.push("</RootFolder>")}a.push("</View>");e.fInRefresh=true;var p=null,k=null;if(Boolean(g_currentCtx.RealHttpRoot)){var A=new SP.RemoteWeb(j,g_currentCtx.HttpRoot);k=A.getListById(g_currentCtx.listName);p=k.renderListData(a.join(""))}else{k=j.get_web().get_lists().getById(g_currentCtx.listName);p=k.renderListData(a.join(""))}j.executeQueryAsync(function(){var updatedRows=(eval("("+p.get_value()+")")).Row;if(fIsNullOrUndefined(updatedRows)||updatedRows.length==0)FullRefresh(g_currentCtx);else{CheckFilesCheckedOut(updatedRows,e);RefreshListRows(updatedRows);if(!fIsNullOrUndefined(b))for(var idx in b){var _file=d[idx],errDetail=b[idx];!fIsNullOrUndefined(_file)&&RefreshRowInError(_file,errDetail)}}e.fInRefresh=false},function(c,a){e.fInRefresh=false;var b={};if(Boolean(a))b={errorCode:a.get_errorCode(),errorMessage:a.get_message(),stackTrack:a.get_stackTrace()};SP.QoS.WriteUserEngagement("DragDropUpload_RefreshInlineRequestFailed",b);FullRefresh(g_currentCtx);return})}else if(!fIsNullOrUndefined(b))for(var w in b){var t=d[w],z=b[w];!fIsNullOrUndefined(t)&&RefreshRowInError(t,z)}}function CheckFilesCheckedOut(a,c){if(fIsNullOrUndefined(a)||fIsNullOrUndefined(a.length)||a.length<1)return;for(var b=0,d=0;d<a.length;d++){var e=a[d];if(!fIsNullOrUndefined(e.CheckoutUser)&&e.CheckoutUser!="")b++}if(b>0){c.checkedOutCount=b;c.status==UploadStatus.FINISHED&&UpdateProgressBar(ProgressMessage.UPLOADED,c)}}function trimRootFolder(c,e){if(!Boolean(c))return c;var a=unescapeProperly(c);if(Boolean(a)&&TrimSpaces(a)!=""){var b=a.indexOf("\\");if(b>=0){var d=e?a.indexOf("\\",b+1):b;if(d>=b)a=a.substr(d+1)}}return escapeProperly(a)}function RenderDetailError(b,a,f){if(fIsNullOrUndefined(a)||a.length<1)return null;if(fIsNullOrUndefined(b)||b.length<=0)return null;for(var e=[],d=0;d<a.length;d++){var g=a[d],c=b[g];c.relativeFolder=trimRootFolder(c.relativeFolder,f);e.push(c)}return RenderFileErrorDlgHtml(e)}function GetSchemaFieldsXml(){if(!fIsNullOrUndefined(g_currentControl.schemaFieldsXml))return g_currentControl.schemaFieldsXml;var b=[],a=g_currentCtx.ListSchema.Field;if(fIsNullOrUndefined(a)){g_currentControl.schemaFieldsXml="";return""}var c="";if(a.length>0){b.push("<ViewFields>");for(var d=0;d<a.length;d++){var e=a[d];b.push("<FieldRef Name='"+e.Name+"'/>")}b.push("</ViewFields>");c=b.join("")}g_currentControl.schemaFieldsXml=c;return c}function RefreshListRows(a){if(fIsNullOrUndefined(a)||fIsNullOrUndefined(a.length)||a.length<1)return;var b=g_currentCtx.ListData.Row,m=b.length,e=GetListTBody();if(fIsNullOrUndefined(e))return;for(var o={},c=[],n=0,i=0;i<a.length;i++){var f=a[i],d=FindListRowByName(f.FileLeafRef,0);if(d>=0){b[d]=f;var j=FindListRowByName(f.FileLeafRef,d+1);j>d&&c.push(j)}}var k=e.rows.length;c.sort(sortNumber);for(var h=c.length-1;h>=0;h--){var g=c[h];b.splice(g,1);g<k&&e.deleteRow(g)}g_currentCtx.ListData.Row=b;var l=document.getElementById("scriptBody"+g_currentCtx.wpq);RenderListView(g_currentCtx,g_currentCtx.wpq,l,false);PostRefreshFixUp()}function RefreshRowInError(a,b){var f=a.status;if(!a.isFolder&&f!=FileStatus.FAILED&&f!=FileStatus.WARNING)return;var c=FindListRowByName(a.fileName,0);if(c<0)return;if(!g_currentControl.fInlineDisplayError){var e=g_currentCtx.ListData.Row,j=e[c];j["InError."]=true;g_currentCtx.ListData.Row=e;var i=document.getElementById("scriptBody"+g_currentCtx.wpq);RenderListView(g_currentCtx,g_currentCtx.wpq,i,false);return}else{var g=GetListTBody();if(fIsNullOrUndefined(g))return;var d=g.rows[c];d.id="js-dragupload-error-"+a.fileName;var h=function(){for(var e=d,i=e.cells,g=i.length-1;g>=0;g--){var c=i[g];!(hasClass(c,"ms-vb-icon",true)||hasClass(c,"ms-vb-title",true)||hasClass(c,"ms-vb-itmcbx",true))&&e.deleteCell(g);if(hasClass(c,"ms-vb-title",true))c.style.verticalAlign="middle";if(hasClass(c,"ms-vb-icon",true))c.firstChild.src="/_layouts/15/images/error16by16.gif?rev=47"}var f=e.insertCell(e.cells.length),h=unescapeProperlyWp(a.statusText);if(a.isFolder&&!fIsNullOrUndefined(b)&&b!="")f.innerHTML=String.format(Strings.STS.L_DragDropUploadFolderError,"<a onclick='ShowFolderErrorDetails(this, event)'>","</a>")+"<span style='display:none;'>"+b+"</span>";else if(!fIsNullOrUndefined(h)&&h!="")f.innerHTML=h;else f.innerHTML=Strings.STS.L_DragDropUploadGenericError;f.colSpan=100;addClass(e,"ms-dragupload-error ms-status-red");SPAnimationUtility.BasicAnimator.FadeIn(e,null,null);PostRefreshFixUp()};SPAnimationUtility.BasicAnimator.FadeOut(d,h,null)}}function ShowFolderErrorDetails(b,c){if(fIsNullOrUndefined(b))return;var a=b.nextSibling;while(!fIsNullOrUndefined(a)&&(fIsNullOrUndefined(a.tagName)||a.tagName!="SPAN"||fIsNullOrUndefined(a.style.display)||a.style.display!="none"))a=a.nextSibling;!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.tagName)&&a.tagName=="SPAN"&&!fIsNullOrUndefined(a.tagName)&&a.style.display=="none"&&ShowErrorDialogCore(Strings.STS.L_ErrorDetailsTitle,a.innerHTML,null,true);cancelDefault(c)}function ShowAllErrorDetailsInDialog(){var a=g_currentControl.files;if(a.length<=0)return;for(var d=[],b=0;b<a.length;b++){var f=a[b],e=f.status;(e==FileStatus.FAILED||e==FileStatus.WARNING)&&d.push(b)}if(d.length>0){var c=RenderDetailError(a,d,false);!fIsNullOrUndefined(c)&&c!=""&&ShowErrorDialogCore(Strings.STS.L_ErrorDetailsTitle,c,null,true)}}function FindListRowByName(c,e){if(fIsNullOrUndefined(c)||fIsNullOrUndefined(g_currentCtx)||fIsNullOrUndefined(g_currentCtx.ListData)||fIsNullOrUndefined(g_currentCtx.ListData.Row))return-1;var d=g_currentCtx.ListData.Row,f=d.length,b=e;if(b<0)b=0;for(var a=b;a<f;a++){var g=d[a];if(STSHtmlDecode(g.FileLeafRef)==c)return a}return-1}function GetListTBody(){if(fIsNullOrUndefined(g_currentCtx))return null;var a=document.getElementById("scriptBody"+g_currentCtx.wpq);return fIsNullOrUndefined(a)?null:a.nextSibling}function UploadCancelFunc(d,a,c){a.bFromUploadDialog&&SP.UI.ModalDialog.commonModalDialogClose(1,false);if(c==SP.Utilities.Task.CancelType.explicit||c==SP.Utilities.Task.CancelType.implicitByCommand||a.cancelConfirm==CancelConfirmationStatus.CONFIRMEDYES){if(g_uploadType==UploadType.HTML5)!fIsNullOrUndefined(a.uploadQueue)&&a.uploadQueue.cancelUpload(a);else if(g_uploadType==UploadType.ACTIVEX){var b=g_currentControl.activeXObj;!fIsNullOrUndefined(b)&&b.CancelUpload()}a.cancelConfirm=CancelConfirmationStatus.UNCONFIRMED;a.status=UploadStatus.CANCELLED;g_currentControl.status=ControlStatus.UPLOADED;UpdateProgressBar(ProgressMessage.CANCELLED,a);g_currentControl.Initialize();RefreshResult(a);return true}return false}function UploadProgressFunc(c,d,b){b.percentDone=c;var a=ProgressMessage.EMPTY;switch(b.status){case 1:a=ProgressMessage.VALIDATION;break;case 3:a=ProgressMessage.UPLOADING;break;case 4:a=ProgressMessage.UPLOADED;break;case 5:a=ProgressMessage.CANCELLED}UpdateProgressBar(a,b)}function StartTaskAX(){var b=function(c,b,a){a.Success(b)},a=function(c,b,a){a.ExpectedFailure("UploadStartTaskAXUnknown",b)};SP.QoS.ExecuteMonitoredAsync("UploadStartTaskAX","UploadStartTaskAXStart","UploadStartTaskAXSuccess","UploadStartTaskAXUnexpected","UploadStartTaskAXNoTag",function(b){var c=function(){return UploadAXCommandFunc.apply(this,arguments)},e=function(){UploadFinishFunc.apply(this,arguments);b(this,{})},d=function(){var a=UploadCancelFunc.apply(this,arguments);a&&b(this,{type:"AXCancelSuccess"});return a},f=new UploadState(null,false),g=new SP.Utilities.CommandBlock(f,c,e),a=new SP.Utilities.Task(g_currentControl.elmDropTargetElement,SP.Utilities.Task.TaskType.autoCancel,0,g,null,d,g_currentControl.fHideProgressBar?null:UploadProgressFunc);a.setPageExitText(Strings.STS.L_PageExitCancelUpload);if(!fIsNullOrUndefined(a)){g_currentControl.status=ControlStatus.UPLOADING;g_currentControl.cctask=a;a.start()}},b,a)}function UploadAXCommandFunc(a,f){ResetTaskEngineTimeOut();var b=g_currentControl.activeXObj,d=-1,c=-1;if(typeof b.controlStatus=="number")d=b.controlStatus;if(typeof b.uploadStatus=="number")c=b.uploadStatus;if(d==2&&c==0){GetFilesFromJSON(a);if(fIsNullOrUndefined(a.files))return 1;else{DoValidate(a);if(a.status==UploadStatus.VALIDATING){b.uploadStatus=UploadStatus.VALIDATING;b.controlStatus=ControlStatus.UPLOADING}}}else if(d==3){if(c==2)StartUpload(a);else if(c==3){if(typeof b.currentFileIndex=="number")a.uploadingCount=b.currentFileIndex+1;if(typeof b.totalBytesUploaded=="number")a.totalBytesProcessed=b.totalBytesUploaded;if(typeof b.succeededCount=="number")a.succeededCount=b.succeededCount;if(typeof b.failedCount=="number")a.failedCount=b.failedCount;if(typeof b.warnedCount=="number")a.warnedCount=b.warnedCount}}else if(d==4){if(typeof b.totalBytesUploaded=="number")a.totalBytesProcessed=b.totalBytesUploaded;if(typeof b.succeededCount=="number")a.succeededCount=b.succeededCount;if(typeof b.failedCount=="number")a.failedCount=b.failedCount;if(typeof b.warnedCount=="number")a.warnedCount=b.warnedCount;GetFilesFromJSON(a);a.status=UploadStatus.FINISHED;return 1}if(a.status==UploadStatus.CANCELLED){var e=g_currentControl.cctask;!fIsNullOrUndefined(e)&&e.cancel(SP.Utilities.Task.CancelType.explicit);return 1}f();if(a.status>=UploadStatus.VALIDATED&&a.totalBytes>0&&a.totalBytesProcessed==a.totalBytes){a.status=UploadStatus.FINISHED;return 1}else return a.totalBytes>0?a.totalBytesProcessed/a.totalBytes:-1}function GetFilesFromJSON(state){var axObj=g_currentControl.activeXObj;if(typeof axObj.fileListJSON=="string"){var fileListJSON=axObj.fileListJSON,fileList=eval("("+fileListJSON+")");state.files=fileList.files}}function DoValidate(b){if(b.status!=UploadStatus.PENDING)return;var e=b.files;if(fIsNullOrUndefined(e))return;b.status=UploadStatus.VALIDATING;UpdateProgressBar(ProgressMessage.VALIDATION,b);for(var d=SP.ClientContext.get_current(),s=d.get_web(),k=new Array(0),j=new Array(0),v=Boolean(g_currentCtx)&&Boolean(g_currentCtx.RealHttpRoot),n=0;n<e.length;n++){var a=e[n];if(a.status==FileStatus.FAILED&&Boolean(a.statusText)&&a.statusText!=""){b.failedCount++;continue}a.status=FileStatus.PENDING;if(IndexOfIllegalCharInUrlLeafName(a.fileName)!=-1){a.status=FileStatus.FAILED;a.statusText=escapeProperly(Strings.STS.L_IllegalFileNameError);b.failedCount++;continue}var t=typeof a.type=="undefined"||a.type==null||a.type=="",g=false;if(g_uploadType===UploadType.ACTIVEX&&a.isFolder==false&&t){var o=a.fileName,q=o.lastIndexOf(".");if(q>0){var i=TrimSpaces(o.substr(q));if(typeof i=="undefined"||i==null||i=="")g=true}else g=true}var h=false;if(g_uploadType===UploadType.HTML5)h=a.isFolder==true||a.fileSize==0;else if(g_uploadType===UploadType.ACTIVEX)h=a.isFolder==false&&a.fileSize==0||g;if(h){a.status=FileStatus.FAILED;a.statusText=Strings.STS.L_DragDropFolderOrEmptyFile;b.failedCount++;continue}if(g_currentControl.fOverwriteAll==true){a.overwrite=true;if(a.status==FileStatus.PENDING)b.totalBytes+=a.fileSize}else{var r=new SP.ExceptionHandlingScope(d);k.push(r);var u=r.startScope(),c=g_currentControl.strSiteRelativeUrl+g_currentControl.strRootFolder,m=a.subFolder;if(!fIsNullOrUndefined(m)&&TrimSpaces(m)!="")c=c+TrimSpaces(m);if(fIsNullOrUndefined(a.relativeFolder)||TrimSpaces(a.relativeFolder)=="")c=c+"/"+a.fileName;else{var l=unescapeProperlyWp(a.relativeFolder);if(!fIsNullOrUndefined(l)&&TrimSpaces(l)!=""){c=c+TrimSpaces(l);c=c+a.fileName}}if(a.isFolder){var p=s.getFolderByServerRelativeUrl(c);j.push(p);d.load(p)}else{var f=null;f=s.getFileByServerRelativePath({DecodedUrl:c});f.retrieve("Exists");j.push(f);d.load(f)}u.dispose()}}if(g_currentControl.fOverwriteAll==false&&k.length>0)d.executeQueryAsync(function(){for(var g=new Array(0),i=0,h=0,f=0;f<e.length;f++){var a=e[f];if(a.status!=FileStatus.PENDING)continue;var c=k[h];if(!fIsNullOrUndefined(c)){if(typeof c.get_hasException=="function"&&c.get_hasException())if(typeof c.get_serverErrorCode=="function"&&c.get_serverErrorCode()==-2147024894){a.existsOnServer=false;a.overwrite=true;b.totalBytes+=a.fileSize}else{a.overwrite=false;a.status=FileStatus.FAILED;a.statusText=c.get_errorMessage()}else{var d=j[h];if(!fIsNullOrUndefined(d))if(typeof d.get_exists=="function"&&d.get_exists()||typeof d.get_folders=="function"){a.existsOnServer=true;g[i]=f;i++}}h++}}if(g.length>0){b.conflictFiles=g;ResolveConflict(b,0)}else{b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b)}},function(d,c){a.status=FileStatus.FAILED;a.statusText=String.format(Strings.STS.L_DragDropClientRequestError,c.get_message(),c.get_stackTrace());b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b)});else{b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b)}}function UpdateValidationResultAX(e){if(g_uploadType!=UploadType.ACTIVEX)return;var d=e.files,b=g_currentControl.activeXObj;if(fIsNullOrUndefined(b))return;for(var c=0;c<d.length;c++){var a=d[c];if(!fIsNullOrUndefined(b)){b.SetFileStatus(c,a.status,a.overwrite);!fIsNullOrUndefined(a.subFolder)&&b.SetFileSubFolder(c,a.subFolder);!fIsNullOrUndefined(a.fileName)&&b.SetFileName(c,a.fileName);!fIsNullOrUndefined(a.statusText)&&b.SetFileStatusText(c,a.statusText)}}b.totalBytes=e.totalBytes}function StartUpload(a){if(a.status!=UploadStatus.VALIDATED)return;if(typeof g_currentControl.preUploadFunc=="function"){var c=g_currentControl.preUploadFunc(a.files);if(!fIsNullOrUndefined(c)&&Boolean(c)==false){cancelTask(null);a.status=UploadStatus.CANCELLED;return}}a.status==UploadStatus.VALIDATED&&g_uploadType==UploadType.ACTIVEX&&UpdateValidationResultAX(a);if(a.status==UploadStatus.IN_READ_UPLOAD)return;RefreshResult(a);if(g_uploadType===UploadType.ACTIVEX){var b=g_currentControl.activeXObj;if(!fIsNullOrUndefined(b)){a.status=UploadStatus.IN_READ_UPLOAD;!fIsNullOrUndefined(b)&&b.StartUpload()}}else g_uploadType===UploadType.HTML5&&StartUploadWithXHR(a)}function StartUploadWithXHR(c){c.status=UploadStatus.IN_READ_UPLOAD;for(var j=c.files,d=0,m=new UploadQueue,a=[],i=[],n=null,l=false,o=Flighting.VariantConfiguration.IsExpFeatureClientEnabled(111),p=C_LARGE_FILESIZE,e=function(){if(a.length>0){var b=g_currentControl.strSiteRelativeUrl+g_currentControl.strRootFolder,c=a[0].subFolder;if(!fIsNullOrUndefined(c))b=b+c;n=new FilesUploader(a,b,l);m.enqueue(n);a=[]}},h=0;h<j.length;h++){var b=j[h];if(b.status==FileStatus.SKIP||b.status==FileStatus.FAILED||b.status==FileStatus.WARNING){SP.QoS.WriteUserEngagement("StartUploadWithXHRSkippingFile",JSON.stringify(b,FileElement.ScrubbingReplacer));c.uploadingCount++;UpdateProgressBar(ProgressMessage.UPLOADING,c);if(h==j.length-1&&a.length>0)e();else continue}if(o||b.fileSize>C_LARGE_FILESIZE)i.push(b);else{if(a.length>0){var g=a[0].subFolder,f=b.subFolder;(fIsNullOrUndefined(g)&&!fIsNullOrUndefined(f)||!fIsNullOrUndefined(g)&&fIsNullOrUndefined(f)||!fIsNullOrUndefined(g)&&!fIsNullOrUndefined(f)&&TrimSpaces(g)!=TrimSpaces(f))&&e()}d>0&&d+b.fileSize>=p&&e();if(a.length==0)d=0;a.push(b);d+=b.fileSize}}a.length>0&&d>0&&e();l=true;for(var k=0;k<i.length;k++){a=[i[k]];e()}c.uploadQueue=m;c.uploadQueue.startUpload(c)}var c_progInfoID,c_progInfoClass,c_progInfoClassInline,c_progInfoTableID,c_progInfoTableClass,c_progMessageClass,c_progIconID,c_progTextID,c_progLargeFileID,c_progCancelBtnID,c_progRefreshBtnID,C_detailRowId,C_progImgClass,c_progMeterTdID,c_progMeterID,c_progInfoCloseID,c_progAriaTextID,c_progTableHTML,c_progTableHTMLInline,c_failedLinkABegin,c_failedLinkAllErrorsABegin;function UpdateProgressBar(q,a){if(g_currentControl.fHideProgressBar)return;var b=g_currentControl.elmProgressBar,c=g_currentControl.elmDropTargetElement,p=g_currentControl.strSiteUrl;if(q>4){if(!fIsNullOrUndefined(b))b.style.display="none";return}if(fIsNullOrUndefined(b)||fIsNullOrUndefined(document.getElementById(c.id+c_progTextID)))if(g_currentControl.fInlineProgress){if(fIsNullOrUndefined(b))b=document.createElement("DIV");b.id=c.id+c_progInfoID;b.className=c_progInfoClassInline;b.tabIndex=-1;if(!fIsNullOrUndefined(b)){var x=String.format(c_progTableHTMLInline,c.id+c_progInfoTableID,c.id+c_progTextID,c.id+c_progMeterTdID,c.id+c_progCancelBtnID,Strings.STS.L_CancelButtonCaption,c_progMessageClass,c.id+c_progInfoCloseID,c.id,Strings.STS.L_DismissButtonCaption);b.innerHTML=x;var u=g_currentCtx.wpq,o=document.getElementById("Hero-"+u),g;if(!fIsNullOrUndefined(o)){g=o.parentNode;!fIsNullOrUndefined(g)&&g.insertBefore(b,o)}else{g=document.getElementById("script"+u);!fIsNullOrUndefined(g)&&!fIsNullOrUndefined(g.firstChild)&&g.insertBefore(b,g.firstChild)}if(fIsNullOrUndefined(g))return;if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169)){var j=document.createElement("span");j.className="ms-accessible";j.id="ms-dnd-progressARIA_Text";j.setAttribute("aria-live","assertive");j.setAttribute("aria-relevant","all");g.insertBefore(j,b)}g_currentControl.elmProgressBar=b;var f=SPProgressMeter.CreateMeter(0);f.id=c.id+c_progMeterID;if(!fIsNullOrUndefined(f)){var t=document.getElementById(c.id+c_progMeterTdID);!fIsNullOrUndefined(t)&&t.appendChild(f)}}}else{if(fIsNullOrUndefined(b))b=document.createElement("DIV");b.id=c.id+c_progInfoID;b.className=c_progInfoClass;if(!fIsNullOrUndefined(b)){var v=String.format(c_progTableHTML,c.id+c_progInfoTableID,c.id+c_progIconID,c.id+c_progTextID,c.id+c_progCancelBtnID,Strings.STS.L_CancelButtonCaption,c_progMessageClass,c.id+c_progRefreshBtnID,Strings.STS.L_RefreshButtonCaption);b.innerHTML=v;g_currentControl.elmProgressBar=b;var w=c.parentNode;w.insertBefore(b,c)}}if(g_currentControl.fInlineProgress){var s=document.getElementById("Hero-"+g_currentCtx.wpq);if(!fIsNullOrUndefined(s)){!fIsNullOrUndefined(b)&&b.focus();s.style.display="none"}}else{removeClass(b,"ms-status-blue");removeClass(b,"ms-status-green");removeClass(b,"ms-status-red")}b.style.display="";var d=document.getElementById(c.id+c_progIconID),e=document.getElementById(c.id+c_progTextID),l=document.getElementById(c.id+c_progCancelBtnID);f=document.getElementById(c.id+c_progMeterID);var i=document.getElementById(c.id+c_progInfoCloseID),h=document.getElementById(c.id+c_progRefreshBtnID),m=document.getElementById(c.id+c_progLargeFileID);m!=null&&m.parentNode.removeChild(m);var n=0;if(a.totalBytes>0)n=(a.totalBytesInProgress>a.totalBytesProcessed?a.totalBytesInProgress:a.totalBytesProcessed)/a.totalBytes;var y=String(Math.round(n>0?n*100:0)),k=p+"/_layouts/15/images/loadingcirclests16.gif?rev=47";switch(q){case 1:!g_currentControl.fInlineProgress&&addClass(b,"ms-status-blue");if(a.status==UploadStatus.VALIDATING){Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169)&&SPProgressMeter.SetProgressAriaInfo(0,0,0);if(!fIsNullOrUndefined(d)){if(d.src!=k)d.src=k;ShowElement(d);!g_currentControl.fInlineProgress&&ShowElement(d.parentNode)}if(e.innerHTML!=Strings.STS.L_PrepareUpload)e.innerHTML=Strings.STS.L_PrepareUpload}else{HideElement(d);!g_currentControl.fInlineProgress&&HideElement(d.parentNode);e.innerHTML=Strings.STS.L_FinishValidation}l.style.display="none";if(!fIsNullOrUndefined(i))i.style.display="none";if(!fIsNullOrUndefined(h))h.style.display="none";break;case 2:if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-blue");ShowElement(d.parentNode)}if(!fIsNullOrUndefined(d)){if(d.src!=k)d.src=k;if(d.style.display!="")d.style.display=""}var r=String.format(Strings.STS.L_UploadingProgress,a.succeededCount+a.failedCount+a.warnedCount,a.files.length);if(r!=e.innerHTML)e.innerHTML=r;if(!fIsNullOrUndefined(f)){f.style.display="";SPProgressMeter.SetProgress(f,Number(y))}l.style.display="";if(!fIsNullOrUndefined(i))i.style.display="none";if(!fIsNullOrUndefined(h))h.style.display="none";break;case 3:g_currentControl.succeededCount=a.succeededCount;g_currentControl.failedCount=a.failedCount;g_currentControl.warnedCount=a.warnedCount;g_currentControl.files=a.files;!g_currentControl.fInlineProgress&&PopulateErrorDetails(true);if(a.failedCount+a.warnedCount==0){if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-green");HideElement(d.parentNode)}else if(!fIsNullOrUndefined(d)){d.src=p+"/_layouts/15/images/check.gif?rev=47";d.style.display=""}if(!fIsNullOrUndefined(g_currentControl.elmDropTargetElement)&&!fIsNullOrUndefined(g_currentControl.elmDropTargetElement.id)&&g_currentControl.fInlineProgress)CloseProgressBar(null,g_currentControl.elmDropTargetElement.id);else e.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_SucceedMessageWithCheckout:Strings.STS.L_SucceedMessage,String(a.succeededCount),String(a.checkedOutCount))}else{if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-red");HideElement(d.parentNode)}else if(!fIsNullOrUndefined(d)){d.src="/_layouts/15/images/error16by16.gif?rev=47";d.style.display=""}if(g_currentControl.fInlineProgress){e.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageWithCheckout:Strings.STS.L_FailedMessage,String(a.succeededCount),String(a.failedCount),String(a.checkedOutCount));if(g_currentControl.fInlineDisplayError)e.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageWithCheckout:Strings.STS.L_FailedMessage,String(a.succeededCount),String(a.failedCount),String(a.checkedOutCount));else e.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageLinkWithCheckout:Strings.STS.L_FailedMessageLink,String(a.succeededCount),String(a.failedCount),c_failedLinkAllErrorsABegin,"</a>",String(a.checkedOutCount))}else e.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageLinkWithCheckout:Strings.STS.L_FailedMessageLink,String(a.succeededCount),String(a.failedCount),c_failedLinkABegin,"</a>",String(a.checkedOutCount))}if(!fIsNullOrUndefined(f))f.style.display="none";l.style.display="none";if(!fIsNullOrUndefined(i))i.style.display="";if(!fIsNullOrUndefined(h))h.style.display="";Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169)&&SPProgressMeter.SetProgressAriaInfo(a.succeededCount,a.failedCount,0);break;case 4:if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-blue");HideElement(d.parentNode)}else if(!fIsNullOrUndefined(d)){d.src=p+"/_layouts/15/images/check.gif?rev=47";ShowElement(d)}if(a.files.length>1)e.innerHTML=Strings.STS.L_CancelledMessageMultiple;else e.innerHTML=Strings.STS.L_CancelledMessageSingle;l.style.display="none";if(!fIsNullOrUndefined(f))f.style.display="none";if(!fIsNullOrUndefined(i))i.style.display="";if(!fIsNullOrUndefined(h))h.style.display="";Flighting.VariantConfiguration.IsExpFeatureClientEnabled(169)&&SPProgressMeter.SetProgressAriaInfo(0,0,a.files.length);break;default:b.style.display="none"}}function CloseProgressBar(g,c){var a=g_uploadCtl[c];if(fIsNullOrUndefined(a))return;var f=a.elmProgressBar;if(!fIsNullOrUndefined(f))f.style.display="none";var b=document.getElementById(C_DETAILDIVID);if(!fIsNullOrUndefined(b))b.style.display="none";if(a.fInlineProgress){var e=document.getElementById("Hero-"+getCtx(c).wpq);if(!fIsNullOrUndefined(e))e.style.display="";var d=document.querySelector("button.js-listview-qcbUploadButton");!fIsNullOrUndefined(d)&&d.focus()}cancelDefault(g)}function cancelTask(a){var b=g_currentControl.cctask;if(!fIsNullOrUndefined(b)){b.cancel(SP.Utilities.Task.CancelType.explicit);if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.target))a.target.disabled=true;FullRefresh(g_currentCtx)}cancelDefault(a)}function getUploadType(){var uploadType=UploadType.NOT_SUPPORTED;if(browseris.ipad||browseris.windowsphone)return uploadType;if(typeof FormData!="undefined")return UploadType.HTML5;else if(browseris.ie&&browseris.ie6up&&!browseris.mac)try{var ax=new ActiveXObject("SharePoint.DragUploadCtl");uploadType=UploadType.ACTIVEX}catch(e){uploadType=UploadType.ACTIVEXNA}if(uploadType==UploadType.NOT_SUPPORTED||uploadType==UploadType.ACTIVEXNA)if(!fIsNullOrUndefined(g_ctxDict))for(var ctxId in g_ctxDict){var curCtx=g_ctxDict[ctxId];if(!fIsNullOrUndefined(curCtx)&&!fIsNullOrUndefined(curCtx.ListSchema)&&curCtx.ListSchema.IsDocLib){var heroId=curCtx.heroId;if(Boolean(heroId)){var queryString="#Hero-"+curCtx.wpq+" a#"+heroId+"",heroRow=document.querySelector(queryString);if(!fIsNullOrUndefined(heroRow)){heroRow.parentNode.innerHTML=RenderHeroLink(curCtx,true);if(curCtx.ListTemplateType==115){var WPQ=curCtx.wpq;if(eval("typeof DefaultNewButtonWebPart"+WPQ+" != 'undefined'"))if(Boolean(curCtx.heroId)){var eleLink=document.getElementById(curCtx.heroId);if(eleLink!=null)eval("DefaultNewButtonWebPart"+WPQ+"(eleLink);")}}}}}}return uploadType}function checkInlineDisplay(b){var a=getCtx(b.id);return!fIsNullOrUndefined(a)&&Boolean(a.IsClientRendering)&&!Boolean(a.inGridMode)&&!Boolean(a.ListSchema.group1)?true:false}function checkInlineDisplayError(b){var a=getCtx(b.id);return!fIsNullOrUndefined(a)&&a.listTemplate==109&&(a.BaseViewID=="2"||a.BaseViewID=="6")?false:true}function ShowErrorDialog(b,a){ShowErrorDialogCore(Strings.STS.L_UploadDialogTitle,b,a)}function ResolveConflict(b,c){var a=b.conflictFiles,d=b.files;if(c>=a.length){b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b);return}if(a[c]==-1){ResolveConflict(b,c+1);return}var e=d[a[c]],f=a.length-c-1,g=function(q,n){if(q==SP.UI.DialogResult.cancel){b.cancelConfirm=CancelConfirmationStatus.CONFIRMEDYES;cancelTask(null);return}else var m=n.overwriteOption,t=n.doRest;var o=c+1;if(t)o=a.length;for(var s=e.isFolder,g=c;g<o;g++){if(a[g]==-1)continue;var f=d[a[g]];if(s!=f.isFolder)continue;if(m==1){f.overwrite=false;f.status=FileStatus.SKIP;f.statusText=Strings.STS.L_NoOverwrite;a[g]=-1;if(f.isFolder){for(var p=unescapeProperlyWp(f.relativeFolder+f.fileName),i=g+1;i<a.length;i++){if(a[i]==-1)continue;var j=d[a[i]],r=unescapeProperlyWp(j.relativeFolder);if(r.indexOf(p)==0){j.overwrite=false;j.status=FileStatus.SKIP;j.statusText=Strings.STS.L_NoOverwrite;a[i]=-1}}for(var l=a[g]+1;l<d.length;l++){var h=d[l];if(h.status==FileStatus.SKIP)continue;var u=unescapeProperlyWp(h.relativeFolder);if(u.indexOf(p)==0){h.overwrite=false;h.status=FileStatus.SKIP;h.statusText=Strings.STS.L_NoOverwrite}}}}else if(m==0){f.overwrite=true;a[g]=-1}else continue;if(f.status!=FileStatus.SKIP)b.totalBytes+=f.fileSize}for(var k=c+1,k=c+1;k<a.length;k++)if(a[k]!=-1)break;b.conflictFiles=a;ResolveConflict(b,k)};ShowConflictDialog(e.fileName,e.isFolder,g,f)}var c_doRestDiv,c_conflictButtons;function ShowConflictDialog(f,g,j,b){var e,d,c;if(g){e=Strings.STS.L_ConflictMergeTitle;d=Strings.STS.L_ConflictMergeFolderButton;c=Strings.STS.L_ConflictNoUploadButton}else{e=Strings.STS.L_ConflictReplaceTitle;d=Strings.STS.L_ConflictReplaceButton;c=Strings.STS.L_ConflictNoUploadButton}var a=[];a.push("<div class='ms-core-form-section'>");if(g)a.push(String.format(Strings.STS.L_ConflictFolderMessage,f));else a.push(String.format(Strings.STS.L_ConflictMessage,f));a.push("</div>");a.push("<div class='ms-core-form-section'>");if(!fIsNullOrUndefined(b))if(Number(b)==1)a.push(String.format(c_doRestDiv,Strings.STS.L_ConflictApplyRestForOneCheckBox));else Number(b)>1&&a.push(String.format(c_doRestDiv,String.format(Strings.STS.L_ConflictApplyRestWithCountCheckBox,b)));else a.push(String.format(c_doRestDiv,Strings.STS.L_ConflictApplyRestCheckBox));a.push(String.format(c_conflictButtons,d,c));a.push("</div>");var h=document.createElement("DIV");h.innerHTML=a.join("");var k={html:h,showClose:true,title:e,dialogReturnValueCallback:j},l=new SP.UI.ModalDialog.showModalDialog(k),i=document.getElementById("ms-conflictDlgNoUploadBtn");Boolean(i)&&i.focus()}function DismissConflictDlg(c,h){var b=SP.UI.DialogResult.cancel,a,f=false;if(!fIsNullOrUndefined(c)){b=SP.UI.DialogResult.OK;if(c.id=="ms-conflictDlgReplaceBtn")a=0;else if(c.id=="ms-conflictDlgNoUploadBtn")a=1;else if(c.id=="ms-conflictDlgRenameBtn")a=2;b=SP.UI.DialogResult.OK;var e=document.getElementById("ms-conflictDlgDoRest");if(Boolean(e))f=e.checked}var d=SP.UI.ModalDialog.get_childDialog();if(Boolean(d)){if(b==SP.UI.DialogResult.OK){var g={overwriteOption:a,doRest:f};d.set_returnValue(g)}d.close(b)}cancelDefault(h)}var C_DETAILDIVID,C_ERRTABLE,C_ERRITEM,C_ERRITEMNAME,C_ERRITEMMSG;function PopulateErrorDetails(n){var i=g_currentControl.files,m=g_currentControl.elmProgressBar;if(fIsNullOrUndefined(i)||fIsNullOrUndefined(m))return;for(var l=g_currentControl.strSiteUrl,k=false,a=document.getElementById(C_DETAILDIVID),j=0;j<i.length;j++){var b=i[j];if(b.status==FileStatus.FAILED||b.status==FileStatus.WARNING){if(!k){k=true;if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.className=C_ERRTABLE;a.id=C_DETAILDIVID;var g=g_currentControl.elmDropTargetElement;!fIsNullOrUndefined(g)&&g.parentNode.insertBefore(a,g)}else a.innerHTML=""}if(fIsNullOrUndefined(a))return;var c=document.createElement("DIV");c.className="ms-tableRow "+C_ERRITEM;a.appendChild(c);var h=document.createElement("DIV");h.className="ms-tableCell "+C_progImgClass;c.appendChild(h);var e=document.createElement("IMG");e.className="ms-verticalAlignMiddle";if(b.status==FileStatus.FAILED)e.src=l+"/_layouts/15/images/cell-error.png?rev=47";else e.src=l+"/_layouts/15/images/warn16.gif?rev=47";h.appendChild(e);if(!fIsNullOrUndefined(b.fileName)){var d=document.createElement("DIV");d.className="ms-tableCell "+C_ERRITEMNAME;c.appendChild(d);if(!fIsNullOrUndefined(b.fileName))if(!(window.OffSwitch==null||OffSwitch.IsActive("8DAF14E4-8073-4426-B097-9D75AEAAA416")))d.innerHTML=STSHtmlEncode(b.fileName);else d.innerHTML=b.fileName}if(!fIsNullOrUndefined(b.statusText)){var f=document.createElement("DIV");f.className="ms-tableCell "+C_ERRITEMMSG;c.appendChild(f);if(!fIsNullOrUndefined(b.statusText))f.innerHTML=unescapeProperlyWp(b.statusText)}}}if(!fIsNullOrUndefined(a))if(n)a.style.display="none";else a.style.display=""}function ShowHideErrorDetails(b){var a=document.getElementById(C_DETAILDIVID);if(!fIsNullOrUndefined(a))if(a.style.display=="")a.style.display="none";else a.style.display="";cancelDefault(b)}function fValidDrag(a,d){var b=false,c=SPDragDropManager.DragStartPos;if(fIsNullOrUndefined(d))return false;var h=AbsLeft(d),i=AbsTop(d);if(!fIsNullOrUndefined(c)&&c.X>0&&c.Y>0){b=c.X<h&&c.X>h+d.clientWidth&&c.Y<i&&c.Y>i+d.clientHeight;if(!b){if(a.dataTransfer)a.dataTransfer.dropEffect="none";else if(a.rawEvent)a.rawEvent.dataTransfer.dropEffect="none";return b}}if(g_uploadType==UploadType.ACTIVEX){if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.rawEvent)&&!fIsNullOrUndefined(a.rawEvent.dataTransfer)&&(fIsNullOrUndefined(a.rawEvent.dataTransfer.dropEffect)||a.rawEvent.dataTransfer.dropEffect==""||a.rawEvent.dataTransfer.dropEffect=="none")||!fIsNullOrUndefined(a.dataTransfer)&&(fIsNullOrUndefined(a.dataTransfer.dropEffect)||a.dataTransfer.dropEffect==""||a.dataTransfer.dropEffect=="none"))b=true}else if(g_uploadType==UploadType.HTML5)if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.dataTransfer)&&!fIsNullOrUndefined(a.dataTransfer.types)){var e=a.dataTransfer.types;if(!fIsNullOrUndefined(e)){var f=e.length;if(fIsNullOrUndefined(f))f=0;for(var g=0;g<f;g++){var j=e[g];if(j=="Files"){b=true;break}}}}else if(browseris.safari&&!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.dataTransfer)&&fIsNullOrUndefined(a.dataTransfer.types))b=true;return b}function unescapeProperlyWp(a){return a==undefined?a:unescapeProperly(a)}function PostRefreshFixUp(){EnsureScriptFunc("inplview","InitAllClvps",function(){var a=g_currentCtx.clvp;ctxInitItemState(g_currentCtx.clvp.ctx);ClearSelectedItemsDict(g_currentCtx);if(typeof a.tab.onmouseover=="undefined"||a.tab.onmouseover==null)a.tab.onmouseover=g_currentCtx.TableMouseoverHandler;if(g_currentCtx.SelectAllCbx!=null&&(typeof a.ctx.SelectAllCbx.onfocus=="undefined"||g_currentCtx.SelectAllCbx.onfocus==null))g_currentCtx.SelectAllCbx.onfocus=g_currentCtx.TableCbxFocusHandler;a.InvalidateEcbInfo();a.ResetSelection();a.SyncPagingTables();if(typeof ProcessImn!="undefined"){imnCount=0;bIMNOnloadAttached=false;ProcessImn()}})}var pluginID;function startDragDownload(c,b){if(!c.BasePermissions.OpenItems)return;if(fIsNullOrUndefined(b)||fIsNullOrUndefined(c))return;var a=document.getElementById(pluginID);if(!Boolean(a))a=CreateDragDownloadPlugin();if(Boolean(a))if(!fIsNullOrUndefined(b)){a.SiteUrl=c.HttpRoot;a.InitDownload();for(var d=0;d<b.length;d++){var e=b[d];a.AddFile(e.fileName,getHostUrl(c.HttpRoot)+e.fileUrl)}a.StartDownload()}}var downloadAXID;function CreateDragDownloadPlugin(){if(Boolean(window.ActiveXObject))try{var c=new ActiveXObject("SharePoint.DragDownloadCtl");if(Boolean(c)){var b=document.getElementById(downloadAXID);if(!Boolean(b)){var a=document.createElement("object");a.id=downloadAXID;a.classid="CLSID:3B0BD075-929C-4E52-AAD1-458C81A10B24";a.style.display="none";document.body.appendChild(a);b=document.getElementById(downloadAXID);return b}else return b}else return null}catch(d){return null}else return CreateNPApiOnWindowsPlugin("application/x-sharepoint-dragdownload")}function resetDragDownload(){}function ShowErrorInvalidFile(){ShowErrorDialogCore(Strings.STS.L_DragDropNotWorkingErrorTitle,Strings.STS.L_DragDropInvalidFile,null)}function ResetTaskEngineTimeOut(){SP.Utilities.TaskCarousel.resetSharedStopTimer(0)}function UploadQueue(){var b=[],a=null;this.enqueue=function(a){b.push(a)};var c=function(){if(fIsNullOrUndefined(a))a=b.shift();else if(a.status===UploaderStatus.CANCELLED||a.status===UploaderStatus.FINISHED)a=b.shift()};this.startUpload=function(d){if(b.length>0){c();!fIsNullOrUndefined(a)&&a.startUpload(d)}};this.continueUpload=function(b){if(!fIsNullOrUndefined(a))if(a.status===UploaderStatus.FINISHED||a.status===UploaderStatus.CANCELLED){c();if(!fIsNullOrUndefined(a))a.startUpload(b);else b.status=UploadStatus.FINISHED}else a.continueUpload(b);else b.status=UploadStatus.FINISHED};this.cancelUpload=function(b){!fIsNullOrUndefined(a)&&a.cancelUpload();b.status=UploadStatus.CANCELLED}}function FilesUploaderProgressUpdater(){var g=.5,i=5*C_MEGABYTES,a=null,e=0,b=0,f=0,d=0,c=0,h=false;this.startProgress=function(h,g){a=h;e=g;b=0;f=0;d=0;c=e/i};this.updateProgress=function(c){if(b<c*g){b=c*g;f=c*(1-g);a.totalBytesInProgress=a.totalBytesProcessed+b;if(e>=c)d=Date.now()}};this.updateProgressBar=function(){if(d>0&&!h){var e=(Date.now()-d)/1e3;e=e<c?e:c;var i=e*.95/c,g=f*i;a.totalBytesInProgress=a.totalBytesProcessed+b+g}UpdateProgressBar(ProgressMessage.UPLOADING,a)};this.completeProgress=function(b){a.totalBytesProcessed=a.totalBytesProcessed+e;h=true;if(!fIsNullOrUndefined(b))if(b===true)a.succeededCount++;else a.failedCount++;UpdateProgressBar(ProgressMessage.UPLOADING,a);a.UpdateProgress()}}var UploaderStatus;function FilesUploader(c,b,a){this.files=c;this.rootFolder=b;this.useChunkUpload=a;a===true;this.chunkSize=C_UPLOAD_CHUNKSIZE;this.chunkBytesToSend=0;this.chunkNumber=0;this.uploadMethod="";this.uploadId=null;this.chunkBlob=null;this.request=null;this.status=UploaderStatus.PENDING;this.retryCount=0;this.maxRetryCount=5;this.requestStartTime=null;this.retryInterval=5e3;this.retryTimerId=null;this.requestTimeoutMs=0;this.progressUpdater=new FilesUploaderProgressUpdater}var c_uploadUrl,uploadCompleteDelegate;function addUploadFinishedDelegate(a){if(uploadCompleteDelegate!=null)uploadCompleteDelegate.push(a);else uploadCompleteDelegate=new Array(a)}function UploadUrlBuilder(){var c=this,b={},a=[];if(Boolean(g_currentControl)){var d=g_currentControl.strSiteUrl;a.push(d);d[d.length-1]!=="/"&&a.push("/")}else a.push("/");a.push("_api/web");this.appendPathSegment=function(b){a.push("/");a.push(b)};this.appendMethodCall=function(e,c){if(!fIsNullOrUndefined(e)){a.push("/");a.push(e);a.push("(");if(!fIsNullOrUndefined(c)){var b=Object.keys(c);if(b.length===1&&b[0]!=="DecodedUrl")a.push(c[b[0]]);else for(var d=0;d<b.length;d++){var f=b[d],g=c[f];d>0&&a.push(",");a.push(f);a.push("=");a.push(g)}}a.push(")")}};this.appendMethodCallWithParameterAliases=function(f,b){var a=null;if(!fIsNullOrUndefined(f)){if(!fIsNullOrUndefined(b)){a={};for(var h=Object.keys(b),e=0;e<h.length;e++){var d=h[e],i=b[d],g="@"+d;a[d]=g;c.addQueryString(g,i)}}c.appendMethodCall(f,a)}};this.addQueryString=function(c,a){b[c]=a};this.toGuidParameter=function(a){return"guid'"+a+"'"};this.isGuidParameter=function(a){if(!fIsNullOrUndefined(a)){var b=/^guid'[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'$/i;return b.test(a)}return false};this.encodeStringParameter=function(b){var a=b;if(!fIsNullOrUndefined(b)){if(!c.isGuidParameter(a))a=c.encodeSPRestURIStringToken(a);a=encodeURIComponent(a)}return a};this.encodeSPRestURIStringToken=function(b){if(!fIsNullOrUndefined(b)){var a=b.toString();a=a.replace(/'/g,"''");return"'"+a+"'"}return b};this.url=function(){var c=["?"];if(!fIsNullOrUndefined(b))for(var e=Object.keys(b),d=0;d<e.length;d++){var f=e[d],h=b[f];c.push("&");c.push(f);c.push("=");c.push(h)}var g=a.join("")+c.join("");return g}}$_global_dragdrop();