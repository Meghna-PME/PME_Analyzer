function $_global_offline(){if("undefined"==typeof g_all_modules)g_all_modules={};g_all_modules["offline.js"]={version:{rmj:16,rmm:0,rup:24016,rpr:12006}};typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkBegin_offline.js");g_OfflineClient=null;sdpLearnMoreLink="https://go.microsoft.com/fwlink/?LinkID=398035";sdpLearnMoreLinkNGSD="https://go.microsoft.com/fwlink/p/?LinkId=248256";typeof Sys!="undefined"&&Sys!=null&&Sys.Application!=null&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("offline.js");typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkEnd_offline.js")}function ULSNRC(){var a={};a.ULSTeamName="Microsoft SharePoint Foundation";a.ULSFileName="offline.commentedjs";return a}var g_OfflineClient,sdpLearnMoreLink,sdpLearnMoreLinkNGSD;function TakeOfflineDisabled(a,c,d,b){if(InitOfflineClient())return!g_OfflineClient.IsOfflineAllowed(a,c,d,b);if(browseris.mac)return false;var e=browseris.win&&IsScopeValidForOffline(a)&&IsSiteTemplateValidForOffline(a,c)&&IsListValidForOffline(a,d,b);return!e?true:typeof navigator.msProtocols=="object"?!navigator.msProtocols.grvopen:false}function InitOfflineClient(){a:;try{if(g_OfflineClient==null)if(document.cookie.indexOf("OfflineClientInstalled")==-1){if(IsSupportedMacBrowser())g_OfflineClient=CreateMacPlugin();else g_OfflineClient=new ActiveXObject("SharePoint.OfflineClient");document.cookie="OfflineClientInstalled=1"}else if(GetCookie("OfflineClientInstalled")=="1")if(IsSupportedMacBrowser())g_OfflineClient=CreateMacPlugin();else g_OfflineClient=new ActiveXObject("SharePoint.OfflineClient");else return false;if(g_OfflineClient!=null&&typeof g_OfflineClient.IsOfflineAllowed!="undefined"&&typeof g_OfflineClient.TakeOffline!="undefined")return true}catch(a){document.cookie="OfflineClientInstalled=0";g_OfflineClient=null}return false}function IsScopeValidForOffline(a){switch(a){case 1:case 2:case 3:return true;default:return false}}function IsSiteTemplateValidForOffline(b,a){if(b!==1)return true;switch(a){case 2:case 3:case 4:case 9:case 15:case 54:return false;default:return true}}function IsListValidForOffline(c,b,a){if(c===1)return true;switch(a){case 100:case 101:case 103:case 104:case 105:case 107:case 108:case 109:case 120:case 150:case 499:case 851:case 1100:case 1300:case 2002:case 2003:return true}switch(b){case 0:case 1:case 3:return true}return false}function TakeOfflineToClientWithPopup(g,r,x,q,e,k,b,o,u,a){if(!Boolean(a))a=ctx;function s(){a:;var a=typeof window.top.g_childDialog!=="undefined"?window.top.g_childDialog:undefined;Boolean(a)&&a.close(0)}if(useNGSCSyncDialog(a)){launchNGSCSyncDialog(g,a);return}var w={};w.LaunchedWithCallback=false;var n;n=Strings.STS.L_StsSyncPopupLearnMore_Text2;var i=[],f;if(o){f=String.format(Strings.STS.L_ExplorerWarning,"<a onclick=\"window.open('http://support.microsoft.com/kb/2629108', '_blank')\" href='#'>","</a>");f+="<br/><br/>"+STSHtmlEncode(Strings.STS.L_ExplorerSync)}else if(ListModule.Settings.SupportsAddToOneDrive&&ListModule.Settings.SupportsAddToOneDriveInSync&&!Boolean(a.RealHttpRoot)&&e==101){var d;if(!Boolean(a.CurrentSelectedItems))if(b=="")d=String.format(Strings.STS.L_AddToOneDrive_LibraryMountPointTitle,a.SiteTitle,a.ListTitle);else{var z=b.indexOf("/");d=z!=-1?b.substring(z+1):b}else{var j=0,l=a.ListData!=null?a.ListData.Row:[];if(l.length!=0){var h,A,t=GetSelectedItemsDict(a);for(A in t){var B=t[A];if(B.fsObjType!="1")continue;for(var m=0;m<l.length;m++){h=l[m];if(h.FSObjType!="1")continue;if(h.ID!=B.id)continue;i.push(h.FileRef);j++;if(j==1)d=h.FileLeafRef}}}d=j==1?d:String.format(Strings.STS.L_StsSyncAddToOneDriveMutliItmes_Text,j.toString())}f=STSHtmlEncode(String.format(Strings.STS.L_StsSyncAddToOneDrivePopupTitle_Text,d))}else f=STSHtmlEncode(Strings.STS.L_StsSyncPopupTitle_Text);var y=o?"h3":"h2",p="<"+y+" class=''>"+f+"</"+y+"><br><div class='ms-core-menu-item' style='padding: 5px 0px 5px 0px; margin-bottom: 20px'><a href='#' onclick='return false;' id='ms-syncPopupButton' class='ms-core-menu-link'><span class='ms-syncButtonIconParent'><img class='ms-syncButtonIcon' src='"+GetThemedImageUrl("spcommon.png")+"'/></span><span style='margin-left: 20px; vertical-align: top'>"+STSHtmlEncode(Strings.STS.L_StsSyncPopupSync_Text)+"</span></a></div>";p+="<div><a href='"+sdpLearnMoreLink+"' target='_blank'>"+STSHtmlEncode(n)+"</a></div>";var C=function(){Boolean(u)&&u.focus()},v=document.createElement("DIV");v.innerHTML=p;var D={title:" ",html:v,dialogReturnValueCallback:C,args:w,autoSizeStartWidth:315};OpenPopUpPageWithDialogOptions(D);var c=document.getElementById("ms-syncPopupButton");m$(c).click(function(){a:;if(ListModule.Settings.SupportsAddToOneDriveInSync&&ListModule.Settings.SupportsAddToOneDrive&&!Boolean(a.RealHttpRoot)&&e==101){WriteStart("DocLib_SyncAddToOneDrive");var j=function(b){a:;var a=b;if(g==3||a!=""){a=a.trim();a=a.replace(/%2F/gi,"/")}SP.SOD.executeFunc("MountPoint.js","CreateMountPointForList",function(){a:;CreateMountPointForList(k,e.toString(),a);SP.QoS.WriteSuccess("DocLib_SyncAddToOneDriveSuccess");WriteDebugLog("DocLib_SyncAddToOneDrive",false,"AddToOneDriveInSync: "+a)})},c=false;if(!Boolean(a.CurrentSelectedItems)){if(g==3||b!="")b=a.rootFolder;j(b);c=true}else{c=Boolean(i.length>0);for(var h=0;h<i.length;h++)j(i[h])}if(!c){WriteDebugLog("DocLib_SyncAddToOneDrive",true,"AddToOneDrive: selected item that is not mountpoint");c=true;WriteSuccess("DocLib_SyncAddToOneDrive")}}else if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(35)&&a){var d=SP.ClientContext.get_current(),m=d.get_site(),f=d.get_web(),n=f.get_lists().getById(a.listName),l=Boolean(a.clvp.rootFolder)?f.getFolderByServerRelativeUrl(a.clvp.rootFolder):n.get_rootFolder();d.load(m,"Id");d.load(f,"Id");d.load(l,"UniqueId");d.executeQueryAsync(function(){a:;TakeOfflineToClientReal(g,r,x,q,e,k,b,null,a,l.get_uniqueId(),f.get_id(),m.get_id())&&s()},function(){})}else c=TakeOfflineToClientReal(g,r,x,q,e,k,b);c&&s()});m$(c).focus(function(){a:;m$(c).parent().addClass("ms-HoverBackground-bgColor")});m$(c).blur(function(){a:;m$(c).parent().removeClass("ms-HoverBackground-bgColor")});c.focus()}function useNGSCSyncDialog(a){if(!Boolean(a)||!Boolean(_spPageContextInfo))return false;var b=typeof a.ListTemplateType!="undefined"&&a.ListTemplateType==700;return _spPageContextInfo.isSPO?b?Flighting.VariantConfiguration.IsExpFeatureClientEnabled(569)||_spPageContextInfo.showNGSCDialogForSyncOnODB:_spPageContextInfo.showNGSCDialogForSyncOnTS:true}function launchNGSCSyncDialog(q,c){var d=!(window.OffSwitch==null||OffSwitch.IsActive("AEFA543A-7613-4D08-9084-7F9E39597662"))&&!_spPageContextInfo.isSPO,a=SP.ClientContext.get_current(),h=a.get_site(),b=a.get_web(),r=b.get_lists().getById(c.listName),g=Boolean(c.clvp.rootFolder)?b.getFolderByServerRelativeUrl(c.clvp.rootFolder):r.get_rootFolder(),i=d?b.get_currentUser():undefined;a.load(h,"Id");a.load(b,"Id");a.load(g,"UniqueId");d&&a.load(i,"UserId");a.executeQueryAsync(function(){a:;var e;if(d){var f=i.get_userId();e=Boolean(f)?f.get_nameId():null}var a="odopen://sync?scope=";a+=GetScopeName(q);a+=getExtraGrooveParameters(g.get_uniqueId(),b.get_id(),h.get_id(),e,c);launchProtocolHandler(a)},function(){});var f="h2",l=STSHtmlEncode(Strings.STS.NGSCSyncDialogTitle),n=STSHtmlEncode(Strings.STS.NGSCSyncDialogBody1),o=STSHtmlEncode(String.format(Strings.STS.NGSCSyncDialogBody2,_spPageContextInfo.userLoginName)),p=String.format(Strings.STS.NGSCSyncDialogBody3,"<a href='"+sdpLearnMoreLinkNGSD+"' target='_blank'>","</a>"),k="<div><"+f+">"+l+"</"+f+"></div><br/><div>"+n+" <br/><br/>"+o+"<br/><br/>"+p+"</div>",e=document.createElement("DIV");e.innerHTML=k;var m={},j={title:" ",html:e,args:m,autoSizeStartWidth:315};OpenPopUpPageWithDialogOptions(j)}function addGuidCurlyBraces(a){a:;return"%7B"+a+"%7D"}function getExtraGrooveParameters(f,i,g,h,c){var e=!(window.OffSwitch==null||OffSwitch.IsActive("7BFDF8AE-B16E-4CB1-AA3C-F64745FCBE05")),j=!(window.OffSwitch==null||OffSwitch.IsActive("AEFA543A-7613-4D08-9084-7F9E39597662"))&&!_spPageContextInfo.isSPO,d=!(window.OffSwitch==null||OffSwitch.IsActive("E9EBCD5E-ED4A-46BA-9559-D2D62B3BD954")),a="&siteId=";a+=d?addGuidCurlyBraces(encodeURIComponent(g)):encodeURIComponent(g);a+="&webId=";a+=d?addGuidCurlyBraces(encodeURIComponent(i)):encodeURIComponent(i);a+="&webTitle=";a+=encodeURIComponent(_spPageContextInfo.webTitle);a+="&listId=";a+=encodeURIComponent(c.listName);if(j&&Boolean(h)){a+="&userId=";a+=encodeURIComponent(h)}a+="&listTitle=";a+=encodeURIComponent(c.ListTitle);a+="&userEmail=";a+=encodeURIComponent(_spPageContextInfo.userLoginName);a+="&listTemplateTypeId=";a+=c.ListTemplateType;a+="&webUrl=";a+=encodeURIComponent(e?encodeURI(_spPageContextInfo.webAbsoluteUrl):_spPageContextInfo.webAbsoluteUrl);a+="&webLogoUrl=";a+=encodeURIComponent(e?encodeURI(_spPageContextInfo.webLogoUrl):_spPageContextInfo.webLogoUrl);a+="&webTemplate=";a+=encodeURIComponent(_spPageContextInfo.webTemplate);a+="&isSiteAdmin=";a+=c.CurrentUserIsSiteAdmin?"1":"0";var b=decodeURIComponent(c.rootFolder);if(Boolean(f)&&Boolean(b)){var k=b.split("/")[b.split("/").length-1];a+="&folderId=";a+=d?addGuidCurlyBraces(encodeURIComponent(f)):encodeURIComponent(f);a+="&folderName=";a+=encodeURIComponent(k);a+="&folderUrl=";a+=encodeURIComponent(e?encodeURI(b):b)}return a}function TakeOfflineToClientReal(e,i,f,h,d,c,b,o,l,j,n,m){try{if(TakeOfflineDisabled(e,i,h,d))return false;if(InitOfflineClient()){g_OfflineClient.TakeOffline(e,i,f,h,d,c,b);return true}if(!IsValidCommandForOffline(e,f,c,b))throw"ArgumentException: Incorrect parameters used to initiate offline sync.";var a=[];a.push("/");a.push(StringToASCIIAlnum(f));if(c!=null&&c!=""){a.push(StringToASCIIAlnum(c));d!=null&&a.push(StringToASCIIAlnum(d.toString()));b!=null&&b!=""&&a.push(StringToASCIIAlnum(b))}var k=new URI(a.join("/"));k.setScheme("grvopen");var g=k.getString()+"?"+GetScopeName(e);if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(35)&&Boolean(j))g+=getExtraGrooveParameters(j,n,m,null,l);launchProtocolHandler(g)}catch(p){alert(p.message)}return true}function launchProtocolHandler(a){a:;if((window.OffSwitch==null||OffSwitch.IsActive("53BED31C-D64A-44B8-92B0-B2E9F6DD81E1"))&&(browseris.ie10standardUp||browseris.msEdge)&&typeof navigator.msLaunchUri=="undefined")window.open(sdpLearnMoreLink,"_blank");else if(typeof navigator.msLaunchUri=="function")navigator.msLaunchUri(a,function(){},function(){a:;window.open(sdpLearnMoreLink,"_blank");SP.DebugLogger.Write("FailureLaunchSyncClient",SP.DebugLogger.LoggingLevel.Boring,"Fail to launch sync client via Protocol Handler. It's possible that sync client is not installed. Launch the learn more page in a new tab.")});else window.location.assign(a)}function IsValidCommandForOffline(g,f,e,d){var c=f===null||f==="",a=e===null||e==="",b=d===null||d==="";switch(g){case 1:return!c&&a&&b;case 2:return!c&&!a&&b;case 3:return!c&&!a&&!b;default:return false}}function GetScopeName(a){switch(a){case 1:return"OPENSITE";case 2:return"OPENLIST";case 3:return"OPENFOLDER";default:throw"ArgumentException: Incorrect offline scope value";}}function StringToASCIIAlnum(f){for(var c=97,a="",d=0;d<f.length;d++){var e=f[d];if(IsWAsciiAlnum(e))a+=e;else{a+="_";var b=e.charCodeAt(0);if(b<=99)a+=b.toString();else{a+=String.fromCharCode(c+Math.floor(b/4096));a+=String.fromCharCode(c+Math.floor(b/256)%16);a+=String.fromCharCode(c+Math.floor(b/16)%16);a+=String.fromCharCode(c+b%16)}}}return a}function IsWAsciiAlnum(a){return a>="a"&&a<="z"||a>="A"&&a<="Z"||a>="0"&&a<="9"}$_global_offline();